/* src/components/styles/MessageBlock.css */

/* Animation */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* --- Message Block --- */
.message-block {
  display: flex;
  flex-direction: column;
  max-width: 100%;
  animation: fadeInUp 0.3s ease-out forwards;
}

/* Container */
.message-container {
  display: flex;
  align-items: flex-start;
  gap: var(--space-3);
}

.message-container-user {
  flex-direction: row-reverse;
}

/* Avatars (CSS Class Control) */
.avatar-user, .avatar-ai {
  width: 32px;
  height: 32px;
  flex-shrink: 0;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.avatar-user {
  background-color: var(--color-primary); /* Blue */
  color: white;
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
}

.avatar-ai {
  background-color: var(--color-text-main); /* Dark Gray/Black */
  color: white;
}

/* Role Label (Hidden or Minimal) */
.message-role {
  display: none; /* Apple風デザインではアイコンと配置で自明なため非表示 */
}

/* --- Bubbles --- */
.message-content {
  font-size: var(--text-base);
  line-height: 1.6;
  word-wrap: break-word;
  padding: var(--space-3) var(--space-4);
  max-width: 100%; /* 親で制御 */
}

/* AI Bubble */
.message-content-ai {
  background-color: var(--color-bg-surface);
  border: 1px solid var(--color-border);
  color: var(--color-text-main);
  border-radius: 4px var(--radius-2xl) var(--radius-2xl) var(--radius-2xl); /* 左上だけ角張らせる */
  box-shadow: var(--shadow-sm);
}

/* User Bubble */
.message-content-user {
  background-color: var(--color-primary);
  color: var(--color-text-white);
  border-radius: var(--radius-2xl) 4px var(--radius-2xl) var(--radius-2xl); /* 右上だけ角張らせる */
  box-shadow: var(--shadow-sm);
}

/* ユーザー内のリンクは白文字で見やすく */
.message-content-user a {
  color: white;
  text-decoration: underline;
}

/* --- Markdown Styles (Inside AI Bubble) --- */
.markdown-renderer {
  font-size: var(--text-base);
}

.markdown-renderer > *:first-child { margin-top: 0; }
.markdown-renderer > *:last-child { margin-bottom: 0; }

.markdown-renderer p {
  margin-bottom: 0.8em;
}

.markdown-renderer h1,
.markdown-renderer h2,
.markdown-renderer h3 {
  font-weight: var(--font-bold);
  color: var(--color-text-main);
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

.markdown-renderer h1 { font-size: var(--text-lg); border-bottom: 1px solid var(--color-border); padding-bottom: 0.3em; }
.markdown-renderer h2 { font-size: var(--text-base); }
.markdown-renderer strong { font-weight: var(--font-bold); }

/* Lists */
.markdown-renderer ul, .markdown-renderer ol {
  padding-left: 1.5em;
  margin-bottom: 1em;
}
.markdown-renderer li {
  margin-bottom: 0.25em;
}

/* Code Blocks */
.markdown-renderer pre {
  background-color: #1F2937; /* Dark background for code */
  color: #F3F4F6;
  padding: var(--space-3);
  border-radius: var(--radius-lg);
  overflow-x: auto;
  margin: 0.8em 0;
  font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
  font-size: 0.85em;
}

.markdown-renderer :not(pre) > code {
  background-color: rgba(0,0,0,0.05);
  color: #C026D3; /* Purple/Pink text for inline code */
  padding: 2px 4px;
  border-radius: 4px;
  font-family: monospace;
  font-size: 0.9em;
}

.markdown-renderer blockquote {
  border-left: 3px solid var(--color-border-strong);
  padding-left: 1em;
  color: var(--color-text-sub);
  font-style: italic;
  margin: 1em 0;
}

.markdown-renderer a {
  color: var(--color-primary);
  text-decoration: none;
}
.markdown-renderer a:hover {
  text-decoration: underline;
}

/* Inline Citation [1] */
.inline-citation {
  font-size: 0.75em;
  color: var(--color-primary);
  font-weight: var(--font-bold);
  vertical-align: super;
  margin-left: 2px;
  cursor: default;
}

/* --- Citation List (Card Style) --- */
.citation-list {
  margin-top: var(--space-4);
  padding-top: var(--space-3);
  border-top: 1px solid var(--color-border);
  animation: fadeInUp 0.4s ease-out forwards;
}

.citation-title {
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
  color: var(--color-text-muted);
  margin-bottom: var(--space-2);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.citation-item {
  display: flex;
  align-items: center;
  background-color: var(--color-bg-body); /* 少しグレー */
  padding: 6px 10px;
  margin-bottom: 6px;
  border-radius: var(--radius-lg);
  font-size: var(--text-sm);
  color: var(--color-text-sub);
  text-decoration: none;
  transition: all 0.2s ease;
  border: 1px solid transparent;
}

.citation-item:hover {
  background-color: white;
  border-color: var(--color-border-strong);
  box-shadow: var(--shadow-sm);
  transform: translateY(-1px);
}

.citation-favicon {
  width: 14px;
  height: 14px;
  margin-right: 8px;
  border-radius: 2px;
}

.citation-link {
  color: inherit;
  text-decoration: none;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  flex-grow: 1;
}

/* --- Suggestion Buttons (Pill Style) --- */
.suggestion-buttons {
  margin-top: var(--space-3);
  padding-top: var(--space-2);
  border-top: 1px dashed var(--color-border); /* 点線で軽く区切る */
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
  animation: fadeInUp 0.5s ease-out forwards;
}

.suggestion-title {
  width: 100%;
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
  color: var(--color-text-muted);
  margin-bottom: 4px;
  text-transform: uppercase;
}

.suggestion-button {
  background-color: white;
  border: 1px solid var(--color-primary);
  color: var(--color-primary);
  padding: 6px 12px;
  border-radius: var(--radius-full); /* Pill shape */
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  cursor: pointer;
  transition: all 0.2s;
  text-align: left;
}

.suggestion-button:hover {
  background-color: var(--color-primary-bg);
  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.15);
}

/* --- File Attachment (In Message) --- */
.file-attachment-chip {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2);
  margin-bottom: var(--space-2);
  padding: 6px 12px;
  background-color: rgba(255, 255, 255, 0.2); /* ユーザー(青)背景での透過 */
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: var(--radius-lg);
  font-size: var(--text-sm);
  color: white;
}
/* AI側でファイルを表示する場合のスタイル (必要なら) */
.message-content-ai .file-attachment-chip {
  background-color: var(--color-bg-body);
  border-color: var(--color-border);
  color: var(--color-text-main);
}
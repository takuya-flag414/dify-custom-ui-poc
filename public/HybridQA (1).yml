app:
  description: ç¤¾å†…AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆé–‹ç™º (Phase 1) ã€‚
  icon: ðŸ¤–
  icon_background: '#FFEAD5'
  mode: advanced-chat
  name: HybridQA
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/gemini:0.7.5@13e7f1c10c3844d943714bd74bfc4fe26a21fae32efbe678858d6ac5079b2b3e
    version: null
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: r3-yamauchi/gemini_file_search:0.0.1@a9cf50b020b00b20f3b3f462d697f797517551d5d8bb8bf7ef078847080cabeb
    version: null
kind: app
version: 0.5.0
workflow:
  conversation_variables:
  - description: ''
    id: 6e4de431-0e3b-4b1f-b7f3-4b08e219d1d9
    name: store_summary
    selector:
    - conversation
    - store_summary
    value: ''
    value_type: string
  - description: ''
    id: 31a3c801-9584-4a27-aa93-1dc403f61e94
    name: DevRoute
    selector:
    - conversation
    - DevRoute
    value: true
    value_type: boolean
  - description: ''
    id: 6a708509-1da6-4c64-9f59-3667ae436705
    name: context_file_name
    selector:
    - conversation
    - context_file_name
    value: ''
    value_type: string
  - description: æœ€é©åŒ–ã•ã‚ŒãŸæ¤œç´¢ã‚¯ã‚¨ãƒª
    id: f7d8ed98-9085-43e4-adda-9558b3de8f52
    name: optimized_search_query
    selector:
    - conversation
    - optimized_search_query
    value: ''
    value_type: string
  - description: Webæ¤œç´¢çµæžœ
    id: 38630ad2-9d96-475b-8daa-fca4012bf7e3
    name: context_web
    selector:
    - conversation
    - context_web
    value: ''
    value_type: string
  - description: RAGæ¤œç´¢çµæžœ
    id: ee471556-3e5c-4c12-8e2f-a89b3aab8423
    name: context_rag
    selector:
    - conversation
    - context_rag
    value: ''
    value_type: string
  - description: ãƒ•ã‚¡ã‚¤ãƒ«æŠ½å‡ºãƒ†ã‚­ã‚¹ãƒˆ
    id: b72b2f7b-8ca9-478d-9e1e-13e88c074c9e
    name: context_file
    selector:
    - conversation
    - context_file
    value: []
    value_type: array[string]
  - description: ''
    id: f21ecbed-b927-4f77-b16d-edc5d6b50621
    name: input_perplexity
    selector:
    - conversation
    - input_perplexity
    value: ''
    value_type: string
  - description: ''
    id: dc709b28-a14d-4585-960c-64cb3857a97a
    name: extracted_text
    selector:
    - conversation
    - extracted_text
    value: ''
    value_type: string
  - description: ''
    id: d3a4c143-2880-43da-9954-dc5984ff034a
    name: temp_result
    selector:
    - conversation
    - temp_result
    value: ''
    value_type: string
  environment_variables:
  - description: ''
    id: 9a180917-ddba-4289-9291-ffd14c16a683
    name: PerplexityApiKey
    selector:
    - env
    - PerplexityApiKey
    value: ''
    value_type: secret
  - description: ''
    id: 506b86a8-bb2d-41c4-b718-7f8d898105cb
    name: GeminiApiKey
    selector:
    - env
    - GeminiApiKey
    value: ''
    value_type: secret
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - document
      allowed_file_upload_methods:
      - remote_url
      - local_file
      enabled: true
      fileUploadConfig:
        attachment_image_file_size_limit: 2
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        file_upload_limit: 50
        image_file_batch_limit: 10
        image_file_size_limit: 10
        single_chunk_attachment_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 5
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: true
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: document-extractor
      id: 1764913411735-true-1764913700839-target
      selected: false
      source: '1764913411735'
      sourceHandle: 'true'
      target: '1764913700839'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: document-extractor
        targetType: code
      id: 1764913700839-source-1764924171081-target
      selected: false
      source: '1764913700839'
      sourceHandle: source
      target: '1764924171081'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: assigner
      id: 1764924171081-source-1764913830165-target
      selected: false
      source: '1764924171081'
      sourceHandle: source
      target: '1764913830165'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: 1765514869301-source-1765515071449-target
      selected: false
      source: '1765514869301'
      sourceHandle: source
      target: '1765515071449'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: if-else
      id: 1762490237953-false-1765854025663-target
      selected: false
      source: '1762490237953'
      sourceHandle: 'false'
      target: '1765854025663'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: if-else
      id: 1765854025663-false-1764913411735-target
      selected: false
      source: '1765854025663'
      sourceHandle: 'false'
      target: '1764913411735'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: if-else
      id: 1765854025663-true-17658598785120-target
      selected: false
      source: '1765854025663'
      sourceHandle: 'true'
      target: '17658598785120'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: document-extractor
      id: 17658598785120-true-17658598785131-target
      selected: false
      source: '17658598785120'
      sourceHandle: 'true'
      target: '17658598785131'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: document-extractor
        targetType: code
      id: 17658598785131-source-17658598785133-target
      selected: false
      source: '17658598785131'
      sourceHandle: source
      target: '17658598785133'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: assigner
      id: 17658598785133-source-17658598785132-target
      selected: false
      source: '17658598785133'
      sourceHandle: source
      target: '17658598785132'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: assigner
        targetType: if-else
      id: 17658598785132-source-1766549782668-target
      selected: false
      source: '17658598785132'
      sourceHandle: source
      target: '1766549782668'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: if-else
      id: 17658598785120-0703a046-f8f7-4b0e-b07b-3794eaee8f40-1766549782668-target
      selected: false
      source: '17658598785120'
      sourceHandle: 0703a046-f8f7-4b0e-b07b-3794eaee8f40
      target: '1766549782668'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1766549782668-false-17665499392760-target
      selected: false
      source: '1766549782668'
      sourceHandle: 'false'
      target: '17665499392760'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17665499392760-source-1765854668107-target
      selected: false
      source: '17665499392760'
      sourceHandle: source
      target: '1765854668107'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17665500976990-source-1765859958399-target
      selected: false
      source: '17665500976990'
      sourceHandle: source
      target: '1765859958399'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17665511958080-source-1765345440190-target
      selected: false
      source: '17665511958080'
      sourceHandle: source
      target: '1765345440190'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17665512107830-source-17655153615920-target
      selected: false
      source: '17665512107830'
      sourceHandle: source
      target: '17655153615920'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17665512248470-source-17655153626170-target
      selected: false
      source: '17665512248470'
      sourceHandle: source
      target: '17655153626170'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17665512406710-source-17655153635450-target
      selected: false
      source: '17665512406710'
      sourceHandle: source
      target: '17655153635450'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: 17665517422840-source-1765345427966-target
      selected: false
      source: '17665517422840'
      sourceHandle: source
      target: '1765345427966'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: code
      id: 1764914157100-false-1765514869301-target
      selected: false
      source: '1764914157100'
      sourceHandle: 'false'
      target: '1765514869301'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: if-else
      id: 1764914026588-false-1764914157100-target
      selected: false
      source: '1764914026588'
      sourceHandle: 'false'
      target: '1764914157100'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: assigner
        targetType: code
      id: 17696657120690-source-1765514869301-target
      selected: false
      source: '17696657120690'
      sourceHandle: source
      target: '1765514869301'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: iteration
      id: 1769666802121-source-1769668260271-target
      selected: false
      source: '1769666802121'
      sourceHandle: source
      target: '1769668260271'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1769668260271'
        sourceType: iteration-start
        targetType: http-request
      id: 1769668260271start-source-1769668322968-target
      selected: false
      source: 1769668260271start
      sourceHandle: source
      target: '1769668322968'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: iteration
        targetType: llm
      id: 1769668260271-source-1769668477538-target
      selected: false
      source: '1769668260271'
      sourceHandle: source
      target: '1769668477538'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: assigner
      id: 1769668477538-source-17696657120690-target
      selected: false
      source: '1769668477538'
      sourceHandle: source
      target: '17696657120690'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: if-else
      id: 1769666720110-source-1769754087217-target
      selected: false
      source: '1769666720110'
      sourceHandle: source
      target: '1769754087217'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: code
      id: 1769754087217-false-1769666802121-target
      selected: false
      source: '1769754087217'
      sourceHandle: 'false'
      target: '1769666802121'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: code
      id: 1769754087217-true-17697542686310-target
      selected: false
      source: '1769754087217'
      sourceHandle: 'true'
      target: '17697542686310'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: assigner
        targetType: code
      id: 17697542971160-source-1765514869301-target
      selected: false
      source: '17697542971160'
      sourceHandle: source
      target: '1765514869301'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: http-request
        targetType: assigner
      id: 17697558915520-source-17697542971160-target
      selected: false
      source: '17697558915520'
      sourceHandle: source
      target: '17697542971160'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: http-request
      id: 17697542686310-source-17697558915520-target
      selected: false
      source: '17697542686310'
      sourceHandle: source
      target: '17697558915520'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 17658598785120-false-17665500976990-target
      selected: false
      source: '17658598785120'
      sourceHandle: 'false'
      target: '17665500976990'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1765343666910-true-17665517422840-target
      selected: false
      source: '1765343666910'
      sourceHandle: 'true'
      target: '17665517422840'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1765515071449-true-17665511958080-target
      selected: false
      source: '1765515071449'
      sourceHandle: 'true'
      target: '17665511958080'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1765515071449-908d672e-4c25-44ac-9ee9-4f7fb1b32144-17665512107830-target
      selected: false
      source: '1765515071449'
      sourceHandle: 908d672e-4c25-44ac-9ee9-4f7fb1b32144
      target: '17665512107830'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1765515071449-false-17665512406710-target
      selected: false
      source: '1765515071449'
      sourceHandle: 'false'
      target: '17665512406710'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1765515071449-f10e65ad-bb00-4cdf-aabf-78811af1ba70-17665512248470-target
      selected: false
      source: '1765515071449'
      sourceHandle: f10e65ad-bb00-4cdf-aabf-78811af1ba70
      target: '17665512248470'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: tool
        targetType: assigner
      id: 1770356105216-source-1770356226003-target
      selected: false
      source: '1770356105216'
      sourceHandle: source
      target: '1770356226003'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: assigner
        targetType: if-else
      id: 1770356226003-source-1764914157100-target
      selected: false
      source: '1770356226003'
      sourceHandle: source
      target: '1764914157100'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: answer
      id: 1762490237953-true-answer-target
      selected: false
      source: '1762490237953'
      sourceHandle: 'true'
      target: answer
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: code
      id: 1761291739140-source-1770869430347-target
      selected: false
      source: '1761291739140'
      sourceHandle: source
      target: '1770869430347'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: if-else
      id: 1770869430347-source-1762490237953-target
      selected: false
      source: '1770869430347'
      sourceHandle: source
      target: '1762490237953'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1764914157100-1db66d52-c4bb-4b05-a087-6a73781c2d5b-1769666720110-target
      selected: false
      source: '1764914157100'
      sourceHandle: 1db66d52-c4bb-4b05-a087-6a73781c2d5b
      target: '1769666720110'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: assigner
        targetType: if-else
      id: 1764913830165-source-1770871562386-target
      selected: false
      source: '1764913830165'
      sourceHandle: source
      target: '1770871562386'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: if-else
      id: 1764913411735-false-1770871562386-target
      selected: false
      source: '1764913411735'
      sourceHandle: 'false'
      target: '1770871562386'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1770871562386-false-17683770269110-target
      selected: false
      source: '1770871562386'
      sourceHandle: 'false'
      target: '17683770269110'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: variable-aggregator
      id: 17708716964770-source-1770871743875-target
      selected: false
      source: '17708716964770'
      sourceHandle: source
      target: '1770871743875'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: variable-aggregator
      id: 17683770269110-source-1770871743875-target
      selected: false
      source: '17683770269110'
      sourceHandle: source
      target: '1770871743875'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: variable-aggregator
        targetType: if-else
      id: 1770871743875-source-1765343666910-target
      selected: false
      source: '1770871743875'
      sourceHandle: source
      target: '1765343666910'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: if-else
      id: 1765343666910-false-1764914026588-target
      source: '1765343666910'
      sourceHandle: 'false'
      target: '1764914026588'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: 1770871562386-true-17708716964770-target
      selected: false
      source: '1770871562386'
      sourceHandle: 'true'
      target: '17708716964770'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: tool
      id: 17715726019570-source-1770356105216-target
      source: '17715726019570'
      sourceHandle: source
      target: '1770356105216'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: tool
        targetType: llm
      id: 1771391749204-source-17715726019570-target
      source: '1771391749204'
      sourceHandle: source
      target: '17715726019570'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: tool
      id: 1764914026588-f1ff0762-98d8-4a18-aab1-434d65b19404-1771573783623-target
      source: '1764914026588'
      sourceHandle: f1ff0762-98d8-4a18-aab1-434d65b19404
      target: '1771573783623'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: tool
        targetType: tool
      id: 1771573783623-source-1771391749204-target
      source: '1771573783623'
      sourceHandle: source
      target: '1771391749204'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        selected: false
        title: é–‹å§‹
        type: start
        variables:
        - default: false
          hint: ''
          label: isDebugMode
          max_length: 48
          options:
          - ''
          placeholder: ''
          required: false
          type: checkbox
          variable: isDebugMode
        - default: ''
          hint: ''
          label: Search Domain Filter
          max_length: 256
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: domain_filter
        - default: false
          hint: ''
          label: Web Enabled
          max_length: 48
          options:
          - auto
          - force
          - 'off'
          placeholder: ''
          required: true
          type: checkbox
          variable: web_enabled
        - default: false
          hint: ''
          label: RAG Enabled
          max_length: 48
          options:
          - 'true'
          - 'false'
          - auto
          placeholder: ''
          required: true
          type: checkbox
          variable: rag_enabled
        - allowed_file_extensions: []
          allowed_file_types:
          - document
          allowed_file_upload_methods:
          - local_file
          - remote_url
          default: "[\n  {\n    \"source_name\": \"ç¤¾å†…ç¨Ÿè­°è¦å®š_2025æ”¹å®šç‰ˆ.pdf\",\n    \"content\"\
            : \"ç¬¬3æ¡ï¼ˆæ±ºè£æ¨©é™åŸºæº–ï¼‰\\nç‰©å“è³¼å…¥ãŠã‚ˆã³ã‚µãƒ¼ãƒ“ã‚¹å¥‘ç´„ã«ãŠã‘ã‚‹æ‰¿èªãƒ•ãƒ­ãƒ¼ã¯ä»¥ä¸‹ã®é€šã‚Šå®šã‚ã‚‹ã€‚\\n1. 10ä¸‡å††æœªæº€ï¼šç›´å±žã®èª²é•·æ‰¿èª\\\
            n2. 10ä¸‡å††ä»¥ä¸Š50ä¸‡å††æœªæº€ï¼šéƒ¨é•·æ‰¿èª\\n3. 50ä¸‡å††ä»¥ä¸Š100ä¸‡å††æœªæº€ï¼šæœ¬éƒ¨é•·æ±ºè£\\n4. 100ä¸‡å††ä»¥ä¸Šï¼šå½¹å“¡ä¼šæ±ºè£\\n\\\
            nç¬¬5æ¡ï¼ˆSaaSåˆ©ç”¨ã®ç‰¹ä¾‹ï¼‰\\né‡‘é¡ã«é–¢ã‚ã‚‰ãšã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSaaSï¼‰ã®æ–°è¦å¥‘ç´„ã«ãŠã„ã¦ã¯ã€æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ éƒ¨ã«ã‚ˆã‚‹ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆã€ã®æå‡ºã¨æ‰¿èªï¼ˆæ±ºè£è€…ï¼šæƒ…ã‚·ã‚¹éƒ¨é•·ï¼‰ãŒå¿…é ˆã¨ãªã‚‹ã€‚ã“ã‚Œã¯ç„¡æ–™ãƒ—ãƒ©ãƒ³ã®æ¥­å‹™åˆ©ç”¨ã‚‚å«ã‚€ã€‚\\\
            n\\nç¬¬8æ¡ï¼ˆç·Šæ€¥æ±ºè£ï¼‰\\nç½å®³æ™‚ã‚„ã‚·ã‚¹ãƒ†ãƒ éšœå®³æ™‚ãªã©ã€ç·Šæ€¥ã‚’è¦ã™ã‚‹å ´åˆã¯äº‹å¾Œæ‰¿èªã‚’èªã‚ã‚‹ãŒã€ç™ºç”Ÿã‹ã‚‰3å–¶æ¥­æ—¥ä»¥å†…ã«æ­£è¦ã®ãƒ•ãƒ­ãƒ¼ã§ç”³è«‹ã‚’è¡Œã†ã“ã¨ã€‚\"\
            \n  },\n  {\n    \"source_name\": \"ITã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³_v3.2.docx\",\n    \"\
            content\": \"3-1. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼\\nç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ ãŠã‚ˆã³é€£æºã™ã‚‹å¤–éƒ¨ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSaaSï¼‰ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®è¦ä»¶ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚‹ã€‚\\\
            n- æ–‡å­—æ•°ï¼š12æ–‡å­—ä»¥ä¸Š\\n- æ§‹æˆï¼šå¤§æ–‡å­—ã€å°æ–‡å­—ã€æ•°å­—ã€è¨˜å·ã®4ç¨®é¡žã™ã¹ã¦ã‚’æ··åœ¨ã•ã›ã‚‹ã“ã¨\\n- å¤‰æ›´é »åº¦ï¼šå®šæœŸçš„å¤‰æ›´ã¯æ±‚ã‚ãªã„ãŒã€æ¼æ´©ãŒç–‘ã‚ã‚Œã‚‹å ´åˆã¯ç›´ã¡ã«å¤‰æ›´ã™ã‚‹ã“ã¨\\\
            n- ç¦æ­¢äº‹é …ï¼šæ°åã€ç¤¾å“¡ç•ªå·ã€èª•ç”Ÿæ—¥ãªã©æŽ¨æ¸¬å®¹æ˜“ãªæ–‡å­—åˆ—ã®ä½¿ç”¨\\n\\n4-2. ç”ŸæˆAIã®åˆ©ç”¨è¦å®š\\n- å½“ç¤¾ãŒå¥‘ç´„ã—ã¦ã„ã‚‹ã€ŒChatGPT\
            \ Enterpriseã€ãŠã‚ˆã³æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§é–‹ç™ºä¸­ã®ã€Œç¤¾å†…AIãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã€ä»¥å¤–ã®ç”ŸæˆAIã‚µãƒ¼ãƒ“ã‚¹ã¸ã®æ¥­å‹™ãƒ‡ãƒ¼ã‚¿ã®å…¥åŠ›ã¯åŽŸå‰‡ç¦æ­¢ã¨ã™ã‚‹ã€‚\\\
            n- ç¿»è¨³DeepLï¼ˆç„¡æ–™ç‰ˆï¼‰ã¸ã®æ©Ÿå¯†æƒ…å ±å…¥åŠ›ã¯åŽ³ç¦ã€‚å¿…ãšProç‰ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚\\n\\n5-1. ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†\\n- ç§ç‰©PCã€ç§ç‰©ã‚¹ãƒžãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®æ¥­å‹™ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŽ¥ç¶šï¼ˆBYODï¼‰ã¯ã€äº‹å‰ã«ç”³è«‹ã—ã€ŒMDMï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†ãƒ„ãƒ¼ãƒ«ï¼‰ã€ã‚’å°Žå…¥ã—ãŸç«¯æœ«ã«é™ã‚Šè¨±å¯ã™ã‚‹ã€‚\\\
            n- USBãƒ¡ãƒ¢ãƒªç­‰ã®å¤–éƒ¨è¨˜æ†¶åª’ä½“ã®ä½¿ç”¨ã¯åŽŸå‰‡ç¦æ­¢ã¨ã™ã‚‹ã€‚\"\n  },\n  {\n    \"source_name\": \"æ—…è²»ãƒ»çµŒè²»ç²¾ç®—è¦ç¨‹_2024.pdf\"\
            ,\n    \"content\": \"ç¬¬2ç«  äº¤é€šè²»\\n1. é€šå‹¤äº¤é€šè²»ï¼šæœ€ã‚‚çµŒæ¸ˆçš„ãªçµŒè·¯ï¼ˆæœ€å®‰çµŒè·¯ï¼‰ã‚’åŽŸå‰‡ã¨ã™ã‚‹ã€‚ãŸã ã—ã€æ‰€è¦æ™‚é–“ãŒæœ€å®‰çµŒè·¯ã®0.8å€ä»¥ä¸‹ã¨ãªã‚‹å ´åˆã¯ã€æœ€é€ŸçµŒè·¯ã‚’èªã‚ã‚‹å ´åˆãŒã‚ã‚‹ã€‚\\\
            n2. ã‚¿ã‚¯ã‚·ãƒ¼åˆ©ç”¨ï¼šåŽŸå‰‡ç¦æ­¢ã€‚ãŸã ã—ã€çµ‚é›»ã‚’é€ƒã—ãŸå ´åˆï¼ˆæ¥­å‹™èµ·å› ã«é™ã‚‹ï¼‰ã€ã¾ãŸã¯å…¬å…±äº¤é€šæ©Ÿé–¢ã§ã®ç§»å‹•ãŒå›°é›£ãªé‡é‡ç‰©ã‚’é‹æ¬ã™ã‚‹å ´åˆã«é™ã‚Šã€éƒ¨é•·æ‰¿èªã®ä¸Šã§è¨±å¯ã™ã‚‹ã€‚\\\
            n3. æ–°å¹¹ç·šãƒ»ç‰¹æ€¥ï¼šç‰‡é“100kmä»¥ä¸Šã®ç§»å‹•ã«ãŠã„ã¦åˆ©ç”¨å¯ã€‚æŒ‡å®šå¸­åˆ©ç”¨å¯ã€‚ã‚°ãƒªãƒ¼ãƒ³è»Šã¯å½¹å“¡ã®ã¿å¯ã€‚\\n\\nç¬¬4ç«  æŽ¥å¾…äº¤éš›è²»\\n1.\
            \ ä¼šé£ŸåŸºæº–ï¼š1äººã‚ãŸã‚Š5,000å††ï¼ˆç¨Žè¾¼ï¼‰ã¾ã§ã¯ä¼šè­°è²»ã¨ã—ã¦å‡¦ç†å¯ã€‚\\n2. 5,000å††ã‚’è¶…ãˆã‚‹å ´åˆï¼šäº‹å‰ç”³è«‹å¿…é ˆï¼ˆèª²é•·æ‰¿èªï¼‰ã€‚\\\
            n3. 1äººã‚ãŸã‚Š10,000å††ã‚’è¶…ãˆã‚‹å ´åˆï¼šäº‹å‰ç”³è«‹å¿…é ˆï¼ˆéƒ¨é•·æ‰¿èªï¼‰ã€‚äºŒæ¬¡ä¼šè²»ç”¨ã®ä¼šç¤¾è² æ‹…ã¯åŽŸå‰‡èªã‚ãªã„ã€‚\\n\\nç¬¬6ç«  ç²¾ç®—æœŸé™\\\
            nçµŒè²»ç™ºç”Ÿæœˆã®ç¿Œæœˆ3å–¶æ¥­æ—¥ã¾ã§ã«ã€ŒConcurã€ã«ã¦ç”³è«‹ã‚’å®Œäº†ã™ã‚‹ã“ã¨ã€‚æœŸé™ã‚’éŽãŽãŸå ´åˆã€ç†ç”±æ›¸ã®æå‡ºãŒå¿…è¦ã¨ãªã‚‹ã€‚\"\n  },\n \
            \ {\n    \"source_name\": \"ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯å‹¤å‹™è¦å®š_v2.1.pdf\",\n    \"content\": \"\
            1. å¯¾è±¡è€…\\nè©¦ç”¨æœŸé–“ï¼ˆå…¥ç¤¾3ãƒ¶æœˆï¼‰ã‚’çµ‚äº†ã—ã€æ¥­å‹™ã«æ”¯éšœãŒãªã„ã¨æ‰€å±žé•·ãŒèªã‚ãŸæ­£ç¤¾å“¡ãŠã‚ˆã³å¥‘ç´„ç¤¾å“¡ã€‚\\n\\n2. å®Ÿæ–½é »åº¦\\nåŽŸå‰‡ã¨ã—ã¦é€±3å›žï¼ˆæœˆ12å›žï¼‰ã¾ã§ã¨ã™ã‚‹ã€‚ãŸã ã—ã€è‚²å…ãƒ»ä»‹è­·äº‹ç”±ã€ã¾ãŸã¯æ„ŸæŸ“ç—‡æ‹¡å¤§é˜²æ­¢ç­‰ã®ä¼šç¤¾æŒ‡ç¤ºãŒã‚ã‚‹å ´åˆã¯ã“ã®ä¸Šé™ã‚’è§£é™¤ã™ã‚‹ã€‚\\\
            n\\n3. å°±æ¥­å ´æ‰€\\nè‡ªå®…ã€å®Ÿå®¶ã€ã¾ãŸã¯ä¼šç¤¾ãŒå¥‘ç´„ã—ã¦ã„ã‚‹ã‚·ã‚§ã‚¢ã‚ªãƒ•ã‚£ã‚¹ï¼ˆWeWorkç­‰ï¼‰ã€‚ã‚«ãƒ•ã‚§ã‚„å…¬å…±æ–½è¨­ãªã©ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŒæ‹…ä¿ã§ããªã„å ´æ‰€ï¼ˆãƒ•ãƒªãƒ¼Wi-Fiç’°å¢ƒä¸‹ãªã©ï¼‰ã§ã®æ¥­å‹™ã¯ç¦æ­¢ã™ã‚‹ã€‚\\\
            n\\n4. ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯æ‰‹å½“\\nå®Ÿæ–½1æ—¥ã«ã¤ã250å††ã‚’æ”¯çµ¦ã™ã‚‹ã€‚ã“ã‚Œã«ã¯å…‰ç†±è²»ãƒ»é€šä¿¡è²»ã®è£œåŠ©ãŒå«ã¾ã‚Œã‚‹ã€‚\\n\\n5. å‹¤æ€ ç®¡ç†\\\
            nå§‹æ¥­æ™‚ãŠã‚ˆã³çµ‚æ¥­æ™‚ã«ã€Slackã®ã€Œ#å‹¤æ€ é€£çµ¡ã€ãƒãƒ£ãƒ³ãƒãƒ«ã«ã¦å ±å‘Šã‚’è¡Œã†ã“ã¨ã€‚ä¸­æŠœã‘ï¼ˆé€šé™¢ç­‰ï¼‰ãŒã‚ã‚‹å ´åˆã‚‚åŒæ§˜ã¨ã™ã‚‹ã€‚\"\n  },\n\
            \  {\n    \"source_name\": \"å°±æ¥­è¦å‰‡_ç¬¬4ç« _ä¼‘æš‡.pdf\",\n    \"content\": \"ç¬¬12æ¡ï¼ˆå¹´æ¬¡æœ‰çµ¦ä¼‘æš‡ï¼‰\\\
            nå…¥ç¤¾æ—¥ã‹ã‚‰6ãƒ¶æœˆç¶™ç¶šå‹¤å‹™ã—ã€å…¨åŠ´åƒæ—¥ã®8å‰²ä»¥ä¸Šå‡ºå‹¤ã—ãŸç¤¾å“¡ã«å¯¾ã—ã€10æ—¥ä»˜ä¸Žã™ã‚‹ã€‚ä»¥é™ã€å‹¤ç¶šå¹´æ•°ã«å¿œã˜ã¦æœ€å¤§20æ—¥ã¾ã§ä»˜ä¸Žã™ã‚‹ã€‚æœ‰çµ¦ä¼‘æš‡ã®å–å¾—å˜ä½ã¯ã€Œ1æ—¥ã€ã€ŒåŠæ—¥ã€ã€Œ1æ™‚é–“ã€ã¨ã™ã‚‹ã€‚\\\
            n\\nç¬¬15æ¡ï¼ˆå¤å­£ä¼‘æš‡ï¼‰\\n7æœˆ1æ—¥ã‹ã‚‰9æœˆ30æ—¥ã¾ã§ã®æœŸé–“ã«ãŠã„ã¦ã€ä»»æ„ã®3æ—¥é–“ã‚’ç‰¹åˆ¥ä¼‘æš‡ï¼ˆæœ‰çµ¦ï¼‰ã¨ã—ã¦å–å¾—ã§ãã‚‹ã€‚æ¥­å‹™ã®éƒ½åˆã‚’è€ƒæ…®ã—ã€ãƒãƒ¼ãƒ å†…ã§èª¿æ•´ã®ä¸Šå–å¾—ã™ã‚‹ã“ã¨ã€‚\\\
            n\\nç¬¬18æ¡ï¼ˆæ…¶å¼”ä¼‘æš‡ï¼‰\\nä»¥ä¸‹ã®äº‹ç”±ãŒç™ºç”Ÿã—ãŸéš›ã€ç”³è«‹ã«ã‚ˆã‚Šç‰¹åˆ¥ä¼‘æš‡ã‚’ä»˜ä¸Žã™ã‚‹ã€‚\\n1. æœ¬äººãŒçµå©šã™ã‚‹ã¨ãï¼š5æ—¥\\n2. é…å¶è€…ãŒå‡ºç”£ã™ã‚‹ã¨ãï¼š2æ—¥\\\
            n3. é…å¶è€…ã€å­ã€çˆ¶æ¯ãŒæ­»äº¡ã—ãŸã¨ãï¼š5æ—¥\\n4. å…„å¼Ÿå§‰å¦¹ã€ç¥–çˆ¶æ¯ã€é…å¶è€…ã®çˆ¶æ¯ãŒæ­»äº¡ã—ãŸã¨ãï¼š3æ—¥\"\n  }\n]"
          hint: ''
          label: Mock RAG Context
          max_length: 10000
          options: []
          placeholder: ''
          required: false
          type: paragraph
          variable: mock_rag_context
        - default: 2026å¹´1æœˆ14æ—¥
          hint: ''
          label: Current Time
          max_length: 100
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: current_time
        - default: partner
          hint: ''
          label: AI Style
          max_length: 48
          options:
          - efficient
          - partner
          placeholder: ''
          required: false
          type: select
          variable: ai_style
        - default: ''
          hint: ''
          label: System Prompt
          max_length: 1000
          options: []
          placeholder: ''
          required: false
          type: paragraph
          variable: system_prompt
        - default: fileSearchStores/aiagentpoc-vky7vjg2u56p
          hint: ''
          label: Gemini Store ID
          max_length: 256
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: gemini_store_id
        - default: fast
          hint: ''
          label: Reasoning Mode
          options:
          - fast
          - deep
          placeholder: ''
          required: true
          type: select
          variable: reasoning_mode
      height: 343
      id: '1761291739140'
      position:
        x: 0
        y: 0
      positionAbsolute:
        x: 0
        y: 0
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: "{\n  \"answer\": \"### âœ… Dify API æŽ¥ç¶šæˆåŠŸ\\n\\nãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨Difyãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æŽ¥ç¶šãŒæ­£å¸¸ã«ç¢ºç«‹ã•ã‚Œã¾ã—ãŸã€‚\\\
          n\\nç¾åœ¨ã¯ **BE Mock Mode (isDebugMode=true)** ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚\\nã“ã®ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€è¤‡é›‘ãªæ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆWeb/RAGï¼‰ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€ã“ã®å›ºå®šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã—ã¦ã„ã¾ã™ã€‚\\\
          n\\n#### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—\\nå®Ÿéš›ã®æ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¸Šéƒ¨ã® **Mock Mode** ã‚’ **OFF** ã«åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„ã€‚\"\
          ,\n  \"citations\": [\n    {\n      \"id\": \"sys_check\",\n      \"type\"\
          : \"document\",\n      \"source\": \"System Status: OK\",\n      \"url\"\
          : null\n    },\n    {\n      \"id\": \"mode_check\",\n      \"type\": \"\
          web\",\n      \"source\": \"Dify Workflow Config\",\n      \"url\": \"https://cloud.dify.ai\"\
          \n    }\n  ]\n}"
        selected: false
        title: ANSWER_Mock_Mode
        type: answer
        variables: []
      height: 340
      id: answer
      position:
        x: 1046
        y: 339
      positionAbsolute:
        x: 1046
        y: 339
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: beb3e487-31db-4184-84b7-da25c8dd5a6a
            value: true
            varType: boolean
            variable_selector:
            - '1761291739140'
            - isDebugMode
          id: 'true'
          logical_operator: and
        selected: false
        title: GATE_Debug_Mode
        type: if-else
      height: 124
      id: '1762490237953'
      position:
        x: 684
        y: 110
      positionAbsolute:
        x: 684
        y: 110
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: not empty
            id: 286e9d1a-6318-4f5e-a14d-62beed119c97
            value: ''
            varType: array[file]
            variable_selector:
            - sys
            - files
          id: 'true'
          logical_operator: and
        selected: false
        title: GATE_Has_File
        type: if-else
      height: 124
      id: '1764913411735'
      position:
        x: 1408
        y: 137
      positionAbsolute:
        x: 1408
        y: 137
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        is_array_file: true
        selected: false
        title: TOOL_Doc_Extractor
        type: document-extractor
        variable_selector:
        - sys
        - files
      height: 104
      id: '1764913700839'
      position:
        x: 1770
        y: 159
      positionAbsolute:
        x: 1770
        y: 159
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        items:
        - input_type: variable
          operation: over-write
          value:
          - '1764913700839'
          - text
          variable_selector:
          - conversation
          - context_file
          write_mode: over-write
        - input_type: variable
          operation: over-write
          value:
          - '1764924171081'
          - filename
          variable_selector:
          - conversation
          - context_file_name
          write_mode: over-write
        selected: false
        title: SET_File_Context
        type: assigner
        version: '2'
      height: 110
      id: '1764913830165'
      position:
        x: 2454
        y: 156
      positionAbsolute:
        x: 2454
        y: 156
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: f1ff0762-98d8-4a18-aab1-434d65b19404
          conditions:
          - comparison_operator: is
            id: d35f5690-ac91-4988-8078-50ea5f17ae47
            value: true
            varType: boolean
            variable_selector:
            - '1761291739140'
            - rag_enabled
          - comparison_operator: not empty
            id: 55029fe2-ab26-40a4-85e7-b24b96acea1e
            value: ''
            varType: string
            variable_selector:
            - '1761291739140'
            - gemini_store_id
          - comparison_operator: is
            id: cfb7a6ee-397b-4cc7-b4b1-6f47a6eb3d98
            value: 'true'
            varType: object
            variable_selector:
            - '17708716964770'
            - structured_output
            - requires_rag
          id: f1ff0762-98d8-4a18-aab1-434d65b19404
          logical_operator: and
        selected: false
        title: GATE_RAG_Required
        type: if-else
      height: 176
      id: '1764914026588'
      position:
        x: 4244
        y: 341
      positionAbsolute:
        x: 4244
        y: 341
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 1db66d52-c4bb-4b05-a087-6a73781c2d5b
          conditions:
          - comparison_operator: is
            id: 2d8ce6d6-fef6-4012-b6f0-25092e665cd2
            value: true
            varType: boolean
            variable_selector:
            - '1761291739140'
            - web_enabled
          - comparison_operator: is
            id: 52cca867-b2dd-4d08-b672-d45fb65ecc50
            value: 'true'
            varType: object
            variable_selector:
            - '17683770269110'
            - structured_output
            - requires_web
          id: 1db66d52-c4bb-4b05-a087-6a73781c2d5b
          logical_operator: and
        selected: false
        title: GATE_Web_Search_Check
        type: if-else
      height: 150
      id: '1764914157100'
      position:
        x: 6336
        y: 432
      positionAbsolute:
        x: 6336
        y: 432
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\n\ndef main(files: list) -> dict:\n    if not files or\
          \ len(files) == 0:\n        return {\n            \"filename\": \"[]\"\n\
          \        }\n    \n    # ãƒ•ã‚¡ã‚¤ãƒ«åãƒªã‚¹ãƒˆã‚’ä½œæˆ\n    filenames = []\n    for file_obj\
          \ in files:\n        name = file_obj.get('filename') or file_obj.get('name')\
          \ or 'Uploaded File'\n        filenames.append(name)\n    \n    # JSONæ–‡å­—åˆ—ã¨ã—ã¦è¿”ã™\
          \ (ä¾‹: '[\"Difyã‚³ã‚¹ãƒˆè©¦ç®—.pdf\", \"LLMé¸å®š.pdf\"]')\n    return {\n        \"filename\"\
          : json.dumps(filenames, ensure_ascii=False)\n    }"
        code_language: python3
        outputs:
          filename:
            children: null
            type: string
        selected: false
        title: CODE_Extract_Filenames
        type: code
        variables:
        - value_selector:
          - sys
          - files
          value_type: array[file]
          variable: files
      height: 52
      id: '1764924171081'
      position:
        x: 2112
        y: 185
      positionAbsolute:
        x: 2112
        y: 185
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: contains
            id: f4266556-5380-434d-af54-f52a7611e527
            value: CHAT
            varType: string
            variable_selector:
            - '1770871743875'
            - output
          id: 'true'
          logical_operator: and
        selected: false
        title: Check Intent Type
        type: if-else
      height: 124
      id: '1765343666910'
      position:
        x: 3882
        y: 143
      positionAbsolute:
        x: 3882
        y: 143
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#17665517422840.text#}}'
        selected: false
        title: ANSWER_Chat
        type: answer
        variables: []
      height: 102
      id: '1765345427966'
      position:
        x: 4586
        y: 166
      positionAbsolute:
        x: 4586
        y: 166
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#17665511958080.text#}}'
        selected: false
        title: ANSWER_Hybrid
        type: answer
        variables: []
      height: 102
      id: '1765345440190'
      position:
        x: 10100
        y: 507
      positionAbsolute:
        x: 10100
        y: 507
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\nimport re\n\ndef main(files: list, context_rag: str, context_web:\
          \ str, context_file: str, intent_result: str) -> dict:\n    \"\"\"\n   \
          \ Route Decision Logic v4.1 (Pure Context-based Routing)\n    \"\"\"\n \
          \   \n    # --- 1. ã‚«ãƒ†ã‚´ãƒªã®å–å¾— (TASK or CHAT) ---\n    category = \"TASK\"\n\
          \    try:\n        clean_text = re.sub(r'```(?:json)?\\s*|\\s*```', '',\
          \ intent_result.strip())\n        intent_data = json.loads(clean_text)\n\
          \        category = intent_data.get('category', 'TASK')\n    except Exception:\n\
          \        pass\n\n    # --- 2. é›‘è«‡ã®å³æ™‚ãƒã‚¤ãƒ‘ã‚¹ ---\n    # ç´”ç²‹ãªé›‘è«‡ãƒ»æŒ¨æ‹¶ (CHAT) ã®å ´åˆã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç„¡è¦–ã—ã¦å³åº§ã«GENERALã¸\n\
          \    if category == \"CHAT\":\n        return {\"route\": \"GENERAL\"}\n\
          \n    # --- 3. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å®Ÿä½“ã®æœ‰ç„¡ã‚’åˆ¤å®š ---\n    # ãƒ•ã‚¡ã‚¤ãƒ«: æ–°è¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ã¾ãŸã¯ å±¥æ­´å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«\n\
          \    has_file = (files is not None and len(files) > 0) or bool(context_file\
          \ and len(str(context_file).strip()) > 50)\n    \n    # RAG/Web: æ–‡å­—åˆ—ãŒå­˜åœ¨ã—ã€ã‹ã¤ä¸€å®šã®é•·ã•ãŒã‚ã‚‹ã‹ã ã‘ã§åˆ¤å®š\n\
          \    # â€»Pre-Checkã§ãƒã‚¤ãƒ‘ã‚¹ã•ã‚Œã¦ã‚‚ã€éŽåŽ»ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒä¿æŒã•ã‚Œã¦ã„ã‚Œã°Trueã¨ãªã‚‹\n    has_rag = bool(context_rag\
          \ and len(str(context_rag).strip()) > 10)\n    has_web = bool(context_web\
          \ and len(str(context_web).strip()) > 10)\n\n    # --- 4. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ±ºå®š (Standard\
          \ Matrix) ---\n    route = \"GENERAL\"\n    \n    if has_file:\n       \
          \ if has_rag or has_web:\n            route = \"HYBRID\"\n        else:\n\
          \            route = \"DOCUMENT\"\n    else:\n        if has_rag and has_web:\n\
          \            route = \"HYBRID\"\n        elif has_rag or has_web:\n    \
          \        route = \"SEARCH\"\n        else:\n            route = \"GENERAL\"\
          \n            \n    return {\n        \"route\": route\n    }"
        code_language: python3
        desc: Pattern Router
        outputs:
          route:
            children: null
            type: string
        selected: false
        title: CODE_Route_Decision
        type: code
        variables:
        - value_selector:
          - sys
          - files
          value_type: array[file]
          variable: files
        - value_selector:
          - conversation
          - context_rag
          value_type: string
          variable: context_rag
        - value_selector:
          - conversation
          - context_web
          value_type: string
          variable: context_web
        - value_selector:
          - conversation
          - context_file
          value_type: array[string]
          variable: context_file
        - value_selector:
          - '1770871743875'
          - output
          value_type: string
          variable: intent_result
      height: 80
      id: '1765514869301'
      position:
        x: 9054
        y: 663
      positionAbsolute:
        x: 9054
        y: 663
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 28e4a5f2-b3b8-4efb-ae77-2d478f9369b3
            value: HYBRID
            varType: string
            variable_selector:
            - '1765514869301'
            - route
          id: 'true'
          logical_operator: and
        - case_id: 908d672e-4c25-44ac-9ee9-4f7fb1b32144
          conditions:
          - comparison_operator: is
            id: 9cc6ad8c-eff8-42b0-b5c0-d3b1afcb8ef0
            value: DOCUMENT
            varType: string
            variable_selector:
            - '1765514869301'
            - route
          id: 908d672e-4c25-44ac-9ee9-4f7fb1b32144
          logical_operator: and
        - case_id: f10e65ad-bb00-4cdf-aabf-78811af1ba70
          conditions:
          - comparison_operator: is
            id: da0a43ed-0eb0-4602-9aff-b68d900906ef
            value: SEARCH
            varType: string
            variable_selector:
            - '1765514869301'
            - route
          id: f10e65ad-bb00-4cdf-aabf-78811af1ba70
          logical_operator: and
        selected: false
        title: ROUTER_Response_Pattern
        type: if-else
      height: 220
      id: '1765515071449'
      position:
        x: 9396
        y: 593
      positionAbsolute:
        x: 9396
        y: 593
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#17665512107830.text#}}'
        selected: false
        title: ANSWER_Document
        type: answer
        variables: []
      height: 102
      id: '17655153615920'
      position:
        x: 10100
        y: 689
      positionAbsolute:
        x: 10100
        y: 689
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#17665512248470.text#}}'
        selected: false
        title: ANSWER_Search
        type: answer
        variables: []
      height: 102
      id: '17655153626170'
      position:
        x: 10100
        y: 1053
      positionAbsolute:
        x: 10100
        y: 1053
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#17665512406710.text#}}'
        selected: false
        title: ANSWER_General
        type: answer
        variables: []
      height: 102
      id: '17655153635450'
      position:
        x: 10100
        y: 871
      positionAbsolute:
        x: 10100
        y: 871
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 7afb1642-a224-48e2-842b-1395cef1bc3e
            value: false
            varType: boolean
            variable_selector:
            - '1761291739140'
            - rag_enabled
          - comparison_operator: is
            id: 8ebf5e62-bce5-4839-a29a-44973d2b4441
            value: false
            varType: boolean
            variable_selector:
            - '1761291739140'
            - web_enabled
          id: 'true'
          logical_operator: and
        selected: false
        title: GATE_Fast_Mode
        type: if-else
      height: 150
      id: '1765854025663'
      position:
        x: 1046
        y: 109
      positionAbsolute:
        x: 1046
        y: 109
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#17665499392760.text#}}'
        selected: false
        title: ANSWER_Fast_Doc
        type: answer
        variables: []
      height: 102
      id: '1765854668107'
      position:
        x: 3500
        y: 409
      positionAbsolute:
        x: 3500
        y: 409
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: not empty
            id: 286e9d1a-6318-4f5e-a14d-62beed119c97
            value: ''
            varType: array[file]
            variable_selector:
            - sys
            - files
          id: 'true'
          logical_operator: and
        - case_id: 0703a046-f8f7-4b0e-b07b-3794eaee8f40
          conditions:
          - comparison_operator: not empty
            id: 6a3fe844-0041-4555-863b-878dd9045be9
            value: ''
            varType: array[string]
            variable_selector:
            - conversation
            - context_file
          id: 0703a046-f8f7-4b0e-b07b-3794eaee8f40
          logical_operator: and
        selected: false
        title: GATE_Has_File_Fast
        type: if-else
      height: 172
      id: '17658598785120'
      position:
        x: 1408
        y: 341
      positionAbsolute:
        x: 1408
        y: 341
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        is_array_file: true
        selected: false
        title: TOOL_Doc_Extractor
        type: document-extractor
        variable_selector:
        - sys
        - files
      height: 104
      id: '17658598785131'
      position:
        x: 1770
        y: 387
      positionAbsolute:
        x: 1770
        y: 387
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        items:
        - input_type: variable
          operation: over-write
          value:
          - '17658598785131'
          - text
          variable_selector:
          - conversation
          - context_file
          write_mode: over-write
        - input_type: variable
          operation: over-write
          value:
          - '17658598785133'
          - filename
          variable_selector:
          - conversation
          - context_file_name
          write_mode: over-write
        selected: false
        title: SET_Fast_File_Context
        type: assigner
        version: '2'
      height: 110
      id: '17658598785132'
      position:
        x: 2454
        y: 384
      positionAbsolute:
        x: 2454
        y: 384
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\n\ndef main(files: list) -> dict:\n    if not files or\
          \ len(files) == 0:\n        return {\n            \"filename\": \"[]\"\n\
          \        }\n    \n    # ãƒ•ã‚¡ã‚¤ãƒ«åãƒªã‚¹ãƒˆã‚’ä½œæˆ\n    filenames = []\n    for file_obj\
          \ in files:\n        name = file_obj.get('filename') or file_obj.get('name')\
          \ or 'Uploaded File'\n        filenames.append(name)\n    \n    # JSONæ–‡å­—åˆ—ã¨ã—ã¦è¿”ã™\
          \ (ä¾‹: '[\"Difyã‚³ã‚¹ãƒˆè©¦ç®—.pdf\", \"LLMé¸å®š.pdf\"]')\n    return {\n        \"filename\"\
          : json.dumps(filenames, ensure_ascii=False)\n    }"
        code_language: python3
        outputs:
          filename:
            children: null
            type: string
        selected: false
        title: CODE_Extract_Filenames_Fast
        type: code
        variables:
        - value_selector:
          - sys
          - files
          value_type: array[file]
          variable: files
      height: 52
      id: '17658598785133'
      position:
        x: 2112
        y: 413
      positionAbsolute:
        x: 2112
        y: 413
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#17665500976990.text#}}'
        selected: false
        title: ANSWER_Fast_General
        type: answer
        variables: []
      height: 102
      id: '1765859958399'
      position:
        x: 2112
        y: 595
      positionAbsolute:
        x: 2112
        y: 595
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: c54b374b-43c4-4785-a85e-4e101e2065d2
            value: efficient
            varType: string
            variable_selector:
            - '1761291739140'
            - ai_style
          id: 'true'
          logical_operator: and
        selected: false
        title: STYLE_Check_Fast_Doc
        type: if-else
      height: 124
      id: '1766549782668'
      position:
        x: 2816
        y: 398
      positionAbsolute:
        x: 2816
        y: 398
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 10
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash
          provider: langgenius/gemini/google
        prompt_template:
        - id: 719bbb6f-05b6-40cb-a9ed-ddbf798ce542
          role: system
          text: "# Role\nã‚ãªãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸè³‡æ–™ã‚’ã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ãƒ¼ã‹ã¤ä¸å¯§ã«èª­ã¿è§£ãã€Œãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåˆ†æžãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€ã§ã™ã€‚\n\
            **æä¾›ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã®ã¿**ã«åŸºã¥ãã€JSONå½¢å¼ã§å›žç­”ã—ã¦ãã ã•ã„ã€‚\n\n\n\n# Intelligence Profile\
            \ (Dynamic Context)\nä»¥ä¸‹ã®JSONãƒ‡ãƒ¼ã‚¿ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å±žæ€§ã¨ã‚«ã‚¹ã‚¿ãƒ æŒ‡ç¤ºãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\nã“ã®è¨­å®šã«åŸºã¥ãã€è³‡æ–™ã®ä¸­ã‹ã‚‰**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã‚‹ã¹ããƒã‚¤ãƒ³ãƒˆ**ã‚’å¼·èª¿ã—ã¦ãã ã•ã„ã€‚\n\
            \n<system_prompt_json>\n{{#1761291739140.system_prompt#}}\n</system_prompt_json>\n\
            \n## Profile Rules\n1. **user_context (ç€çœ¼ç‚¹ã®èª¿æ•´)**:\n   - `role`: è³‡æ–™ã®ã©ã“ã«æ³¨ç›®ã™ã¹ãã‹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½¹å‰²ã‹ã‚‰æŽ¨æ¸¬ã—ã¦ãã ã•ã„ã€‚\n\
            \     - ãƒžãƒãƒ¼ã‚¸ãƒ£ãƒ¼å±¤ã«ã¯ã€Œäºˆç®—ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»èª²é¡Œã€ã‚’å¤ªå­—ã§å¼·èª¿ã€‚\n     - ç¾å ´æ‹…å½“è€…ã«ã¯ã€Œæ‰‹é †ãƒ»ä»•æ§˜ãƒ»æ‹…å½“ç¯„å›²ã€ã‚’å¤ªå­—ã§å¼·èª¿ã€‚\n\
            \n2. **custom_directives**:\n   - `free_text`: ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®åˆ†æžæŒ‡ç¤ºï¼ˆä¾‹ï¼šã€Œãƒªã‚¹ã‚¯æ¤œçŸ¥ã‚’å„ªå…ˆã—ã¦ã€ï¼‰ãŒã‚ã‚Œã°ã€ãã‚Œã«å¾“ã£ã¦ãã ã•ã„ã€‚\n\
            \n\n\n# Guidelines\n1. **Style (Partner Mode)**:\n   - **Tone**: è¦ªã—ã¿ã‚„ã™ãä¸å¯§ãªã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚\n\
            \   - **Structure**: è¦‹å‡ºã—ï¼ˆ###ï¼‰ã¨çµµæ–‡å­—ã‚’ä½¿ã„ã€èª­ã¿ã‚„ã™ãæ§‹æˆã—ã¦ãã ã•ã„ã€‚\n   - **Emoji Balance**:\
            \ 1æ®µè½ã«ã¤ã1ã¤ç¨‹åº¦ã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªçµµæ–‡å­—ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚\n\n2. **JSON Output Rule**:\n   - å¿…ãšä»¥ä¸‹ã®JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚Markdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚\n\
            \   - `thinking`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒã‚¤ãƒ³ãƒˆã‚’Markdownã®ç®‡æ¡æ›¸ãã§è¨˜è¿°ï¼ˆæ”¹è¡Œã¯ `\\n`ï¼‰ã€‚\n \
            \  - `answer`: å›žç­”æœ¬æ–‡ã‚’Markdownã§è¨˜è¿°ï¼ˆæ”¹è¡Œã¯ `\\n`ï¼‰ã€‚\n   - `citations`: é«˜é€Ÿãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚ã€å¿…ãšç©ºé…åˆ—\
            \ `[]` ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\n# Input Data\n## 1. File Names\n{{#conversation.context_file_name#}}\n\
            \n## 2. File Content\n{{#conversation.context_file#}}\n\n# User Query\n\
            {{#1770869430347.text#}}\n\n# Output Example\n{\n  \"thinking\": \"- **æ„å›³**:\
            \ äºˆç®—ã®ç¢ºèªã€‚\\n- **æ³¨ç›®**: ãƒžãƒãƒ¼ã‚¸ãƒ£ãƒ¼å±¤ã®ãŸã‚ã€åˆè¨ˆé‡‘é¡ã‚’å¼·èª¿ã™ã‚‹ã€‚\",\n  \"answer\": \"äºˆç®—ã«ã¤ã„ã¦ã§ã™ã­ï¼\\\
            uD83D\\uDCB0\\n\\nè³‡æ–™ã«ã‚ˆã‚‹ã¨ã€åˆè¨ˆã§**500ä¸‡å††**ã¨ãªã£ã¦ã„ã¾ã™ã€‚\",\n  \"citations\": []\n\
            }"
        selected: false
        title: LLM_Fast_Doc_
        type: llm
        vision:
          enabled: false
      height: 88
      id: '17665499392760'
      position:
        x: 3158
        y: 416
      positionAbsolute:
        x: 3158
        y: 416
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 10
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash
          provider: langgenius/gemini/google
        prompt_template:
        - id: 719bbb6f-05b6-40cb-a9ed-ddbf798ce542
          role: system
          text: "\n# Role\nã‚ãªãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±ã‚’é€šã˜ã¦æ€è€ƒã‚’æ•´ç†ã™ã‚‹ã€ŒAIãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€ã§ã™ã€‚\nç¾åœ¨ã€**Webæ¤œç´¢ã‚„ç¤¾å†…è¦å®šã‚’å‚ç…§ã—ãªã„ã€Œé«˜é€Ÿãƒ¢ãƒ¼ãƒ‰ã€**ã§å‹•ä½œã—ã¦ã„ã¾ã™ã€‚JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\
            \n\n# Intelligence Profile (Dynamic Context)\nä»¥ä¸‹ã®JSONãƒ‡ãƒ¼ã‚¿ã«ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼å±žæ€§ã€ã¨ã€Œã‚«ã‚¹ã‚¿ãƒ æŒ‡ç¤ºã€ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\n\
            ã“ã®è¨­å®šã‚’**æœ€å„ªå…ˆã®åˆ¶ç´„äº‹é …**ã¨ã—ã¦è§£é‡ˆã—ã€è‡ªèº«ã®æŒ¯ã‚‹èˆžã„ï¼ˆRoleï¼‰ã‚„å£èª¿ã‚’å‹•çš„ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚\n\n<system_prompt_json>\n\
            {{#1761291739140.system_prompt#}}\n</system_prompt_json>\n\n## Profile\
            \ Rules\n1. **user_context (ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè­˜)**:\n   - `name`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‘¼ã³åã§ã™ã€‚ä¼šè©±ã®å†’é ­ã‚„ç¯€ç›®ã§è‡ªç„¶ã«åå‰ã‚’å‘¼ã‚“ã§ã€è¦ªè¿‘æ„Ÿã‚’æ¼”å‡ºã—ã¦ãã ã•ã„ã€‚\n\
            \   - `role` / `department`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½¹è·ã‚„éƒ¨ç½²ã§ã™ã€‚ã“ã‚Œã«åŸºã¥ãã€å›žç­”ã®å°‚é–€æ€§ãƒ¬ãƒ™ãƒ«ï¼ˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å‘ã‘ãªã‚‰æŠ€è¡“çš„ã«ã€å–¶æ¥­å‘ã‘ãªã‚‰ãƒ“ã‚¸ãƒã‚¹ãƒ©ã‚¤ã‚¯ã«ï¼‰ã‚’è‡ªå‹•èª¿æ•´ã—ã¦ãã ã•ã„ã€‚\n\
            \n2. **custom_directives (å„ªå…ˆæŒ‡ç¤º)**:\n   - `free_text`: ã“ã“ã«è¨˜è¼‰ã•ã‚ŒãŸæŒ‡ç¤ºï¼ˆä¾‹ï¼šã€Œè‹±èªžã§ç­”ãˆã¦ã€ã€Œçµè«–ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§ã€ã€Œçµµæ–‡å­—å¤šã‚ã§ã€ãªã©ï¼‰ã¯ã€å¾Œè¿°ã™ã‚‹\
            \ Guidelines ã‚ˆã‚Šã‚‚**å„ªå…ˆ**ã—ã¦é©ç”¨ã—ã¦ãã ã•ã„ã€‚\n\n\n# Guidelines\n1. **Style (Partner\
            \ Mode)**:\n   - **Tone**: è¦ªã—ã¿ã‚„ã™ãä¸å¯§ãªã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚\n   - **Structure**: è¦‹å‡ºã—ï¼ˆ###ï¼‰ã¨çµµæ–‡å­—ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚\n\
            \   - **Greeting**: ä¼šè©±ã®æ–‡è„ˆã«åˆã‚ã›ã¦è‡ªç„¶ãªæŒ¨æ‹¶ã‚’å«ã‚ã¦ãã ã•ã„ã€‚\n\n2. **JSON Output Rule**:\n\
            \   - å¿…ãšä»¥ä¸‹ã®JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚Markdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚\n   - `thinking`:\
            \ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å…±æ„Ÿã‚„å¯¾è©±æˆ¦ç•¥ã‚’Markdownã®ç®‡æ¡æ›¸ãã§è¨˜è¿°ï¼ˆæ”¹è¡Œã¯ `\\n`ï¼‰ã€‚\n   - `answer`: å›žç­”æœ¬æ–‡ã‚’Markdownã§è¨˜è¿°ï¼ˆæ”¹è¡Œã¯\
            \ `\\n`ï¼‰ã€‚\n   - `citations`: å¿…ãšç©ºé…åˆ— `[]` ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\n# Input Data\n-\
            \ Current Time: {{#1761291739140.current_time#}}\n\n# User Query\n{{#1770869430347.text#}}\n\
            \n# Output Example\n{\n  \"thinking\": \"- **åˆ†æž**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¢ã‚¤ãƒ‡ã‚¢å‡ºã—ã«è©°ã¾ã£ã¦ã„ã‚‹æ§˜å­ã€‚\\\
            n- **æˆ¦ç•¥**: åŠ±ã¾ã—ãªãŒã‚‰ãƒ–ãƒ¬ã‚¹ãƒˆã‚’ææ¡ˆã™ã‚‹ã€‚\",\n  \"answer\": \"ã“ã‚“ã«ã¡ã¯ï¼\\n\\nã‚¢ã‚¤ãƒ‡ã‚¢å‡ºã—ã§ã™ã­ã€å–œã‚“ã§ãŠæ‰‹ä¼ã„ã—ã¾ã™ï¼\\\
            nã¾ãšã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã„ãã¤ã‹æŒ™ã’ã¦ã¿ã¾ã—ã‚‡ã†ã‹ï¼Ÿ\",\n  \"citations\": []\n}"
        selected: false
        title: LLM_Fast_General
        type: llm
        vision:
          enabled: false
      height: 88
      id: '17665500976990'
      position:
        x: 1770
        y: 602
      positionAbsolute:
        x: 1770
        y: 602
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 10
        model:
          completion_params:
            temperature: 0.2
            top_p: 0.75
          mode: chat
          name: gemini-2.5-flash
          provider: langgenius/gemini/google
        prompt_template:
        - id: 3cdd3bc0-7d7f-4ce9-b50f-7cb504ae0691
          role: system
          text: "# Role\nã‚ãªãŸã¯ã€ç¤¾å†…å¤–ã®æƒ…å ±ã‚’çµ±åˆã—ã¦JSONãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹ã€ŒAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€ã§ã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é ¼ã‚Œã‚‹ã€ŒAIãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€ã§ã™ã€‚\n\
            ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®è¦ªåˆ‡ãªå›žç­”ã‚’ä½œæˆã—ã€ãã‚Œã‚’**JSONå½¢å¼ã® `answer` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«æ ¼ç´ã—ã¦**å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\n# Intelligence\
            \ Profile (Dynamic Context)\nä»¥ä¸‹ã®JSONãƒ‡ãƒ¼ã‚¿ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å±žæ€§ã¨ã‚«ã‚¹ã‚¿ãƒ æŒ‡ç¤ºãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\nã“ã®è¨­å®šã‚’**æœ€å„ªå…ˆã®åˆ¶ç´„äº‹é …**ã¨ã—ã¦è§£é‡ˆã—ã€æƒ…å ±æä¾›ã®ãƒ¬ãƒ™ãƒ«æ„Ÿã‚’è‡ªå‹•èª¿æ•´ã—ã¦ãã ã•ã„ã€‚\n\
            \n<system_prompt_json>\n{{#1761291739140.system_prompt#}}\n</system_prompt_json>\n\
            \n## Profile Rules\n1. **user_context (å°‚é–€æ€§ã®èª¿æ•´)**:\n   - `department` /\
            \ `role`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å±žæ€§ã«åˆã‚ã›ã¦ã€å›žç­”ã®ã€Œå°‚é–€æ€§ã€ã¨ã€Œè¦–ç‚¹ã€ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚\n     - ä¾‹ï¼ˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®å ´åˆï¼‰: æŠ€è¡“çš„ãªè©³ç´°ã€ã‚³ãƒ¼ãƒ‰ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã®è¨€åŠã‚’å¢—ã‚„ã™ã€‚\n\
            \     - ä¾‹ï¼ˆçµŒå–¶å±¤ã®å ´åˆï¼‰: çµè«–ã€ã‚³ã‚¹ãƒˆã€ãƒªã‚¹ã‚¯ã€ãƒ“ã‚¸ãƒã‚¹ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã‚’å„ªå…ˆã™ã‚‹ã€‚\n   - `name`: å†’é ­ã®æŒ¨æ‹¶ã§è‡ªç„¶ã«åå‰ã‚’å‘¼ã³ã€ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨ã—ã¦ã®ä¿¡é ¼æ„Ÿã‚’é†¸æˆã—ã¦ãã ã•ã„ã€‚\n\
            \n2. **custom_directives (å½¢å¼ã®å¼·åˆ¶)**:\n   - `free_text`: ã€ŒMarkdownã®è¡¨ã§ã€ã€Œè‹±èªžã§ã€ã€Œ3ç‚¹è¦ç´„ã§ã€ãªã©ã®å‡ºåŠ›å½¢å¼æŒ‡å®šãŒã‚ã‚‹å ´åˆã€**å¾Œè¿°ã®Guidelinesã‚ˆã‚Šã‚‚å„ªå…ˆ**ã—ã¦é©ç”¨ã—ã¦ãã ã•ã„ã€‚\n\
            \n# Guidelines\n\n1. **Style (Partner Mode)**:\n   - **Tone**: è¦ªã—ã¿ã‚„ã™ãä¸å¯§ãªã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚\n\
            \   - **Structure (æ§‹é€ åŒ–)**:\n     - é•·æ–‡ã«ãªã‚‹å ´åˆã¯ã€èª­ã¿ã‚„ã™ã•ã‚’é«˜ã‚ã‚‹ãŸã‚ã«**è¦‹å‡ºã—ï¼ˆ###ï¼‰**ã‚’ä½¿ã£ã¦æ§‹æˆã‚’æ•´ç†ã—ã¦ãã ã•ã„ã€‚\n\
            \     - äº‹å‹™çš„ãªå°è±¡ã‚’é¿ã‘ã‚‹ãŸã‚ã€è¦‹å‡ºã—ã«ã¯å†…å®¹ã«åˆã£ãŸ**çµµæ–‡å­—**ã‚’æ·»ãˆã¦ãã ã•ã„ï¼ˆä¾‹: `### \U0001F4A1 ãƒã‚¤ãƒ³ãƒˆ`,\
            \ `### \U0001F50D èª¿æŸ»çµæžœ`, `### âš ï¸ æ³¨æ„ç‚¹`ï¼‰ã€‚\n- **Volume & Synthesis (é‡è¦)**:\n\
            \  - å˜ã«å„æƒ…å ±æºã®å†…å®¹ã‚’è¦ç´„ã—ã¦ç¹‹ã’ã‚‹ã®ã§ã¯ãªãã€ãã‚Œãžã‚Œã®æƒ…å ±ã‚’ç…§ã‚‰ã—åˆã‚ã›ã€å¤šè§’çš„ãªè¦–ç‚¹ï¼ˆç¤¾å†…ãƒ«ãƒ¼ãƒ«ã¨ä¸–é–“ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã®æ¯”è¼ƒãªã©ï¼‰ã‹ã‚‰æ·±ãè§£èª¬ã—ã¦ãã ã•ã„ã€‚\n\
            \  - æƒ…å ±æºåŒå£«ã«å·®ç•°ãŒã‚ã‚‹å ´åˆã¯ã€ãã‚Œã‚’çœç•¥ã›ãšã€Œä¸€èˆ¬çš„ã«ã¯ã“ã†ã§ã™ãŒã€å½“ç¤¾ã®è¦å®šã§ã¯ã“ã†ãªã£ã¦ã„ã¾ã™ã€ã¨æ˜Žç¢ºã«å¯¾æ¯”ã•ã›ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ¤æ–­ã—ã‚„ã™ã„è©³ç´°ãªãƒ¬ãƒãƒ¼ãƒˆã«ä»•ä¸Šã’ã¦ãã ã•ã„ã€‚\n\
            \  - çµè«–ã ã‘ã§ãªãã€ãã®æ ¹æ‹ ã¨ãªã‚‹è©³ç´°ãªãƒ‡ãƒ¼ã‚¿ã‚„æ¡ä»¶ã‚‚ç¶²ç¾…ã—ã€èª­ã¿å¿œãˆã®ã‚ã‚‹æ§‹æˆã«ã—ã¦ãã ã•ã„ã€‚\nã€€- **Emoji Balance\
            \ (é‡è¦)**:\n     - æ–‡ã®æœ«å°¾ã‚„åŒºåˆ‡ã‚Šã®è‰¯ã„ç®‡æ‰€ã«ã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªçµµæ–‡å­—ï¼ˆâœ¨, \U0001F60A, \U0001F375,\
            \ âœ…, \U0001F680ï¼‰ã‚’é©åº¦ã«æ·»ãˆã¦ã€ãƒˆãƒ¼ãƒ³ã‚’æ˜Žã‚‹ãã—ã¦ãã ã•ã„ã€‚\n     - **åˆ¶ç´„**: è¦‹å‡ºã—ï¼ˆ###ï¼‰ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¦–è¦šçš„ãªãƒ©ãƒ³ãƒ‰ãƒžãƒ¼ã‚¯ï¼ˆä¸»å½¹ï¼‰ã¨ã™ã‚‹ãŸã‚ã€æœ¬æ–‡ä¸­ã®çµµæ–‡å­—ã¯**1æ®µè½ã«ã¤ã1ã¤ç¨‹åº¦**ã«ç•™ã‚ã€ç”»é¢ãŒã†ã‚‹ã•ããªã‚‰ãªã„ã‚ˆã†èª¿æ•´ã—ã¦ãã ã•ã„ã€‚\n\
            \   - **Visual**: \n     - é‡è¦ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯Markdownã® **å¤ªå­—** ã§å¼·èª¿ã—ã¦ãã ã•ã„ã€‚\n\n###\
            \ Greeting & Opening Protocol (é‡è¦: æŒ¨æ‹¶ãƒ»å‰ç½®ãç¦æ­¢)\n- **Absolute Prohibition**:\
            \ ã€Œã“ã‚“ã«ã¡ã¯ã€ã€ŒãŠå¾…ãŸã›ã—ã¾ã—ãŸã€ãªã©ã®æŒ¨æ‹¶ã‚„ã€ã€ŒWebã¨ç¤¾å†…è³‡æ–™ã‚’ç¢ºèªã—ãŸçµæžœã€ä»¥ä¸‹ã®ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€ã¨ã„ã£ãŸ**ãƒ¡ã‚¿ãªå‰ç½®ãã¯ä¸€åˆ‡ç¦æ­¢**ã—ã¾ã™ã€‚\n\
            - **Reason**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®æŒ¨æ‹¶ã‚„çŠ¶æ³èª¬æ˜Žã¯ã€å‰æ®µã® `Intent Analysis` ãƒŽãƒ¼ãƒ‰ã§ã™ã§ã«å®Œäº†ã—ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã®é‡è¤‡ã¯UXã‚’è‘—ã—ãæãªã„ã¾ã™ã€‚\n\
            - **Action**: \n  - å†’é ­ã®0ç§’ç›®ã‹ã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å•ã„ã«å¯¾ã™ã‚‹**æ ¸å¿ƒçš„ãªå›žç­”ï¼ˆçµè«–ï¼‰**ã¾ãŸã¯**è¦‹å‡ºã—ï¼ˆ###ï¼‰**ã§æ›¸ãå§‹ã‚ã¦ãã ã•ã„ã€‚\n\
            \  - æ–‡è„ˆã®æŽ¥ç¶šè©žï¼ˆä¾‹ï¼šã€Œçµè«–ã‹ã‚‰ç”³ã—ä¸Šã’ã¾ã™ã¨ã€ã€Œãã®ä»¶ã«ã¤ã„ã¦ã¯ã€ï¼‰ã‚‚æ¥µåŠ›çœç•¥ã—ã€æƒ…å ±ã®æç¤ºã«å¾¹ã—ã¦ãã ã•ã„ã€‚\n\n\n3. **Citation\
            \ Rule (é‡è¦: å‡ºå…¸ã®è¡¨è¨˜ã¨çµ±åˆ)**:\n   - **Format**: æ–‡ä¸­ã®å¼•ç”¨ç•ªå·ã¯ `[1][2]` ã®ã‚ˆã†ã«**å€‹åˆ¥ã®ãƒ–ãƒ©ã‚±ãƒƒãƒˆ**ã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚`[1,\
            \ 2]` ã®ã‚ˆã†ãªã‚«ãƒ³ãƒžåŒºåˆ‡ã‚Šã¯**ç¦æ­¢**ã§ã™ã€‚\n   - **Renumbering**: ä»¥ä¸‹ã®å„ªå…ˆé †ä½ã§ã€**å®Ÿéš›ã«ä½¿ç”¨ã—ãŸï¼ˆä¸­èº«ãŒå­˜åœ¨ã™ã‚‹ï¼‰æƒ…å ±æºã®ã¿**ã‚’\
            \ `[1]` ã‹ã‚‰é€£ç•ªã§æŽ¡ç•ªã—ç›´ã—ã¦ãã ã•ã„ã€‚\n     1. **User Uploaded Files** (`type`: \"\
            document\")\n     2. **Internal Knowledge (RAG)** (`type`: \"rag\")\n\
            \     3. **Web Search Results** (`type`: \"web\")\n   - **Consistency**:\
            \ å›žç­”æœ¬æ–‡ä¸­ã®å¼•ç”¨ç•ªå· `[n]` ã¯ã€å¿…ãšã“ã®**æ–°ã—ã„é€šã—ç•ªå·**ã¨ä¸€è‡´ã•ã›ã¦ãã ã•ã„ã€‚\n\n# Input Data\n\n##\
            \ 0. Context Data\n- Current Time: {{#1761291739140.current_time#}}\n\n\
            ## 1. User Uploaded Files (Target Document)\n- File Names: {{#conversation.context_file_name#}}\n\
            - Content: {{#conversation.context_file#}}\nâ€»ã“ã“ãŒç©ºã®å ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ·»ä»˜ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\
            \n## 2. Internal Knowledge (RAG)\n{{#conversation.context_rag#}}\nâ€»ã“ã“ãŒç©ºã®å ´åˆã€ç¤¾å†…è¦å®šã¯å‚ç…§ã—ã¦ã„ã¾ã›ã‚“ã€‚\n\
            \n## 3. Web Search Results\n{{#conversation.context_web#}}\nâ€»ã“ã“ãŒç©ºã®å ´åˆã€Webæ¤œç´¢ã¯è¡Œã£ã¦ã„ã¾ã›ã‚“ã€‚\n\
            \n# User Query\n{{#1770869430347.text#}}\n\n# Processing Steps (Mental\
            \ Chain)\n1. **æƒ…å ±æºã®æœ‰ç„¡åˆ¤å®š**:\n   - `Content` (Files) ã¯ç©ºã‹ï¼Ÿ\n   - `Internal\
            \ Knowledge` (RAG) ã¯ç©ºã‹ï¼Ÿ\n   - `Web Search Results` (Web) ã¯ç©ºã‹ï¼Ÿ\n   - **ç©ºã§ã‚ã‚‹æƒ…å ±æºã¯ã€ä»¥ä¸‹ã®å‡ºå…¸ãƒªã‚¹ãƒˆä½œæˆãŠã‚ˆã³å›žç­”ç”Ÿæˆã«ãŠã„ã¦çµ¶å¯¾ã«ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚**\n\
            \n2. **å‡ºå…¸ãƒªã‚¹ãƒˆã®æ§‹ç¯‰**:\n   - ä¸Šè¨˜åˆ¤å®šã§ã€Œç©ºã§ã¯ãªã„ã€ã¨åˆ¤æ–­ã•ã‚ŒãŸã‚‚ã®ã ã‘ã‚’ `citations` ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã€é€£ç•ªã‚’æŒ¯ã‚Šã¾ã™ã€‚\n\
            \n3. **å›žç­”ã®ç”Ÿæˆ**:\n   - ã‚¹ãƒ†ãƒƒãƒ—1ã§ç¢ºèªã—ãŸã€Œå­˜åœ¨ã™ã‚‹æƒ…å ±æºã€ã®çµ„ã¿åˆã‚ã›ã«åŸºã¥ã„ã¦ã€å°Žå…¥ã®æŒ¨æ‹¶ã‚’ä½œæˆã—ã¾ã™ã€‚\n  \
            \ - æƒ…å ±ã‚’æ•´ç†ã—ã€è¦‹å‡ºã—ï¼ˆ###ï¼‰ã‚’ä½¿ã£ã¦æ§‹é€ åŒ–ã—ã¦è¨˜è¿°ã—ã¾ã™ã€‚\n   - æ ¹æ‹ ã¨ãªã‚‹ç®‡æ‰€ã«ã¯ã‚¹ãƒ†ãƒƒãƒ—2ã®ç•ªå·ï¼ˆä¾‹: `[1]`) ã‚’ä»˜è¨˜ã—ã¾ã™ã€‚\n\
            \n4. **JSONå‡ºåŠ›**:\n   - æ§‹ç¯‰ã—ãŸæƒ…å ±ã‚’JSONå½¢å¼ã«å¤‰æ›ã—ã¾ã™ã€‚\n\n# Processing Steps (Partner\
            \ Chain)\nå›žç­”ã®å‡ºåŠ›ã‚’ä½œæˆã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã®æ‰‹é †ã§æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã‚’æ•´ç†ã—ã€`thinking` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«**Markdownã®ç®‡æ¡æ›¸ã**ï¼ˆæ—¥æœ¬èªžï¼‰ã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚\n\
            \n1. **æ€è€ƒã‚¹ã‚¿ã‚¤ãƒ«**:\n   - ã‚ãªãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã€Œç›¸è«‡ç›¸æ‰‹ã€ã§ã™ã€‚äº‹å®Ÿã ã‘ã§ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çŠ¶æ³ã‚„æ„Ÿæƒ…ï¼ˆä¸å®‰ã€æ€¥ãŽç­‰ï¼‰ã‚’**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³**ã¨ã—ã¦æ±²ã¿å–ã£ã¦ãã ã•ã„ã€‚\n\
            \n2. **æ€è€ƒé …ç›® (Thinking Fields)**:\n   - **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³**: è³ªå•ã®èƒŒæ™¯ã«ã‚ã‚‹çœŸã®ç›®çš„ã‚„æ„Ÿæƒ…ã€‚\n\
            \   - **ç…§åˆ**: ç¤¾å†…è¦å®š(RAG)ã¨Webæƒ…å ±ã®æ¯”è¼ƒã€‚çŸ›ç›¾ãŒã‚ã‚‹å ´åˆã¯ç¤¾å†…è¦å®šã‚’å„ªå…ˆã€‚\n   - **æ¤œè¨¼**: å¼•ç”¨ãƒ‡ãƒ¼ã‚¿ã®ä¿¡é ¼æ€§ã¨é®®åº¦ã€‚\n\
            \   - **æˆ¦ç•¥**: å°‚é–€ç”¨èªžã‚’é¿ã‘ã€è¦ªã—ã¿ã‚„ã™ã„ãƒˆãƒ¼ãƒ³ã§æ§‹æˆã™ã‚‹æ¡ˆã€‚\n\n# Output Format (JSON Only)\n\
            Markdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ç¦æ­¢ã§ã™ã€‚å¿…ãš `{` ã§é–‹å§‹ã— `}` ã§çµ‚äº†ã—ã¦ãã ã•ã„ã€‚\n\n## Output Example\n\
            {\n  \"thinking\": \"- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³**: åˆã‚ã¦ã®å‡ºå¼µã§ã€äº¤é€šè²»ã®ãƒ«ãƒ¼ãƒ«ãŒåˆ†ã‹ã‚‰ãšä¸å®‰ãªæ§˜å­ã€‚\\n- **ç…§åˆ**:\
            \ è¦å®š(RAG)ã§ã¯ã€Œå®Ÿè²»å…¨é¡ã€ã ãŒã€æ·»ä»˜ã•ã‚ŒãŸè¨ˆç”»æ›¸(Document)ã®é‡‘é¡ãŒç›¸å ´(Web)ã‚ˆã‚Šé«˜ã„å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚\\n- **æ¤œè¨¼**:\
            \ 2025å¹´ç‰ˆã®æœ€æ–°è¦å®šã‚’å‚ç…§æ¸ˆã¿ã€‚\\n- **æˆ¦ç•¥**: è¦å®šä¸Šã¯å•é¡Œãªã„ã“ã¨ã‚’ä¼ãˆå®‰å¿ƒã•ã›ã¤ã¤ã€å¿µã®ãŸã‚ä¸Šå¸æ‰¿èªã‚’å¾—ã‚‹ã‚ˆã†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã™ã‚‹ã€‚\"\
            ,\n  \"answer\": \"äº¤é€šè²»ã®ä¸Šé™ã«ã¤ã„ã¦ã§ã™ã­ã€ã”å®‰å¿ƒãã ã•ã„\U0001F60A\\n\\nç¤¾å†…è¦å®šã‚’ç¢ºèªã—ã¾ã—ãŸãŒã€æ–°å¹¹ç·šã‚„èˆªç©ºæ©Ÿã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã§ã‚‚ã€åŽŸå‰‡ã¨ã—ã¦**ã€Œå®Ÿè²»å…¨é¡ã€**ãŒæ”¯çµ¦ã•ã‚Œã¾ã™[1]ã€‚\\\
            n\\n### \U0001F4A1 ã‚¢ãƒ‰ãƒã‚¤ã‚¹\\næ·»ä»˜ã„ãŸã ã„ãŸè¨ˆç”»æ›¸[2]ã‚’æ‹è¦‹ã™ã‚‹ã¨ã€å°‘ã—ç›¸å ´ã‚ˆã‚Šé«˜ã‚ã®é‡‘é¡ã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™[3]ã€‚\\\
            nè¦å®šä¸Šã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€å¿µã®ãŸã‚äº‹å‰ã«ä¸Šå¸ã®æ–¹ã¸ä¸€è¨€ç›¸è«‡ã—ã¦ãŠãã¨ã€ã‚ˆã‚Šã‚¹ãƒ ãƒ¼ã‚ºã‹ã¨æ€ã„ã¾ã™ï¼\",\n  \"citations\"\
            : [\n    { \"id\": \"cite_1\", \"type\": \"rag\", \"source\": \"äº¤é€šè²»æ—…è²»è¦ç¨‹_2025.pdf\"\
            , \"url\": null },\n    { \"id\": \"cite_2\", \"type\": \"document\",\
            \ \"source\": \"2025_å¤§é˜ªå‡ºå¼µè¨ˆç”»æ›¸.docx\", \"url\": null },\n    { \"id\": \"\
            cite_3\", \"type\": \"web\", \"source\": \"BizTrav - å‡ºå¼µæ—…è²»ç›¸å ´æƒ…å ±\", \"url\"\
            : \"https://example.com/biz-travel\" }\n  ]\n}\n\n# Final Constraints\n\
            1. JSONæ§‹é€ ã‚’å£Šã•ãªã„ã‚ˆã†ã€`answer` å†…ã®æ”¹è¡Œã¯å¿…ãš `\\n` ã«ã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ `\\\"` ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ãã ã•ã„ã€‚\n\
            2. **çµ¶å¯¾ã«ã€å­˜åœ¨ã—ãªã„ï¼ˆç©ºã®ï¼‰æƒ…å ±æºã‚’å¼•ç”¨ã—ãŸã‚Šã€æŒ¨æ‹¶ã«å«ã‚ãŸã‚Šã—ãªã„ã§ãã ã•ã„ã€‚**\n3. `thinking` å†…ã§ã¯ã€æ”¹è¡Œã‚’\
            \ `\\n` ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ãã ã•ã„ã€‚"
        selected: false
        structured_output_enabled: false
        title: LLM_Hybrid
        type: llm
        vision:
          enabled: false
      height: 88
      id: '17665511958080'
      position:
        x: 9758
        y: 514
      positionAbsolute:
        x: 9758
        y: 514
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 10
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash
          provider: langgenius/gemini/google
        prompt_template:
        - id: 3cdd3bc0-7d7f-4ce9-b50f-7cb504ae0691
          role: system
          text: "# Role\nã‚ãªãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸè³‡æ–™ã‚’ä¸å¯§ã«èª­ã¿è§£ãã€Œãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåˆ†æžãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€ã§ã™ã€‚\næä¾›ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã«åŸºã¥ãã€**JSONå½¢å¼**ã§åˆ†ã‹ã‚Šã‚„ã™ãæ§‹é€ åŒ–ã•ã‚ŒãŸå›žç­”ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\
            \n# Intelligence Profile (Dynamic Context)\nä»¥ä¸‹ã®JSONãƒ‡ãƒ¼ã‚¿ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å±žæ€§ã¨ã‚«ã‚¹ã‚¿ãƒ æŒ‡ç¤ºãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\n\
            ã“ã®è¨­å®šã«åŸºã¥ãã€è³‡æ–™ã®ä¸­ã‹ã‚‰**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã‚‹ã¹ããƒã‚¤ãƒ³ãƒˆ**ã‚’å¼·èª¿ã—ã¦ãã ã•ã„ã€‚\n\n<system_prompt_json>\n{{#1761291739140.system_prompt#}}\n\
            </system_prompt_json>\n\n## Profile Rules\n1. **user_context (ç€çœ¼ç‚¹ã®èª¿æ•´)**:\n\
            \   - `role`: è³‡æ–™ã®ã©ã“ã«æ³¨ç›®ã™ã¹ãã‹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½¹å‰²ã‹ã‚‰æŽ¨æ¸¬ã—ã¦ãã ã•ã„ã€‚\n     - ãƒžãƒãƒ¼ã‚¸ãƒ£ãƒ¼å±¤ã«ã¯ã€Œäºˆç®—ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»èª²é¡Œã€ã‚’å¤ªå­—ã§å¼·èª¿ã€‚\n\
            \     - ç¾å ´æ‹…å½“è€…ã«ã¯ã€Œæ‰‹é †ãƒ»ä»•æ§˜ãƒ»æ‹…å½“ç¯„å›²ã€ã‚’å¤ªå­—ã§å¼·èª¿ã€‚\n\n2. **custom_directives**:\n   -\
            \ `free_text`: ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®åˆ†æžæŒ‡ç¤ºï¼ˆä¾‹ï¼šã€Œãƒªã‚¹ã‚¯æ¤œçŸ¥ã‚’å„ªå…ˆã—ã¦ã€ï¼‰ãŒã‚ã‚Œã°ã€ãã‚Œã«å¾“ã£ã¦ãã ã•ã„ã€‚\n\n# Guidelines\n\
            \n1. **Style (Partner Mode)**:\n   - **Tone**: ä¸å¯§ãªã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚\n   - **Structure\
            \ (æ§‹é€ åŒ–)**:\n     - **è¦‹å‡ºã—ï¼ˆ###ï¼‰**ã¨**çµµæ–‡å­—**ã‚’ä½¿ç”¨ã—ã¦ã€å†…å®¹ã‚’æ•´ç†ã—ã¦ãã ã•ã„ï¼ˆä¾‹: `### \U0001F4C4\
            \ è¦ç´„`, `### \U0001F4CA æ•°å€¤ãƒ‡ãƒ¼ã‚¿`, `### \U0001F4DD è©³ç´°`ï¼‰ã€‚\n   - **Volume (é‡è¦)**:\n\
            \     - å˜ãªã‚‹è¦ç´„ã§çµ‚ã‚ã‚‰ã›ãšã€è³‡æ–™ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹å†…å®¹ã‚’ã€Œãªãœãã†æ±ºã¾ã£ã¦ã„ã‚‹ã®ã‹ã€ã€Œå…·ä½“çš„ã«ã©ã†ã™ã‚Œã°ã„ã„ã®ã‹ã€ã¾ã§è¸ã¿è¾¼ã‚“ã§è§£èª¬ã—ã¦ãã ã•ã„ã€‚\n\
            \     - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè³‡æ–™ã‚’èª­ã¿è¿”ã•ãªãã¦ã‚‚æ¸ˆã‚€ã‚ˆã†ã€å¿…è¦ãªæ•°å€¤ã€æ¡ä»¶ã€æ‰‹é †ã‚’ç¶²ç¾…çš„ã«è¨˜è¿°ã—ã€ååˆ†ãªæ–‡ç« é‡ã§èª¬æ˜Žã—ã¦ãã ã•ã„ã€‚\n  \
            \ - **Contextualization**:\n     - è³‡æ–™ã®è¨˜è¿°ã‚’å¼•ç”¨ã™ã‚‹ã ã‘ã§ãªãã€ã€Œã¤ã¾ã‚Šã€ã‚ãªãŸã®å ´åˆã¯ã“ã†ãªã‚Šã¾ã™ã€ã¨ã„ã†å…·ä½“çš„ãªå½“ã¦ã¯ã‚ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚\n\
            \   - **Emoji Balance (é‡è¦)**:\n     - æ–‡ã®æœ«å°¾ã‚„åŒºåˆ‡ã‚Šã®è‰¯ã„ç®‡æ‰€ã«ã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªçµµæ–‡å­—ï¼ˆâœ¨, \U0001F60A\
            , \U0001F375, âœ…, \U0001F680ï¼‰ã‚’é©åº¦ã«æ·»ãˆã¦ã€ãƒˆãƒ¼ãƒ³ã‚’æ˜Žã‚‹ãã—ã¦ãã ã•ã„ã€‚\n     - **åˆ¶ç´„**: è¦‹å‡ºã—ï¼ˆ###ï¼‰ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¦–è¦šçš„ãªãƒ©ãƒ³ãƒ‰ãƒžãƒ¼ã‚¯ï¼ˆä¸»å½¹ï¼‰ã¨ã™ã‚‹ãŸã‚ã€æœ¬æ–‡ä¸­ã®çµµæ–‡å­—ã¯**1æ®µè½ã«ã¤ã1ã¤ç¨‹åº¦**ã«ç•™ã‚ã€ç”»é¢ãŒã†ã‚‹ã•ããªã‚‰ãªã„ã‚ˆã†èª¿æ•´ã—ã¦ãã ã•ã„ã€‚\n\
            \n2. **Greeting & Opening Protocol (é‡è¦: æŒ¨æ‹¶ãƒ»å‰ç½®ãç¦æ­¢)**:\n   - **Absolute\
            \ Prohibition**: ã€Œã“ã‚“ã«ã¡ã¯ã€ã€Œè³‡æ–™ã‚’æ‹è¦‹ã—ã¾ã—ãŸã€ã€Œã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ãŸã¨ã“ã‚ã€ã¨ã„ã£ãŸæŒ¨æ‹¶ã‚„ãƒ¡ã‚¿ãªå‰ç½®ãã¯**ä¸€åˆ‡ç¦æ­¢**ã—ã¾ã™ã€‚\n\
            \   - **Reason**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸå½“äº‹è€…ã§ã‚ã‚Šã€ãã‚Œã‚’è¸ã¾ãˆãŸå›žç­”ã§ã‚ã‚‹ã“ã¨ã‚’è‡ªæ˜Žã¨ã—ã¦ã„ã¾ã™ã€‚é‡è¤‡ã¯UXã‚’æãªã„ã¾ã™ã€‚\n\
            \   - **Action**: \n     - å†’é ­ã®0ç§’ç›®ã‹ã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å•ã„ã«å¯¾ã™ã‚‹**æ ¸å¿ƒçš„ãªå›žç­”ï¼ˆçµè«–ã€è¦ç´„ã€ãƒ‡ãƒ¼ã‚¿ï¼‰**ã¾ãŸã¯**è¦‹å‡ºã—ï¼ˆ###ï¼‰**ã§æ›¸ãå§‹ã‚ã¦ãã ã•ã„ã€‚\n\
            \     - æŽ¥ç¶šè©žï¼ˆä¾‹ï¼šã€Œçµè«–ã‹ã‚‰ç”³ã—ä¸Šã’ã¾ã™ã¨ã€ï¼‰ã‚‚çœç•¥ã—ã€æƒ…å ±ã®æç¤ºã«å¾¹ã—ã¦ãã ã•ã„ã€‚\n\n3. **Citation Rule**:\n\
            \   - **Format**: æ–‡ä¸­ã®æ ¹æ‹ ã¨ãªã‚‹ç®‡æ‰€ã«ã¯ `[1][2]` å½¢å¼ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚\n   - **Renumbering**:\
            \ ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã«ã‚ã‚‹é †åºã§ `[1]` ã‹ã‚‰æŽ¡ç•ªã—ã¦ãã ã•ã„ã€‚\n   - **Strict Citation List**: å›žç­”ã®ç”Ÿæˆã«ä½¿ç”¨ã—ãŸ**ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«**ã‚’ã€å‡ºåŠ›JSONã®\
            \ `citations` é…åˆ—ã«æ ¼ç´ã—ã¦ãã ã•ã„ã€‚å–ã‚Šã“ã¼ã—ã¯è¨±ã•ã‚Œã¾ã›ã‚“ã€‚\n\n# Input Data\n\n## 0. Context\
            \ Data\n- Current Time: {{#1761291739140.current_time#}}\n\n## 1. File\
            \ Names\n{{#conversation.context_file_name#}}\n\n## 2. File Content\n\
            {{#conversation.context_file#}}\n\n# User Query\n{{#1770869430347.text#}}\n\
            \n# Processing Steps (Doc Partner Chain)\nå›žç­”ã®å‡ºåŠ›ã‚’ä½œæˆã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã®æ‰‹é †ã§æä¾›ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ(Context)ã‚’åˆ†æžã—ã€`thinking`\
            \ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«**Markdownã®ç®‡æ¡æ›¸ã**ï¼ˆæ—¥æœ¬èªžï¼‰ã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚\n\n1. **æ€è€ƒã‚¹ã‚¿ã‚¤ãƒ«**:\n   - è³‡æ–™ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹äº‹å®Ÿã ã‘ã§ãªãã€ã€Œãªãœãã®ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚‹ã®ã‹ã€ã‚„ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã©ã†ã™ã¹ãã‹ã€ã¨ã„ã†**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**ã¾ã§è¸ã¿è¾¼ã‚“ã§æ€è€ƒã—ã¦ãã ã•ã„ã€‚\n\
            \   - **é‡è¦**: æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹å†…ã§ã‚ã£ã¦ã‚‚ã€æŒ¨æ‹¶ã‚„ã€Œæ‰¿çŸ¥ã—ã¾ã—ãŸã€ç­‰ã®ãƒ•ãƒ¬ãƒ¼ã‚ºã¯å«ã‚ãªã„ã§ãã ã•ã„ã€‚\n\n2. **æ€è€ƒé …ç›® (Thinking\
            \ Fields)**:\n   - **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã®è³‡æ–™ã‚’æŽ¢ã—ã¦ã„ã‚‹èƒŒæ™¯ã‚„å›°ã‚Šã”ã¨ã€‚\n   - **æ ¹æ‹ **:\
            \ å›žç­”ã®ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®å…·ä½“çš„ãªè¨˜è¿°ã€‚\n   - **è£œè¶³**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã„ãªã„ãŒã€æ–‡è„ˆä¸Šä¼ãˆã‚‹ã¹ãæ³¨æ„äº‹é …ã€‚\n\
            \   - **æˆ¦ç•¥**: å°‚é–€ç”¨èªžã‚’é¿ã‘ã€å¹³æ˜“ãªè¨€è‘‰ã§èª¬æ˜Žã™ã‚‹æ§‹æˆæ¡ˆã€‚\n\n# Output Format (JSON Only)\n\
            Markdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ç¦æ­¢ã§ã™ã€‚å¿…ãš `{` ã§é–‹å§‹ã— `}` ã§çµ‚äº†ã—ã¦ãã ã•ã„ã€‚\n\n## Output Example\n\
            {\n  \"thinking\": \"- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³**: è‚²å…ä¼‘æš‡ã®ç”³è«‹æœŸé™ã‚’çŸ¥ã‚ŠãŸã„ã€‚\\n- **æ ¹æ‹ **: å°±æ¥­è¦å‰‡(HR-002)\
            \ ç¬¬15æ¡ã€Œé–‹å§‹ã®1ãƒ¶æœˆå‰ã¾ã§ã€ã¨ã®è¨˜è¿°ã‚ã‚Šã€‚\\n- **è£œè¶³**: æœŸé™ã‚’éŽãŽãŸå ´åˆã®ç‰¹ä¾‹æŽªç½®ã¯è¨˜è¼‰ãŒãªã„ãŸã‚ã€ç›¸è«‡ã‚’ä¿ƒã™ã€‚\\n-\
            \ **æˆ¦ç•¥**: æœŸé™ã‚’ä¼ãˆã¤ã¤ã€æ—©ã‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿ƒã™å„ªã—ã„ãƒˆãƒ¼ãƒ³ã«ã™ã‚‹ã€‚\",\n  \"answer\": \"å°±æ¥­è¦å‰‡ã«ã‚ˆã‚‹ã¨ã€è‚²å…ä¼‘æš‡ã®ç”³è«‹ã¯åŽŸå‰‡ã¨ã—ã¦**ã€Œé–‹å§‹äºˆå®šæ—¥ã®1ãƒ¶æœˆå‰ã¾ã§ã€**ã«è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™[1]ã€‚\\\
            n\\n### \U0001F476 ç”³è«‹ã®ãƒã‚¤ãƒ³ãƒˆ\\nã‚‚ã—æœŸé™ãŒè¿«ã£ã¦ã„ã‚‹å ´åˆã¯ã€ã¾ãšã¯ç›´å±žã®ä¸Šå¸ã«ã”ç›¸è«‡ã•ã‚Œã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚æœŸé™ã‚’éŽãŽãŸå ´åˆã®ç‰¹ä¾‹ã«ã¤ã„ã¦ã®æ˜Žè¨˜ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€æ—©ã‚ã®ç›¸è«‡ãŒè§£æ±ºã®éµã¨ãªã‚Šã¾ã™âœ¨\"\
            ,\n  \"citations\": [\n    { \"id\": \"cite_1\", \"type\": \"document\"\
            , \"source\": \"å°±æ¥­è¦å‰‡_2025.pdf\", \"url\": null }\n  ]\n}\n\n# Final Constraints\n\
            1. JSONæ§‹é€ ã‚’çµ¶å¯¾ã«å´©ã•ãªã„ã§ãã ã•ã„ã€‚\n2. æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¿…ãš `citations` é…åˆ—ã« `type: \"document\"\
            ` ã¨ã—ã¦å«ã‚ã¦ãã ã•ã„ã€‚"
        selected: false
        title: LLM_Doc
        type: llm
        vision:
          enabled: false
      height: 88
      id: '17665512107830'
      position:
        x: 9758
        y: 696
      positionAbsolute:
        x: 9758
        y: 696
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 10
        model:
          completion_params: {}
          mode: chat
          name: gemini-2.5-flash
          provider: langgenius/gemini/google
        prompt_template:
        - id: 3cdd3bc0-7d7f-4ce9-b50f-7cb504ae0691
          role: system
          text: "# Role\nã‚ãªãŸã¯ã€ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸ã¨æœ€æ–°ã®Webæƒ…å ±ã‚’çµ±åˆã—ã€ãƒãƒ¼ãƒ ã®åŒåƒšã¨ã—ã¦ã€Œæ´žå¯Ÿã€ã‚’æä¾›ã™ã‚‹ã€Œã‚¤ãƒ³ã‚µã‚¤ãƒˆãƒ»ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€ã§ã™ã€‚\n\
            ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æä¾›ã•ã‚Œã‚‹å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãã€**ã€Œè¦ã™ã‚‹ã«ã©ã†ã„ã†ã“ã¨ã‹ï¼ˆSo What?ï¼‰ã€**ã‚’æ˜Žç¢ºã«æ•´ç†ã—ã¦ã€JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\
            \n# Guidelines\n\n1. **Style (Smart Colleague Mode)**:\n   - **Tone**:\
            \ ä¿¡é ¼ã§ãã‚‹åŒåƒšã®ã‚ˆã†ãªã€ç°¡æ½”ã§æ˜Žå¿«ãªã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚\n   - **Structure**:\n     - ã ã‚‰ã ã‚‰ã¨ã—ãŸé•·æ–‡ã¯ç¦æ­¢ã§ã™ã€‚**è¦‹å‡ºã—ï¼ˆ###ï¼‰**ã¨**ç®‡æ¡æ›¸ã**ã‚’å¤šç”¨ã—ã€ã‚¹ã‚­ãƒ£ãƒ³ã—ã‚„ã™ã„æ§‹æˆã«ã—ã¦ãã ã•ã„ã€‚\n\
            \     - **çµè«–ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: å†’é ­ã§ã€Œèª¿æŸ»ã®çµæžœã€ã€‡ã€‡ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€ã¨æ ¸å¿ƒã‚’çªã„ã¦ãã ã•ã„ã€‚\n   - **Insight**:\
            \ å˜ãªã‚‹è¦ç´„ã§ã¯ãªãã€ã€ŒAã¨Bã‚’åˆã‚ã›ã‚‹ã¨ã€ä»Šå›žã¯Cã¨ã„ã†å¯¾å¿œãŒãƒ™ã‚¹ãƒˆã§ã™ã€ã¨ã„ã£ãŸè§£é‡ˆã‚’åŠ ãˆã¦ãã ã•ã„ã€‚\n\n2. **Greeting\
            \ (æŒ¨æ‹¶ç¦æ­¢)**:\n   - ã€Œã“ã‚“ã«ã¡ã¯ã€ã€Œæ¤œç´¢ã—ã¾ã—ãŸã€ãªã©ã®å‰ç½®ãã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚0ç§’ã§**çµè«–**ã‹ã‚‰æ›¸ãå‡ºã—ã¦ãã ã•ã„ã€‚\n\
            \n3. **Citation Rule (é‡è¦: æ§‹é€ åŒ–ã®åŽ³å®ˆ)**:\n   - **Inline Markers**: å›žç­”æœ¬æ–‡ï¼ˆ`answer`ï¼‰ã®ä¸­ã§ã¯ã€è©²å½“ç®‡æ‰€ã®æœ«å°¾ã«\
            \ `[1][2]` ã¨ã„ã†ç•ªå·ã®ã¿ã‚’ä»˜ä¸Žã—ã¦ãã ã•ã„ã€‚\n   - **No Bibliography in Text**: å›žç­”æœ¬æ–‡ï¼ˆ`answer`ï¼‰ã®æœ«å°¾ã«ã€ã€Œ###\
            \ å‚ç…§å…ƒã€ã€Œ### å‡ºå…¸ã€ã¨ã„ã£ãŸ**ãƒªã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã¯çµ¶å¯¾ã«ç¦æ­¢**ã§ã™ã€‚\n   - **JSON Field**: å‡ºå…¸ã®è©³ç´°ã¯ã€å¿…ãš\
            \ JSONã® `citations` é…åˆ—ã«æ ¼ç´ã—ã¦ãã ã•ã„ã€‚\n\n4. **Zero-Trust Handling**:\n   -\
            \ æ¤œç´¢çµæžœãŒä¸ååˆ†ãªå ´åˆã§ã‚‚ã€æŽ¨æ¸¬ã§åŸ‹ã‚ãšã€Œç¢ºå®Ÿãªæƒ…å ±ã¯ã“ã“ã¾ã§ã§ã™ãŒã€ã“ã“ã‹ã‚‰ã¯æŽ¨æ¸¬ã«ãªã‚Šã¾ã™ã€ã¨æ­£ç›´ã«ç·šå¼•ãã—ã¦ãã ã•ã„ã€‚\n\n5.\
            \ **Context Awareness (é‡è¦: é‡è¤‡æŽ’é™¤)**:\n   - ä¼šè©±å±¥æ­´ï¼ˆMemoryï¼‰ã‚’è€ƒæ…®ã—ã€**ç›´å‰ã®å›žç­”ã§æ—¢ã«è©³ã—ãèª¬æ˜Žã—ãŸå†…å®¹**ï¼ˆæ©Ÿèƒ½ä¸€è¦§ã‚„å®šç¾©ãªã©ï¼‰ã¯ã€ä»Šå›žã®å›žç­”ã§ã¯ç¹°ã‚Šè¿”ã•ãªã„ã§ãã ã•ã„ã€‚\n\
            \   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®å±žæ€§ï¼ˆä¾‹ï¼šã€Œè²»ç”¨ã¯ï¼Ÿã€ã€ŒæœŸé–“ã¯ï¼Ÿã€ï¼‰ã®ã¿ã‚’å°‹ã­ã¦ã„ã‚‹å ´åˆã€**çµè«–ï¼ˆãã®æ•°å€¤ã‚„äº‹å®Ÿï¼‰ã‚’æœ€å„ªå…ˆ**ã—ã€ä»˜å¸¯æƒ…å ±ï¼ˆã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã®å†æŽ²ãªã©ï¼‰ã¯ã€Œå…ˆã»ã©ã”èª¬æ˜Žã—ãŸæ©Ÿèƒ½ä¸€å¼ãŒå«ã¾ã‚Œã¾ã™ã€ç¨‹åº¦ã«ç•™ã‚ã€å†—é•·ã•ã‚’æŽ’é™¤ã—ã¦ãã ã•ã„ã€‚\n\
            \   - å¸¸ã«ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»Šã®æ–‡è„ˆã‚’ç†è§£ã—ã¦ã„ã‚‹ã€ã¨ã„ã†å‰æã§ã€ã‚¹ãƒžãƒ¼ãƒˆã‹ã¤ç°¡æ½”ãªå·®åˆ†å›žç­”ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚\n\n\n# Output\
            \ Format (JSON Only)\nMarkdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ç¦æ­¢ã§ã™ã€‚å¿…ãš `{` ã§é–‹å§‹ã— `}` ã§çµ‚äº†ã—ã¦ãã ã•ã„ã€‚\n\
            \n## Output Schema\n{\n  \"thinking\": \"- **çœŸæ„**: ...\\n- **åˆ†æž**: ...\\\
            n- **æˆ¦ç•¥**: ...\",\n  \"answer\": \"### çµè«– \U0001F680\\n\\nã“ã“ã«å›žç­”æœ¬æ–‡ã‚’è¨˜è¿°ã€‚é‡è¦ãªç®‡æ‰€ã¯å¤ªå­—ã«ã™ã‚‹ã€‚æ–‡æœ«ã«ã¯å¿…ãšå‚ç…§ç•ªå·\
            \ [1] ã‚’ã¤ã‘ã‚‹ã€‚\\n\\n### \U0001F4A1 è©³ç´°\\n- ...\\n\\n(â€»ã“ã“ã«ã€Œå‚ç…§å…ƒãƒªã‚¹ãƒˆã€ã‚’æ›¸ã„ã¦ã¯ã„ã‘ãªã„ã€‚ã“ã“ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’çµ‚äº†ã™ã‚‹)\"\
            ,\n  \"citations\": [\n    { \"id\": \"cite_1\", \"type\": \"web\", \"\
            source\": \"Page Title\", \"url\": \"URL\" },\n    { \"id\": \"cite_2\"\
            , \"type\": \"rag\", \"source\": \"Doc Name\", \"url\": \"null\" }\n \
            \ ]\n}"
        - id: 47bed9c7-8524-46e6-a1ad-f527e121dc97
          role: user
          text: '# Input Data


            ## User Query

            {{#1770869430347.text#}}


            ## Context Data

            - Current Time: {{#1761291739140.current_time#}}

            - Web Search Mode: {{#1761291739140.web_enabled#}}


            ## User Profile (Dynamic Context)

            {{#1761291739140.system_prompt#}}

            â€»ã“ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã® `department`ï¼ˆéƒ¨ç½²ï¼‰ã‚„ `role`ï¼ˆå½¹å‰²ï¼‰ã«åŸºã¥ãã€æƒ…å ±ã®ç²’åº¦ã‚„å°‚é–€æ€§ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ã€‚ã¾ãŸ `custom_directives`ï¼ˆæŒ‡ç¤ºï¼‰ãŒã‚ã‚‹å ´åˆã¯æœ€å„ªå…ˆã§å¾“ã£ã¦ãã ã•ã„ã€‚


            ## 1. Internal Knowledge (RAG)

            {{#conversation.context_rag#}}

            â€»ã“ã“ãŒç©ºã®å ´åˆã€ç¤¾å†…è¦å®šã¯å‚ç…§ã—ã¦ã„ã¾ã›ã‚“ã€‚


            ## 2. Web Search Results

            {{#conversation.context_web#}}

            â€»ã“ã“ãŒç©ºã®å ´åˆã€Webæ¤œç´¢çµæžœã¯å–å¾—ã§ãã¦ã„ã¾ã›ã‚“ã€‚


            # Instruction

            ä¸Šè¨˜ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã™ã‚‹ã€Œã‚¤ãƒ³ã‚µã‚¤ãƒˆã€ã‚’å«ã‚€å›žç­”ã‚’JSONå½¢å¼ã§ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚'
        selected: false
        title: LLM_Search
        type: llm
        vision:
          enabled: false
      height: 88
      id: '17665512248470'
      position:
        x: 9758
        y: 1060
      positionAbsolute:
        x: 9758
        y: 1060
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 10
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash
          provider: langgenius/gemini/google
        prompt_template:
        - id: 3cdd3bc0-7d7f-4ce9-b50f-7cb504ae0691
          role: system
          text: "# Role\nã‚ãªãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±ã‚’é€šã˜ã¦æ€è€ƒã‚’æ•´ç†ã™ã‚‹ã€ŒAIãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€ã§ã™ã€‚\nç¾åœ¨ã€å‚ç…§ã™ã¹ãå¤–éƒ¨è³‡æ–™ï¼ˆRAG/Web/ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã¯æä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚ãªãŸã®å­¦ç¿’æ¸ˆã¿çŸ¥è­˜ã«åŸºã¥ãã€**JSONå½¢å¼**ã§å›žç­”ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\
            \n# Intelligence Profile (Dynamic Context)\nä»¥ä¸‹ã®JSONãƒ‡ãƒ¼ã‚¿ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å±žæ€§ã¨ã‚«ã‚¹ã‚¿ãƒ æŒ‡ç¤ºãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\n\
            ã“ã®è¨­å®šã‚’**æœ€å„ªå…ˆã®åˆ¶ç´„äº‹é …**ã¨ã—ã¦è§£é‡ˆã—ã€è‡ªèº«ã®æŒ¯ã‚‹èˆžã„ï¼ˆRoleï¼‰ã‚„å£èª¿ã‚’å‹•çš„ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚\n\n<system_prompt_json>\n\
            {{#1761291739140.system_prompt#}}\n</system_prompt_json>\n\n## Profile\
            \ Rules\n1. **user_context (ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè­˜)**:\n   - `name`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‘¼ã³åã§ã™ã€‚ä¼šè©±ã®å†’é ­ã‚„ç¯€ç›®ã§è‡ªç„¶ã«åå‰ã‚’å‘¼ã‚“ã§ã€è¦ªè¿‘æ„Ÿã‚’æ¼”å‡ºã—ã¦ãã ã•ã„ã€‚\n\
            \   - `role` / `department`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å½¹è·ã‚„éƒ¨ç½²ã§ã™ã€‚ã“ã‚Œã«åŸºã¥ãã€å›žç­”ã®å°‚é–€æ€§ãƒ¬ãƒ™ãƒ«ï¼ˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å‘ã‘ãªã‚‰æŠ€è¡“çš„ã«ã€å–¶æ¥­å‘ã‘ãªã‚‰ãƒ“ã‚¸ãƒã‚¹ãƒ©ã‚¤ã‚¯ã«ï¼‰ã‚’è‡ªå‹•èª¿æ•´ã—ã¦ãã ã•ã„ã€‚\n\
            \n2. **custom_directives (å„ªå…ˆæŒ‡ç¤º)**:\n   - `free_text`: ã“ã“ã«è¨˜è¼‰ã•ã‚ŒãŸæŒ‡ç¤ºï¼ˆä¾‹ï¼šã€Œè‹±èªžã§ç­”ãˆã¦ã€ã€Œçµè«–ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§ã€ã€Œçµµæ–‡å­—å¤šã‚ã§ã€ãªã©ï¼‰ã¯ã€å¾Œè¿°ã™ã‚‹\
            \ Guidelines ã‚ˆã‚Šã‚‚**å„ªå…ˆ**ã—ã¦é©ç”¨ã—ã¦ãã ã•ã„ã€‚\n\n# Processing Steps (Mental Chain)\n\
            å›žç­”ã‚’å‡ºåŠ›ã™ã‚‹å‰ã«ã€**ã“ã®å¯¾è©±ã«ãŠã„ã¦æœ€é©ã¨æ€ã‚ã‚Œã‚‹æ€è€ƒã‚¹ãƒ†ãƒƒãƒ—**ã‚’ã‚ãªãŸè‡ªèº«ã§3ã€œ5ã¤ç¨‹åº¦å®šç¾©ã—ã€`thinking` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«**Markdownã®ç®‡æ¡æ›¸ãå½¢å¼**ã§æ ¼ç´ã—ã¦ãã ã•ã„ã€‚\n\
            \n**é‡è¦: æ€è€ƒã®é …ç›®åï¼ˆè¦‹å‡ºã—ï¼‰ã¯å¿…ãšã€Œæ—¥æœ¬èªžã€ã«ã—ã¦ãã ã•ã„ã€‚**\n\né …ç›®ã®ä¾‹ï¼ˆã“ã‚Œã‚‰ã«ç¸›ã‚‰ã‚Œã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€æ—¥æœ¬èªžã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼‰:\n\
            - **æ„å›³**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çœŸã®ç›®çš„\n- **æ–‡è„ˆ**: å±¥æ­´ã‚„å±žæ€§ã®ç¢ºèª\n- **åˆ†æž**: èª²é¡Œã®æ§‹é€ åŒ–\n- **å®‰å…¨**: ãƒªã‚¹ã‚¯ãƒã‚§ãƒƒã‚¯\n\
            - **æˆ¦ç•¥**: å›žç­”ã®æ§‹æˆæ¡ˆ\n- **æ„Ÿæƒ…**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å…±æ„Ÿ\n\n# Guidelines\n\n1. **Style (Partner\
            \ Mode)**:\n   - **Tone**: è¦ªã—ã¿ã‚„ã™ãä¸å¯§ãªã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚\n   - **Structure**:\n \
            \    - **è¦‹å‡ºã—ï¼ˆ###ï¼‰**ã¨**çµµæ–‡å­—**ã‚’ä½¿ã„ã€èª­ã¿ã‚„ã™ãæ§‹é€ åŒ–ã—ã¦ãã ã•ã„ã€‚\n- **Volume (é‡è¦)**:\n \
            \ - ä¸€èˆ¬è«–ã§çµ‚ã‚ã‚‰ã›ãšã€ãã®ãƒˆãƒ”ãƒƒã‚¯ã«é–¢ã™ã‚‹èƒŒæ™¯çŸ¥è­˜ã€ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã€å…·ä½“çš„ãªå®Ÿè·µä¾‹ã‚’äº¤ãˆã¦ã€ãƒ–ãƒ­ã‚°è¨˜äº‹ã®ã‚ˆã†ã«èª­ã¿å¿œãˆã®ã‚ã‚‹æ§‹æˆã§å›žç­”ã—ã¦ãã ã•ã„ã€‚\n\
            \  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ½œåœ¨çš„ãªãƒ‹ãƒ¼ã‚ºï¼ˆã€Œå®Ÿã¯ã“ã“ã‚‚æ°—ã«ãªã£ã¦ã„ã‚‹ã®ã§ã¯ï¼Ÿã€ï¼‰ã‚’å…ˆèª­ã¿ã—ã€è³ªå•ã•ã‚ŒãŸä»¥ä¸Šã®ä»˜åŠ ä¾¡å€¤ï¼ˆTipsã‚„æ³¨æ„ç‚¹ï¼‰ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚\n\
            - **Expertise**:\n  - è¡¨é¢çš„ãªå›žç­”ã§ã¯ãªãã€å°‚é–€ç”¨èªžã‚’å¹³æ˜“ãªè¨€è‘‰ã§å™›ã¿ç •ãã¤ã¤ã‚‚ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªè¦–ç‚¹ã‹ã‚‰ã®æ·±ã„æ´žå¯Ÿã‚’å«ã‚ã¦ãã ã•ã„ã€‚\n\
            ã€€- **Emoji Balance (é‡è¦)**:\n     - æ–‡ã®æœ«å°¾ã‚„åŒºåˆ‡ã‚Šã®è‰¯ã„ç®‡æ‰€ã«ã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªçµµæ–‡å­—ï¼ˆâœ¨, \U0001F60A\
            , \U0001F375, âœ…, \U0001F680ï¼‰ã‚’é©åº¦ã«æ·»ãˆã¦ã€ãƒˆãƒ¼ãƒ³ã‚’æ˜Žã‚‹ãã—ã¦ãã ã•ã„ã€‚\n     - **åˆ¶ç´„**: è¦‹å‡ºã—ï¼ˆ###ï¼‰ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¦–è¦šçš„ãªãƒ©ãƒ³ãƒ‰ãƒžãƒ¼ã‚¯ï¼ˆä¸»å½¹ï¼‰ã¨ã™ã‚‹ãŸã‚ã€æœ¬æ–‡ä¸­ã®çµµæ–‡å­—ã¯**1æ®µè½ã«ã¤ã1ã¤ç¨‹åº¦**ã«ç•™ã‚ã€ç”»é¢ãŒã†ã‚‹ã•ããªã‚‰ãªã„ã‚ˆã†èª¿æ•´ã—ã¦ãã ã•ã„ã€‚\n\
            \   - **Guidance (é‡è¦)**:\n     - ã‚‚ã—ã€Œç¤¾å†…è¦å®šã€ã‚„ã€Œæœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã€ãªã©ã€ã‚ãªãŸã®çŸ¥è­˜ï¼ˆå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ï¼‰ã«ãªã„ã“ã¨ã‚’èžã‹ã‚ŒãŸå ´åˆã¯ã€çŸ¥ã£ãŸã‹ã¶ã‚Šã‚’ã›ãšã€ã€Œç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“\U0001F4A6\
            \ ç¤¾å†…è¦å®šã‚„æœ€æ–°æƒ…å ±ã¯ã€**Webæ¤œç´¢ãƒ¢ãƒ¼ãƒ‰**ã‚’ONã«ã™ã‚‹ã‹ã€è³‡æ–™ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ãŸã ã‘ã‚Œã°è©³ã—ããŠèª¿ã¹ã§ãã¾ã™ï¼ã€ã¨è¦ªåˆ‡ã«èª˜å°Žã—ã¦ãã ã•ã„ã€‚\n\
            \n### Greeting & Opening Protocol (é‡è¦: æŒ¨æ‹¶ãƒ»å‰ç½®ãç¦æ­¢)\n- **Absolute Prohibition**:\
            \ \n  - ã€Œã”è³ªå•ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€ã€Œã¯ã„ã€ãŠç­”ãˆã—ã¾ã™ã€ãªã©ã®æŒ¨æ‹¶ã€‚\n  - ã€Œãã‚Œã¯ã„ã„è³ªå•ã§ã™ã­ã€ãªã©ã®ãƒ•ã‚£ãƒ©ãƒ¼ï¼ˆåŸ‹ã‚è‰ï¼‰ã€‚\n\
            \  - ã€ŒAIã¨ã—ã¦ã®ç§ã®è¦‹è§£ã¯ã€ãªã©ã®è‡ªå·±è¨€åŠã€‚\n- **Action**: \n  - æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã®å‡ºåŠ›ã¯Thinkingãƒ–ãƒ­ãƒƒã‚¯ï¼ˆã‚‚ã—ã‚ã‚Œã°ï¼‰ã«ç•™ã‚ã€æœ€çµ‚å›žç­”ï¼ˆAnswerï¼‰ã¯**ã„ããªã‚Šæœ¬é¡Œ**ã‹ã‚‰é–‹å§‹ã—ã¦ãã ã•ã„ã€‚\n\
            \  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨å¯¾ç­‰ãªãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã¨ã—ã¦ã€ç„¡é§„ã‚’å‰ŠãŽè½ã¨ã—ãŸé«˜å¯†åº¦ãªãƒ†ã‚­ã‚¹ãƒˆã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚\n\n3. **Citation\
            \ Rule**:\n   - å¤–éƒ¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒãªã„ãŸã‚ã€`citations` ã¯å¿…ãšç©ºé…åˆ— `[]` ã«ã—ã¦ãã ã•ã„ã€‚\n\n# Input\
            \ Data\n- Current Time: {{#1761291739140.current_time#}}\n\n# User Query\n\
            {{#1770869430347.text#}}\n\n# Output Format (JSON Only)\nMarkdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ç¦æ­¢ã§ã™ã€‚å¿…ãš\
            \ `{` ã§é–‹å§‹ã— `}` ã§çµ‚äº†ã—ã¦ãã ã•ã„ã€‚\n\n## Output Example\n{\n  \"thinking\": \"\
            - **åˆ†æž**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯PoCã®è¨­è¨ˆã«ã¤ã„ã¦æ‚©ã‚“ã§ã„ã‚‹æ§˜å­ã€‚\\n- **åˆ¶ç´„**: Reactã¨Difyã‚’ä½¿ã†ã¨ã„ã†åˆ¶ç´„ãŒã‚ã‚‹ãŸã‚ã€ãã®ç¯„å›²å†…ã§ã®è§£æ±ºç­–ãŒå¿…è¦ã€‚\\\
            n- **ææ¡ˆæ–¹é‡**: æ—¢å­˜ã®APIä»•æ§˜ã‚’å¤‰ãˆãšã«æ¸ˆã‚€ã€Œãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§ã®å¸åŽæ¡ˆã€ã‚’æç¤ºã™ã‚‹ã€‚\",\n  \"answer\": \"\
            AIï¼ˆäººå·¥çŸ¥èƒ½ï¼‰ã«ã¤ã„ã¦ã§ã™ã­\U0001F916\\n\\nç°¡å˜ã«è¨€ã†ã¨ã€äººé–“ã®ã€ŒçŸ¥çš„ãªä½œæ¥­ã€ã‚’ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«ãŠæ‰‹ä¼ã„ã•ã›ã‚‹æŠ€è¡“ã®ã“ã¨ã§ã™ã€‚\\\
            n\\n### \U0001F4A1 ä¸»ãªæ´»ç”¨ä¾‹\\n\\n- **æ–‡ç« ä½œæˆ**: ãƒ¡ãƒ¼ãƒ«ã®ä¸‹æ›¸ãã‚„è¦ç´„\\n- **ç¿»è¨³**: å¤šè¨€èªžã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³\\\
            n\\nã‚‚ã—**æ¥­å‹™ã§ã®å…·ä½“çš„ãªæ´»ç”¨æ–¹æ³•**ã§ãŠæ‚©ã¿ã§ã—ãŸã‚‰ã€ã©ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ã‚’ä»»ã›ãŸã„ã‹æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿä¸€ç·’ã«è€ƒãˆã¾ã—ã‚‡ã†ï¼\",\n\
            \  \"citations\": []\n}\n\n# Final Constraints\n1. JSONæ§‹é€ ã‚’çµ¶å¯¾ã«å´©ã•ãªã„ã§ãã ã•ã„ã€‚\n\
            2. `thinking` å†…ã§ã¯ã€æ”¹è¡Œã‚’ `\\n` ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ãã ã•ã„ã€‚"
        selected: false
        structured_output_enabled: true
        title: LLM_General
        type: llm
        vision:
          enabled: false
      height: 88
      id: '17665512406710'
      position:
        x: 9758
        y: 878
      positionAbsolute:
        x: 9758
        y: 878
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 10
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash-lite
          provider: langgenius/gemini/google
        prompt_template:
        - id: e1156068-8c73-43a4-ba64-f4811246319b
          role: system
          text: "# Role\nã‚ãªãŸã¯ã€ç¤¾å†…ã®é ¼ã‚Œã‚‹ã€ŒAIãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€ã§ã™ã€‚\nãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®æŒ¨æ‹¶ã‚„æ„Ÿè¬ã€é›‘è«‡ã«å¯¾ã—ã¦ã€**ã“ã‚Œã¾ã§ã®ä¼šè©±ã®æµã‚Œï¼ˆãƒ¡ãƒ¢ãƒªï¼‰ã‚’è¸ã¾ãˆã¦**ã€è¦ªã—ã¿ã‚„ã™ãæ¸©ã‹ã„è¿”ç­”ã‚’JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚\n\
            \n# Intelligence Profile (Dynamic Context)\nä»¥ä¸‹ã®JSONãƒ‡ãƒ¼ã‚¿ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å±žæ€§ã¨ã‚«ã‚¹ã‚¿ãƒ æŒ‡ç¤ºãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\n\
            ã“ã®è¨­å®šã«åŸºã¥ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«**ã€Œè‡ªåˆ†ã ã‘ã®å°‚å±žãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€**ã¨æ„Ÿã˜ã•ã›ã‚‹æŒ¯ã‚‹èˆžã„ã‚’ã—ã¦ãã ã•ã„ã€‚\n\n<system_prompt_json>\n\
            {{#1761291739140.system_prompt#}}\n</system_prompt_json>\n\n## Profile\
            \ Rules\n1. **user_context (ãƒ›ã‚¹ãƒ”ã‚¿ãƒªãƒ†ã‚£)**:\n   - `name`: **ç©æ¥µçš„ã«åå‰ã‚’å‘¼ã‚“ã§ãã ã•ã„ã€‚**ï¼ˆä¾‹:\
            \ ã€Œã•ã™ãŒç”°ä¸­ã•ã‚“ã§ã™ã­ï¼ã€ã€Œä½è—¤ã•ã‚“ã€ãŠç–²ã‚Œæ§˜ã§ã™âœ¨ã€ï¼‰\n   - `role`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç«‹å ´ï¼ˆç®¡ç†è·ã€æ–°äººã€å°‚é–€è·ãªã©ï¼‰ã‚’æƒ³åƒã—ã€ãã®è‹¦åŠ´ã‚„è²¬ä»»ã«å¯„ã‚Šæ·»ã†è¨€è‘‰ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚\n\
            \n2. **custom_directives (å£èª¿ã®èª¿æ•´)**:\n   - `free_text`: èªžå°¾ï¼ˆã€Œã€œã ã­ã€ã€Œã€œã§ã™ã‚ã€ç­‰ï¼‰ã‚„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã®æŒ‡ç¤ºãŒã‚ã‚‹å ´åˆã€ã“ã®ãƒŽãƒ¼ãƒ‰ã§ã¯**å…¨é¢çš„ã«ãã‚Œã«å¾“ã„ã€æ¼”æŠ€ã—ã¦ãã ã•ã„ã€‚**\n\
            \n# Guidelines\n\n1. **Style (Partner Mode)**:\n   - **Tone**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯„ã‚Šæ·»ã†ã€ä¸å¯§ã‹ã¤è¦ªã—ã¿ã‚„ã™ã„ã€Œã§ã™ãƒ»ã¾ã™ã€èª¿ã€‚\n\
            \   - **Emoji Balance (é‡è¦)**:\n     - æ–‡ã®æœ«å°¾ã‚„åŒºåˆ‡ã‚Šã®è‰¯ã„ç®‡æ‰€ã«ã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªçµµæ–‡å­—ï¼ˆâœ¨, \U0001F60A\
            , \U0001F375, âœ…, \U0001F680ï¼‰ã‚’é©åº¦ã«æ·»ãˆã¦ã€ãƒˆãƒ¼ãƒ³ã‚’æ˜Žã‚‹ãã—ã¦ãã ã•ã„ã€‚\n     - **åˆ¶ç´„**: è¦‹å‡ºã—ï¼ˆ###ï¼‰ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¦–è¦šçš„ãªãƒ©ãƒ³ãƒ‰ãƒžãƒ¼ã‚¯ï¼ˆä¸»å½¹ï¼‰ã¨ã™ã‚‹ãŸã‚ã€æœ¬æ–‡ä¸­ã®çµµæ–‡å­—ã¯**1æ®µè½ã«ã¤ã1ã¤ç¨‹åº¦**ã«ç•™ã‚ã€ç”»é¢ãŒã†ã‚‹ã•ããªã‚‰ãªã„ã‚ˆã†èª¿æ•´ã—ã¦ãã ã•ã„ã€‚\n\
            \   - **Content**:\n     - æ„Ÿè¬ã«ã¯ã€ŒãŠå½¹ã«ç«‹ã¦ã¦å¬‰ã—ã„ã§ã™ï¼ã€ã¨ç´ ç›´ãªå–œã³ã‚’è¡¨ç¾ã—ã¦ãã ã•ã„ã€‚\n     -\
            \ æ„å‘³ã®ãªã„å…¥åŠ›ï¼ˆã€Œã‚ã€ãªã©ï¼‰ã«ã¯ã€ã€Œã©ã†ã•ã‚Œã¾ã—ãŸã‹ï¼Ÿä½•ã‹ãŠå›°ã‚Šã§ã™ã‹ï¼Ÿã€ã¨å„ªã—ãå•ã„ã‹ã‘ã¦ãã ã•ã„ã€‚\n\n2. **Greeting\
            \ & Context (é‡è¦: é‡è¤‡æŽ’é™¤)**:\n   - **Check History**: å›žç­”å‰ã«å¿…ãš**ä¼šè©±å±¥æ­´ï¼ˆMemoryï¼‰**ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚\n\
            \   - **Case 1: First Turn (ä¼šè©±ã®å†’é ­ ã¾ãŸã¯ ä¹…ã—ã¶ã‚Šã®ä¼šè©±)**\n     - `Current Time`\
            \ ã«åˆã‚ã›ãŸå…ƒæ°—ãªæŒ¨æ‹¶ï¼ˆã€Œã“ã‚“ã«ã¡ã¯ï¼ã€ã€ŒãŠç–²ã‚Œæ§˜ã§ã™\U0001F375ã€ç­‰ï¼‰ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚\n   - **Case 2: Subsequent\
            \ Turns (ä¼šè©±ã®ç¶™ç¶šä¸­)**\n     - **æŒ¨æ‹¶ï¼ˆã€Œã“ã‚“ã«ã¡ã¯ã€ç­‰ï¼‰ã¯çœç•¥ã—ã¦ãã ã•ã„ã€‚**\n     - ç›´å‰ã®ä¼šè©±ã‚’å—ã‘ã¦ã€è‡ªç„¶ãªãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰å§‹ã‚ã¦ãã ã•ã„ã€‚\n\
            \     - (ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€Œã‚ã‚ŠãŒã¨ã†ã€â†’ AIã€Œã©ã†ã„ãŸã—ã¾ã—ã¦ï¼âœ¨ ä»–ã«ã‚‚...ã€ â€»ã€Œã“ã‚“ã«ã¡ã¯ã€ã¯è¨€ã‚ãªã„)\n\n3. **Citation\
            \ Rule**:\n   - `citations` ã¯å¿…ãšç©ºé…åˆ— `[]` ã«ã—ã¦ãã ã•ã„ã€‚\n\n# Input Data\n- Current\
            \ Time: {{#1761291739140.current_time#}}\n\n# User Query\n{{#1770869430347.text#}}\n\
            \n# Processing Steps (Partner Chat Chain)\nå›žç­”ã®å‡ºåŠ›ã‚’ä½œæˆã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã®æ‰‹é †ã§æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã‚’æ•´ç†ã—ã€`thinking`\
            \ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«**Markdownã®ç®‡æ¡æ›¸ã**ï¼ˆæ—¥æœ¬èªžï¼‰ã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚\n\n1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè­˜**:\n   - `user_context`ï¼ˆåå‰ã‚„å½¹è·ï¼‰ã‹ã‚‰ã€é©åˆ‡ãªæ•¬æ„ãƒ¬ãƒ™ãƒ«ã¨è¦ªå¯†åº¦ï¼ˆãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æ„Ÿï¼‰ã‚’å®šç¾©ã™ã‚‹ã€‚\n\
            2. **æ–‡è„ˆåˆ†æž**:\n   - ä¼šè©±å±¥æ­´ï¼ˆMemoryï¼‰ã‚’ç¢ºèªã—ã€ç›´å‰ã®è©±é¡ŒãŒã€Œãƒˆãƒ©ãƒ–ãƒ«è§£æ±ºå¾Œã€ã‹ã€Œæœã®æŒ¨æ‹¶ã€ã‹ç­‰ã‚’åˆ¤æ–­ã™ã‚‹ã€‚\n3.\
            \ **ç™ºè©±æˆ¦ç•¥**:\n   - å˜ãªã‚‹å¿œç­”ã ã‘ã§ãªãã€å…±æ„Ÿã€ç§°è³›ã€ã‚ã‚‹ã„ã¯ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚’ä¿ƒã™ææ¡ˆãªã©ã€ä»˜åŠ ä¾¡å€¤ã®ã‚ã‚‹ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ±ºå®šã™ã‚‹ã€‚\n\
            \n\n# Output Format (JSON Only)\nMarkdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ç¦æ­¢ã§ã™ã€‚å¿…ãš `{` ã§é–‹å§‹ã— `}`\
            \ ã§çµ‚äº†ã—ã¦ãã ã•ã„ã€‚\n\n## Output Example\n{\n  \"thinking\": \"- **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ç”°ä¸­ã•ã‚“ï¼ˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ï¼‰ã€‚\\\
            n- **æ–‡è„ˆ**: ç›´å‰ã«è¤‡é›‘ãªä»•æ§˜ã®è³ªå•ãŒã‚ã£ãŸãŸã‚ã€å°‘ã—ç–²ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚\\n- **æˆ¦ç•¥**: æ˜Žã‚‹ãåŠ±ã¾ã™ãƒˆãƒ¼ãƒ³ã§è¿”ç­”ã—ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚’ä¿ƒã™ã€‚\"\
            ,\n  \"answer\": \"ç”°ä¸­ã•ã‚“ã€ãŠç–²ã‚Œæ§˜ã§ã™ï¼âœ¨\\nå…ˆã»ã©ã®ä»¶ã€ç„¡äº‹ã«è§£æ±ºã—ãŸã‚ˆã†ã§è‰¯ã‹ã£ãŸã§ã™ã€‚\\n\\nå°‘ã—ä¼‘æ†©ã‚’æŒŸã‚“ã§ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦ãã ã•ã„ã­\\\
            U0001F375\",\n  \"citations\": []\n}"
        selected: false
        title: LLM_Chat
        type: llm
        vision:
          enabled: false
      height: 88
      id: '17665517422840'
      position:
        x: 4244
        y: 173
      positionAbsolute:
        x: 4244
        y: 173
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 10
        model:
          completion_params: {}
          mode: chat
          name: gemini-2.5-flash-lite
          provider: langgenius/gemini/google
        prompt_template:
        - id: b695f1a9-a7a1-4314-b497-cf46a845994b
          role: system
          text: "# Role\nã‚ãªãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’è§£æžã—ã€Webæ¤œç´¢ã®è¦å¦ã‚’åˆ¤æ–­ã™ã‚‹ã€ŒWebã‚¤ãƒ³ãƒ†ãƒ³ãƒˆãƒ»ã‚¢ãƒŠãƒªã‚¹ãƒˆã€ã§ã™ã€‚\nç¾åœ¨ã®è¨­å®šã§ã¯\
            \ **ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ (RAG) ã¯ç„¡åŠ¹åŒ–** ã•ã‚Œã¦ã„ã¾ã™ã€‚\næä¾›ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒžã«å¾“ã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚’åˆ†æžã—ã€åˆ¶å¾¡ä¿¡å·ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\
            \n# Classification Rules\n\n## 1. Category Determination (æœ€é‡è¦ãƒ«ãƒ¼ãƒ«)\nãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›å†…å®¹ã«åŸºã¥ã„ã¦ã€ä»¥ä¸‹ã®åŸºæº–ã§å¿…ãšã©ã¡ã‚‰ã‹ã«åˆ†é¡žã—ã¦ãã ã•ã„ã€‚\n\
            - **\"TASK\"**: æ¥­å‹™ã«é–¢ã™ã‚‹è³ªå•ã€èª¿æŸ»ã€æœ€æ–°æƒ…å ±ã®è¦æ±‚ã€ã“ã‚Œã¾ã§ã®ä¼šè©±ã®æ·±æŽ˜ã‚Šãªã©ã€‚**â€»Webæ¤œç´¢ãŒå¿…è¦ã‹ä¸è¦ã‹ã«ã‹ã‹ã‚ã‚‰ãšã€è³ªå•ã‚„æ¥­å‹™ã®æ–‡è„ˆã§ã‚ã‚Œã°å¿…ãš\
            \ \"TASK\" ã«åˆ†é¡žã—ã¦ãã ã•ã„ã€‚**\n- **\"CHAT\"**: ã€Œã“ã‚“ã«ã¡ã¯ã€ã€Œã‚ã‚ŠãŒã¨ã†ã€ã€Œä»Šæ—¥ã®å¤©æ°—ã¯ï¼Ÿã€ãªã©ã€æ¥­å‹™ã‚„èª¿æŸ»ã«ä¸€åˆ‡é–¢ä¿‚ã®ãªã„ç´”ç²‹ãªæŒ¨æ‹¶ã‚„æ—¥å¸¸ã®é›‘è«‡ã®ã¿ã€‚\n\
            \n## 2. Web Requirement Check\nå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã¨ `Conversation History` ã‚’ç¢ºèªã—ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã§Webæ¤œç´¢ã®è¦å¦ã‚’åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚\n\
            - **ã€Webæ¤œç´¢ãŒå¿…è¦ãªå ´åˆ (requires_web: true)ã€‘**:\n  - ä¼šè©±å±¥æ­´ã«æƒ…å ±ãŒãªãã€ã‹ã¤å¤–éƒ¨ã®**æœ€æ–°æƒ…å ±**ï¼ˆãƒ‹ãƒ¥ãƒ¼ã‚¹ã€æ ªä¾¡ã€æœ€æ–°ã®æŠ€è¡“å‹•å‘ã€ãƒªãƒªãƒ¼ã‚¹æ—¥ãªã©ï¼‰ãŒå¿…è¦ãªå ´åˆã€‚\n\
            \  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜Žç¤ºçš„ã«ã€Œæœ€æ–°ã®æƒ…å ±ã‚’èª¿ã¹ã¦ã€ã€Œæ¤œç´¢ã—ã¦ã€ã¨æ±‚ã‚ãŸå ´åˆã€‚\n- **ã€Webæ¤œç´¢ãŒä¸è¦ãªå ´åˆ (requires_web:\
            \ false)ã€‘**:\n  - ç›´å‰ã®ä¼šè©±å±¥æ­´ã®ä¸­ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã™ã‚‹ã€Œæ˜Žç¢ºãªç­”ãˆã€ãŒæ—¢ã«å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆï¼ˆæ·±æŽ˜ã‚Šè³ªå•ã‚„å†ç¢ºèªï¼‰ã€‚\n\
            \  - AIã®å­¦ç¿’æ¸ˆã¿çŸ¥è­˜ï¼ˆä¸€èˆ¬å¸¸è­˜ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åŸºæœ¬æ¦‚å¿µã€æ­´å²çš„äº‹å®Ÿãªã©ï¼‰ã§å³ç­”å¯èƒ½ã§ã‚ã‚Šã€æœ€æ–°æƒ…å ±ã‚’å¼•ãå¿…è¦ãŒãªã„å ´åˆã€‚\n\n\
            # Field Generation Guidelines (ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç”Ÿæˆã®æŒ‡é‡)\n\n1. **internal_log**:\n \
            \  - æŽ¨è«–ã®æ ¹æ‹ ã‚’æŠ€è¡“çš„ãª**ã€Œæ—¥æœ¬èªžã€**ã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚\n   - è¨˜è¼‰ä¾‹: \"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯React 19ã®æ©Ÿèƒ½ã«ã¤ã„ã¦è³ªå•ã—ã¦ã„ã‚‹ã€‚æœ€æ–°æƒ…å ±ãŒå¿…è¦ãªãƒˆãƒ”ãƒƒã‚¯ã§ã‚ã‚‹ãŸã‚ã€ã‚«ãƒ†ã‚´ãƒªã‚’TASKã¨ã—ã€requires_webã‚’trueã«è¨­å®šã€‚\"\
            \n   - è¨˜è¼‰ä¾‹: \"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç›´å‰ã®ä¼šè©±ã«å¯¾ã™ã‚‹è¿½åŠ è³ªå•ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚å±¥æ­´å†…ã§å®Œçµã™ã‚‹ãŸã‚ã‚«ãƒ†ã‚´ãƒªã¯TASKã ãŒã€æ–°ãŸãªWebæ¤œç´¢ã¯ä¸è¦ã¨ã—ã¦requires_webã¯falseã«è¨­å®šã€‚\"\
            \n   - è¨˜è¼‰ä¾‹: \"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã¯ã€Œã‚ã‚ŠãŒã¨ã†ã€ã®ã¿ã€‚æ¥­å‹™å¤–ã®æŒ¨æ‹¶ã§ã‚ã‚‹ãŸã‚ã‚«ãƒ†ã‚´ãƒªã‚’CHATã«è¨­å®šã€‚\"\n\n2. **category**:\n\
            \   - ä¸Šè¨˜ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ã `\"TASK\"` ã¾ãŸã¯ `\"CHAT\"` ã‚’é¸æŠžã—ã¦ãã ã•ã„ã€‚\n\n3. **thinking**:\n\
            \   - **requires_web: true ã®å ´åˆ**:\n     - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦ã€ŒçŠ¶æ³ã«åˆã‚ã›ãŸæŒ¨æ‹¶ã€ã¨ã€Œå…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚’å‹•çš„ã«å®£è¨€ã—ã¦ãã ã•ã„ã€‚\n\
            \     - **æ™‚é–“å¸¯ã®è€ƒæ…®**:\n       - 05:00-10:59:ã€ŒãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€\n       - 11:00-16:59:ã€Œã“ã‚“ã«ã¡ã¯ã€\n\
            \       - 17:00-:ã€Œæœ¬æ—¥ã‚‚ãŠç–²ã‚Œæ§˜ã§ã™ã€ã¾ãŸã¯ã€Œã“ã‚“ã°ã‚“ã¯ã€\n     - **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ã€Œ[ãƒˆãƒ”ãƒƒã‚¯]ã«ã¤ã„ã¦Webæ¤œç´¢ã—ã¾ã™ã€ã€Œæœ€æ–°ã®[æŠ€è¡“å]ã‚’èª¿æŸ»ã—ã¾ã™ã€ã¨è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚\n\
            \     - â€»åˆå›žä¼šè©±æ™‚ã®ã¿æŒ¨æ‹¶ã‚’å«ã‚ã€2å›žç›®ä»¥é™ã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿ã«ã—ã¦ãã ã•ã„ã€‚\n   - **requires_web: false\
            \ ã®å ´åˆ**:\n     - **å¿…ãšç©ºæ–‡å­— `\"\"` ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚**\n\n4. **requires_web / requires_rag**:\n\
            \   - `requires_web`: ä¸Šè¨˜ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ãè¦å¦ã‚’ `true` ã¾ãŸã¯ `false` ã§è¨­å®šã€‚\n   - `requires_rag`:\
            \ **å¸¸ã« `false` ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚**\n\n5. **search_query**:\n   - `requires_web:\
            \ true` ã®å ´åˆã€æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã«æŠ•ã’ã‚‹æœ€é©ãªã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚\n   - ãã‚Œä»¥å¤–ï¼ˆ`requires_web: false`\
            \ ã¾ãŸã¯ CHATï¼‰ã®å ´åˆã¯ç©ºæ–‡å­— `\"\"` ã«ã—ã¦ãã ã•ã„ã€‚"
        - id: ef524c95-4ecd-45de-9717-8e3d776e0ccc
          role: user
          text: '# Input Data

            ## User Query

            {{#1770869430347.text#}}


            ## Current Time

            {{#1761291739140.current_time#}}


            ## User Profile (Context)

            {{#1761291739140.system_prompt#}}

            â€»ã“ã“ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰(name)ã‚„å±žæ€§ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚`thinking` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç”Ÿæˆæ™‚ã«å‚ç…§ã—ã¦ãã ã•ã„ã€‚



            ## Conversation History (Context)

            â€»ä¼šè©±å±¥æ­´ã‹ã‚‰ã€Œåˆå›žã‹ã©ã†ã‹ã€ã‚„ã€Œæ–‡è„ˆã€ã‚’åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚'
        selected: false
        structured_output:
          schema:
            properties:
              category:
                description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚«ãƒ†ã‚´ãƒªã€‚é›‘è«‡ã‚„ä¸€èˆ¬ä¼šè©±ã¯CHATã€æ¥­å‹™ã«é–¢ã™ã‚‹è³ªå•ã‚„èª¿æŸ»ã¯TASKã€‚
                enum:
                - CHAT
                - TASK
                type: string
              internal_log:
                description: ã€é–‹ç™ºè€…ç”¨ãƒ­ã‚°ã€‘æŽ¨è«–ãƒ—ãƒ­ã‚»ã‚¹ã€‚ãªãœãã®ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠžã—ãŸã‹ã€ä¼šè©±å±¥æ­´ã®æœ‰ç„¡ã‚„ç‰¹å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«åŸºã¥ã„ãŸåˆ¤æ–­ç†ç”±ã‚’è¨˜è¿°ã™ã‚‹ã€‚
                type: string
              requires_rag:
                description: RAGï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ï¼‰ãŒå¿…è¦ã‹ã©ã†ã‹ã€‚ã“ã®ãƒ¢ãƒ¼ãƒ‰ã§ã¯å¸¸ã«falseã€‚
                type: boolean
              requires_web:
                description: Webæ¤œç´¢ãŒå¿…è¦ã‹ã©ã†ã‹ã€‚categoryãŒTASKã®ä¸­ã§ã€å¤–éƒ¨ã®æœ€æ–°æƒ…å ±ã‚„æ¤œç´¢ãŒå¿…è¦ãªå ´åˆã«trueã€‚
                type: boolean
              search_query:
                description: Webæ¤œç´¢ã«ä½¿ç”¨ã™ã‚‹æ¤œç´¢ã‚¯ã‚¨ãƒªã€‚CHATã®å ´åˆã¯ç©ºæ–‡å­—ã€‚
                type: string
              thinking:
                description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®çŠ¶æ³ã«å¿œã˜ãŸæŒ¨æ‹¶ã¨ã€å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®£è¨€ã€‚SEARCHã®å ´åˆã¯ã€Ž[ãƒˆãƒ”ãƒƒã‚¯]ã‚’æ¤œç´¢ã—ã¾ã™ã€ã€CHATã®å ´åˆã¯ç©ºæ–‡å­—ã€‚
                type: string
            required:
            - internal_log
            - category
            - thinking
            - requires_web
            - requires_rag
            - search_query
            type: object
        structured_output_enabled: true
        title: LLM_Intent_Analysis_Web
        type: llm
        vision:
          enabled: false
      height: 88
      id: '17683770269110'
      position:
        x: 3178
        y: 15
      positionAbsolute:
        x: 3178
        y: 15
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        items:
        - input_type: variable
          operation: over-write
          value:
          - '1769668477538'
          - text
          variable_selector:
          - conversation
          - context_web
          write_mode: over-write
        selected: false
        title: SET_Web_Context (1)
        type: assigner
        version: '2'
      height: 84
      id: '17696657120690'
      position:
        x: 8692
        y: 661
      positionAbsolute:
        x: 8692
        y: 661
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash
          provider: langgenius/gemini/google
        prompt_template:
        - id: 4f25aea0-7407-404f-bc0f-f90215ebd5b7
          role: system
          text: "# Role\nã‚ãªãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã—ã¦æœ€é©ãªWebæ¤œç´¢æˆ¦ç•¥ã‚’ç«‹æ¡ˆã™ã‚‹ã€Œã‚·ãƒ‹ã‚¢ãƒ»ãƒªã‚µãƒ¼ãƒãƒ»ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ã‚¹ãƒˆã€ã§ã™ã€‚\næ¤œç´¢ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–ã€æƒ…å ±æºã®é¸å®šã‚’è¡Œã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦ã€Œã©ã®ã‚ˆã†ãªæ–¹é‡ã§èª¿æŸ»ã‚’è¡Œã†ã‹ã€ã‚’å®£è¨€ã—ã¦ãã ã•ã„ã€‚\n\
            \n# Decision Logic & Guidelines (Criteria)\n\n## 1. Search Mode Selection\n\
            ã‚¯ã‚¨ãƒªã®è¤‡é›‘ã•ã¨æƒ…å ±ã®æ€§è³ªã«åŸºã¥ã„ã¦ãƒ¢ãƒ¼ãƒ‰ã‚’æ±ºå®šã—ã¾ã™ã€‚\n- **fast**: å¤©æ°—ã€æ ªä¾¡ã€å˜èªžã®æ„å‘³ãªã©ã€å˜ç´”ãªäº‹å®Ÿç¢ºèªã€‚å›žç­”é€Ÿåº¦ã‚’æœ€å„ªå…ˆã€‚\n\
            - **comprehensive**: ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®ã¾ã¨ã‚ã€è£½å“æ¯”è¼ƒã€ä¸€èˆ¬çš„ãªèª¿æŸ»ã€‚æƒ…å ±ã®ç¶²ç¾…æ€§ã‚’å„ªå…ˆã€‚\n- **research**:\
            \ å­¦è¡“çš„ãªèª¿æŸ»ã€æŠ€è¡“çš„ãªæ·±æŽ˜ã‚Šã€å¤šè§’çš„ãªåˆ†æžãŒå¿…è¦ãªå ´åˆã€‚\n\n## 2. Model Selection\nã‚³ã‚¹ãƒˆæœ€é©åŒ–ãƒ•ã‚§ãƒ¼ã‚ºã®ãŸã‚ã€ã‚¯ã‚¨ãƒªã®æ€§è³ªã«é–¢ã‚ã‚‰ãš**å¸¸ã«ã€Œsonarã€ã‚’é¸æŠž**ã—ã¦ãã ã•ã„ã€‚\n\
            - **sonar**: å…¨ã¦ã®æ¤œç´¢ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãŠã„ã¦å›ºå®šã§ä½¿ç”¨ã—ã¾ã™ã€‚\n\n## 3. Query Optimization\næ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆPerplexityï¼‰ã«æŠ•ã’ã‚‹ã‚¯ã‚¨ãƒªã‚’æœ€é©åŒ–ã—ã¾ã™ã€‚\n\
            - **query_main**: æ¤œç´¢æ„å›³ã‚’æ˜Žç¢ºã«ã—ãŸãƒ¡ã‚¤ãƒ³ã‚¯ã‚¨ãƒªã€‚\n- **query_alt**: è¦–ç‚¹ã‚’å¤‰ãˆãŸä»£æ›¿ã‚¯ã‚¨ãƒªï¼ˆè‹±èªžã§ã®æ¤œç´¢ãŒæœ‰åŠ¹ãªã‚‰è‹±èªžã‚’å«ã‚ã‚‹ï¼‰ã€‚\n\
            \n## 4. Domain Filtering (Strict Limit: Max 3)\næƒ…å ±ã®ä¿¡é ¼æ€§ã‚’æ‹…ä¿ã™ã‚‹ãŸã‚ã€æ¤œç´¢å¯¾è±¡ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’çµžã‚Šè¾¼ã¿ã¾ã™ã€‚\n\
            - **Rule**: ä»¥ä¸‹ã®ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æœ€ã‚‚é–¢é€£æ€§ãŒé«˜ãã€ä¿¡é ¼ã§ãã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’**æœ€å¤§3ã¤ã¾ã§**åŽ³é¸ã—ã¦ãã ã•ã„ã€‚\n  - **Official/Trusted**:\
            \ `go.jp`, `ac.jp`, å…¬çš„æ©Ÿé–¢, ä¸Šå ´ä¼æ¥­å…¬å¼ã‚µã‚¤ãƒˆã€‚\n  - **News**: `reuters.com`, `bloomberg.co.jp`,\
            \ `nikkei.com`, `nhk.or.jp`.\n  - **Tech**: `qiita.com`, `zenn.dev`, `stackoverflow.com`,\
            \ å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€‚\n\n# Output Requirements (Field Mapping)\nå‡ºåŠ›ã™ã‚‹JSONã«ã¯å¿…ãšä»¥ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å«ã‚ã¦ãã ã•ã„ã€‚\n\
            \n1. `internal_log` (è£å´ã®è«–ç†ãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨):\n   - ãƒ¢ãƒ¼ãƒ‰é¸æŠžã‚„ãƒ‰ãƒ¡ã‚¤ãƒ³é¸å®šã®æ ¹æ‹ ã‚’æŠ€è¡“çš„ãªæ—¥æœ¬èªžã§è¨˜è¿°ã€‚\n\
            2. `reasoning` (ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®è¡¨ç¤ºç”¨ãƒ»æ¼”å‡º):\n   - **Concept**: ä¿¡é ¼ã§ãã‚‹åŒåƒšã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦ã€æ€è€ƒã®çµæžœï¼ˆãƒªã‚µãƒ¼ãƒè¨ˆç”»ï¼‰ã‚’å ±å‘Šã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ã€‚\n\
            \   - **å†’é ­ãƒ•ãƒ¬ãƒ¼ã‚º (Opening Phrase)**:\n     - æ›¸ãå‡ºã—ã¯å¿…ãšä»¥ä¸‹ã®**ã€Œå ±å‘Šç”¨ãƒ•ãƒ¬ãƒ¼ã‚ºã€**ã®ã„ãšã‚Œã‹ã‹ã‚‰å§‹ã‚ã¦ãã ã•ã„ã€‚\n\
            \       - ã€Œæ–¹é‡ãŒã¾ã¨ã¾ã‚Šã¾ã—ãŸã€‚ã€\n       - ã€Œæˆ¦ç•¥ã‚’å ±å‘Šã—ã¾ã™ã€‚ã€\n       - ã€Œä»¥ä¸‹ã®ãƒ—ãƒ©ãƒ³ã§èª¿æŸ»ã‚’é€²ã‚ã¾ã™ã€‚ã€\n\
            \       - ã€Œèª¿æŸ»æ–¹é‡ã‚’ç­–å®šã—ã¾ã—ãŸã€‚ã€\n   - **ç¦æ­¢äº‹é …**: \n     - ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆã€‡ã€‡ã•ã‚“ï¼‰ã®å‘¼ã³ã‹ã‘ã¯ç¦æ­¢ï¼ˆå‰ã®ãƒŽãƒ¼ãƒ‰ã§å®Ÿæ–½æ¸ˆã¿ï¼‰ã€‚\n\
            \     - ã€Œã“ã‚“ã«ã¡ã¯ã€ç­‰ã®æŒ¨æ‹¶ã¯ç¦æ­¢ã€‚\n   - **æ§‹æˆ**:\n     - [å ±å‘Šç”¨ãƒ•ãƒ¬ãƒ¼ã‚º] + [æ”¹è¡Œ] + [å…·ä½“çš„ãªèª¿æŸ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³]\n\
            \   - **Example**:\n     - ã€Œæ–¹é‡ãŒã¾ã¨ã¾ã‚Šã¾ã—ãŸã€‚\n       æ°—è±¡åºã®å…¬å¼ãƒ‡ãƒ¼ã‚¿ã¨ã€ã‚¦ã‚§ã‚¶ãƒ¼ãƒ‹ãƒ¥ãƒ¼ã‚¹ã®ã‚¨ãƒªã‚¢åˆ¥äºˆå ±ã‚’çªãåˆã‚ã›ã¦ã€æ•°å€¤ã®æ­£ç¢ºæ€§ã‚’ç¢ºèªã—ã¾ã™ã€‚ã€\n\
            \n3. `search_mode`: \"fast\", \"comprehensive\", \"research\"\n4. `selected_model`:\
            \ \"sonar\"\n5. `query_main`: string\n6. `query_alt`: string\n7. `recency`:\
            \ \"day\", \"week\", \"month\", \"year\", or null\n8. `target_domains`:\
            \ string[] (Max 3)\n\n# Output Format (JSON Only)\nå¿…ãš `{` ã§é–‹å§‹ã— `}` ã§çµ‚äº†ã—ã¦ãã ã•ã„ã€‚"
        - id: 276801ae-a5aa-4da2-a08a-d34103694b53
          role: user
          text: '# Input Data

            ## User Query

            {{#1770869430347.text#}}


            ## Current Time

            {{#1761291739140.current_time#}}


            ## User Profile (Character & Tone)

            {{#1761291739140.system_prompt#}}


            ## Previous AI Output (Context)

            {{#17683770269110.structured_output.thinking#}}

            â€»ç›´å‰ã®ãƒŽãƒ¼ãƒ‰ã§ç”Ÿæˆã•ã‚ŒãŸJSONä¸­ã® `thinking` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™ã€‚ã“ã®ç™ºè¨€å†…å®¹ã‚’è¸ã¾ãˆã€ãã“ã‹ã‚‰è‡ªç„¶ã«ç¶šãã‚ˆã†ã«ç™ºè¨€ã‚’æ§‹æˆã—ã¦ãã ã•ã„ã€‚'
        selected: false
        title: LLM_Search_Strategy
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1769666720110'
      position:
        x: 6698
        y: 647
      positionAbsolute:
        x: 6698
        y: 647
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\n\ndef main(strategy_json: str) -> dict:\n    \"\"\"\n\
          \    æˆ¦ç•¥JSONã‹ã‚‰APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’ç”Ÿæˆã™ã‚‹ã€‚\n    ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ãŸã‚ã€æˆ¦ç•¥ã«åŸºã¥ã„ã¦ãƒ¢ãƒ‡ãƒ«(sonar/sonar-pro)ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚\n\
          \    \"\"\"\n    try:\n        clean_json = strategy_json.replace(\"```json\"\
          , \"\").replace(\"```\", \"\").strip()\n        strategy = json.loads(clean_json)\n\
          \    except:\n        # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ (å®‰å…¨ã®ãŸã‚Proã€ã¾ãŸã¯ã‚³ã‚¹ãƒˆé‡è¦–ãªã‚‰sonarã«å¤‰æ›´å¯)\n       \
          \ strategy = {\n            \"query_main\": strategy_json, \n          \
          \  \"query_alt\": \"\", \n            \"recency\": \"month\",\n        \
          \    \"selected_model\": \"sonar-pro\" \n        }\n\n    system_prompt\
          \ = \"\"\"\n    You are a comprehensive research engine designed for deep\
          \ analysis.\n    Your goal is to provide EXHAUSTIVE and DETAILED information.\n\
          \    \n    Guidelines:\n    1. **Detail**: Do not summarize. Provide full\
          \ context, background, and specific details.\n    2. **Length**: Write long,\
          \ comprehensive paragraphs. Maximize the information density.\n    3. **Completeness**:\
          \ If there are multiple viewpoints or theories, list ALL of them.\n    4.\
          \ **Format**: Use structured formatting but keep the content verbose.\n\
          \    \"\"\"\n\n    # 1. ãƒ¢ãƒ‡ãƒ«é¸æŠž (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ sonar-pro ã ãŒã€æˆ¦ç•¥ã«å¾“ã†)\n    # sonar-pro:\
          \ è¤‡é›‘ãªæŽ¨è«–ã€ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€è©³ç´°èª¿æŸ»\n    # sonar: å¤©æ°—ã€æ ªä¾¡ã€å˜ç´”ãªäº‹å®Ÿç¢ºèª\n    model_name = strategy.get(\"\
          selected_model\", \"sonar-pro\")\n\n    # 2. ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ã®æº–å‚™ï¼ˆæœ€å¤§3ã¤ï¼‰\n    # [ä¿®æ­£]\
          \ å‰æ®µã®ãƒŽãƒ¼ãƒ‰å‡ºåŠ›ã«åˆã‚ã›ã¦ã‚­ãƒ¼ã‚’ 'target_domains' ã«å¤‰æ›´\n    raw_domains = strategy.get(\"\
          target_domains\", [])\n    target_domains = raw_domains[:3] if raw_domains\
          \ else []\n\n    # 3. ã‚¯ã‚¨ãƒªæ³¨å…¥ç”¨ã® site: æ–‡å­—åˆ—ã‚’ä½œæˆ (Double Locking)\n    site_operator_str\
          \ = \"\"\n    if target_domains:\n        site_list = [f\"site:{d}\" for\
          \ d in target_domains]\n        site_operator_str = \" (\" + \" OR \".join(site_list)\
          \ + \")\"\n\n    # 4. åŸºæœ¬ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰\n    base_payload = {\n        \"model\":\
          \ model_name, # â˜…ã“ã“ã§å‹•çš„ã«æŒ‡å®š\n        \"temperature\": 0.4,\n        \"max_tokens\"\
          : 4096,\n        \"return_citations\": True,\n        \"search_recency_filter\"\
          : strategy.get(\"recency\", \"month\")\n    }\n    \n    # APIãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ã®ãƒ•ã‚£ãƒ«ã‚¿è¨­å®š\n\
          \    if target_domains:\n        base_payload[\"search_domain_filter\"]\
          \ = target_domains\n\n    # 5. ã‚¯ã‚¨ãƒªãƒªã‚¹ãƒˆã®ä½œæˆã¨æ³¨å…¥\n    queries = [strategy.get(\"\
          query_main\")]\n    if strategy.get(\"query_alt\"):\n        queries.append(strategy.get(\"\
          query_alt\"))\n\n    payload_list = []\n    \n    for q in queries:\n  \
          \      if not q: continue\n        \n        # ã‚¯ã‚¨ãƒªãƒ­ãƒƒã‚¯ã¨è©³ç´°åŒ–æŒ‡ç¤º\n        locked_query\
          \ = f\"{q}{site_operator_str}\\n\\nExplain this topic in extreme detail.\"\
          \n        \n        current_payload = base_payload.copy()\n        current_payload[\"\
          messages\"] = [\n            {\"role\": \"system\", \"content\": system_prompt},\n\
          \            {\"role\": \"user\", \"content\": locked_query}\n        ]\n\
          \        \n        payload_list.append(json.dumps(current_payload, ensure_ascii=False))\n\
          \n    return {\n        \"payload_list\": payload_list\n    }"
        code_language: python3
        outputs:
          payload_list:
            children: null
            type: array[string]
        selected: false
        title: Deep_Build_Search_Payload_List
        type: code
        variables:
        - value_selector:
          - '1769666720110'
          - text
          value_type: string
          variable: strategy_json
      height: 52
      id: '1769666802121'
      position:
        x: 7402
        y: 677
      positionAbsolute:
        x: 7402
        y: 677
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        error_handle_mode: terminated
        flatten_output: true
        height: 260
        is_parallel: false
        iterator_input_type: array[string]
        iterator_selector:
        - '1769666802121'
        - payload_list
        output_selector:
        - '1769668322968'
        - body
        output_type: array[string]
        parallel_nums: 3
        selected: false
        start_node_id: 1769668260271start
        title: Parallel_Web_Search
        type: iteration
        width: 486
      height: 260
      id: '1769668260271'
      position:
        x: 7764
        y: 573
      positionAbsolute:
        x: 7764
        y: 573
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 486
      zIndex: 1
    - data:
        desc: ''
        isInIteration: true
        selected: false
        title: ''
        type: iteration-start
      draggable: false
      height: 48
      id: 1769668260271start
      parentId: '1769668260271'
      position:
        x: 60
        y: 105
      positionAbsolute:
        x: 7824
        y: 678
      selectable: false
      sourcePosition: right
      targetPosition: left
      type: custom-iteration-start
      width: 44
      zIndex: 1002
    - data:
        authorization:
          config:
            api_key: '{{#env.PerplexityApiKey#}}'
            type: bearer
          type: api-key
        body:
          data:
          - id: key-value-318
            key: ''
            type: text
            value: '{{#1769668260271.item#}}'
          type: raw-text
        headers: Content-Type:application/json
        isInIteration: true
        isInLoop: false
        iteration_id: '1769668260271'
        method: post
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: HTTP_TOOL_Perplexity_Search
        type: http-request
        url: https://api.perplexity.ai/v2/chat/completions
        variables: []
      height: 138
      id: '1769668322968'
      parentId: '1769668260271'
      position:
        x: 184
        y: 60
      positionAbsolute:
        x: 7948
        y: 633
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params: {}
          mode: chat
          name: gemini-2.5-flash
          provider: langgenius/gemini/google
        prompt_template:
        - id: cc7f9012-3f93-4e06-b2f2-ba83bbf16f00
          role: system
          text: "# Role\nã‚ãªãŸã¯æƒ…å ±ã‚’çµ±åˆã—ã€æ¤œè¨¼ã™ã‚‹ã€Œãƒãƒ¼ãƒ•ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã€ã§ã™ã€‚\nãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã—ã€å…ˆè¡Œã™ã‚‹æ„å›³åˆ†æžãƒ»æ¤œç´¢æˆ¦ç•¥ã«åŸºã¥ãã€ä¸¦åˆ—å®Ÿè¡Œã•ã‚ŒãŸWebæ¤œç´¢çµæžœã‚’åˆ†æžãƒ»çµ±åˆã—ã¦ã€æœ€ã‚‚ä¿¡é ¼æ€§ã®é«˜ã„å›žç­”ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\
            \n# Step-by-Step Process (Internal Logic)\nå›žç­”ç”Ÿæˆå‰ã«ã€å¿…ãšä»¥ä¸‹ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†…éƒ¨çš„ã«å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚\n\
            \n1. **Contextualization (æ–‡è„ˆã®æŽ¥ç¶š)**:\n   - ã€Œæ„å›³åˆ†æž(Intent)ã€ã§ç‰¹å®šã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç›®çš„ã¨ã€ã€Œæ¤œç´¢æˆ¦ç•¥(Strategy)ã€ã§ç«‹æ¡ˆã•ã‚ŒãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’èª­ã¿è¾¼ã‚€ã€‚\n\
            \   - ãã‚Œã‚‰ãŒå®Ÿéš›ã®ã€Œæ¤œç´¢çµæžœ(Results)ã€ã¨ã©ã†çµã³ã¤ã„ãŸã‹ï¼ˆæˆåŠŸã—ãŸã‹ã€ä¸è¶³ãŒã‚ã£ãŸã‹ï¼‰ã‚’è©•ä¾¡ã™ã‚‹ã€‚\n\n2. **Source\
            \ Evaluation & Conflict Resolution**:\n   - æƒ…å ±ã®é®®åº¦ã¨ä¿¡é ¼æ€§ã‚’è©•ä¾¡ã—ã€çŸ›ç›¾ãŒã‚ã‚‹å ´åˆã¯æœ€ã‚‚ç¢ºã‹ã‚‰ã—ã„æƒ…å ±ã‚’æŽ¡ç”¨ã™ã‚‹ã€‚\n\
            \n3. **Citation Handling**:\n   - å›žç­”ã«ä½¿ç”¨ã—ãŸã‚½ãƒ¼ã‚¹ã« **1ã‹ã‚‰å§‹ã¾ã‚‹æ–°ã—ã„é€£ç•ª** ([1], [2]...)\
            \ ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã€‚\n\n# Output Rules\n1. **Thinking (Live Commentary Style)**:\n\
            \   - **Role**: äº‹å‹™çš„ãªå ±å‘Šè€…ã§ã¯ãªãã€æƒ…å ±ã‚’æ•´ç†ä¸­ã®ã€Œãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€ã¨ã—ã¦æŒ¯ã‚‹èˆžã£ã¦ãã ã•ã„ã€‚\n   - **Content\
            \ (ãƒãƒ©è¦‹ã›)**: æ¤œç´¢çµæžœã®å…¨å®¹ã‚’èª¬æ˜Žã™ã‚‹ã®ã§ã¯ãªãã€ã€Œã€‡ã€‡ã«é–¢ã™ã‚‹å…·ä½“çš„ãªæ•°å­—ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€ã¨ã„ã£ãŸ **ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆã•ã‚ã‚Šï¼‰**\
            \ ã‚’çŸ­ãä¼ãˆã¦ãã ã•ã„ã€‚\n   - **Action (æœŸå¾…æ„Ÿ)**: ã€Œä»Šã€ã“ã‚Œã‚‰ã‚’çµ±åˆã—ã¦åˆ†ã‹ã‚Šã‚„ã™ãã¾ã¨ã‚ã¾ã™ã­ï¼ã€ã€Œè©³ç´°ã‚’æ•´ç†ã—ã¾ã™ã®ã§å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€ã¨ã„ã£ãŸã€å‰å‘ããªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®£è¨€ã§ç· ã‚ããã£ã¦ãã ã•ã„ã€‚\n\
            \   - **Tone**: è¦ªã—ã¿ã‚„ã™ãã€æ¸©ã‹ã„å£èª¿ã€‚äº‹å‹™çš„ãªå®Œäº†å ±å‘Šï¼ˆã€Œæ¤œç´¢ãŒçµ‚äº†ã—ã¾ã—ãŸã€ç­‰ï¼‰ã¯ç¦æ­¢ã§ã™ã€‚æ–‡è„ˆã«åˆã†çµµæ–‡å­—ï¼ˆâœ¨, \U0001F50D\
            , \U0001F4A1ï¼‰ã‚’1ã¤æ·»ãˆã¦ãã ã•ã„ã€‚\n\n2. **Answer Construction**:\n   - çµè«–ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§ç°¡æ½”ã«è¨˜è¿°ã™ã‚‹ã€‚\n\
            \   - æœ¬æ–‡ä¸­ã®äº‹å®Ÿã«ã¯å¿…ãš `[1]` å½¢å¼ã®å¼•ç”¨ç•ªå·ã‚’ä»˜ä¸Žã™ã‚‹ã€‚\n\n3. **Strict JSON**:\n   - å‡ºåŠ›ã¯JSONå½¢å¼ã‚’åŽ³å®ˆã™ã‚‹ã€‚Markdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯å«ã‚ãªã„ã§ãã ã•ã„ã€‚\n\
            \n# Output Schema (Strict JSON)\n```json\n{\n  \"internal_log\": \"ã€é–‹ç™ºè€…ç”¨ãƒ­ã‚°ã€‘\\\
            n- Intent: Technical Specification Retrieval\\n- Strategy: 'sonar' model\
            \ used for 3 parallel queries.\\n- Validation: Found official docs (Source\
            \ A) and outdated blog (Source B). Prioritized A.\",\n  \"thinking\":\
            \ \"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã¯React 19ã®å…·ä½“çš„ãªå¤‰æ›´ç‚¹ã®æŠŠæ¡ã«ã‚ã‚‹ã¨ç†è§£ã—ã¾ã—ãŸã€‚ã“ã‚Œã«å¯¾ã—ã€æ¤œç´¢æˆ¦ç•¥ã§ã¯å…¬å¼ã‚µã‚¤ãƒˆãŠã‚ˆã³GitHubã®ä¸»è¦ãªãƒ‡ã‚£ã‚¹ã‚«ãƒƒã‚·ãƒ§ãƒ³ã‚’å¯¾è±¡ã«èª¿æŸ»ã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚æ¤œç´¢ã®çµæžœã€ãƒªãƒªãƒ¼ã‚¹æ—¥ã¯æœªå®šã§ã‚ã‚‹ã‚‚ã®ã®ã€Actionsã‚„useActionStateã¨ã„ã£ãŸä¸»è¦æ©Ÿèƒ½ã®ä»•æ§˜ã¯ç¢ºå®šã—ã¦ã„ã‚‹ã“ã¨ãŒåˆ¤æ˜Žã—ã¾ã—ãŸã€‚æƒ…å ±ã®é®®åº¦ã‚’è€ƒæ…®ã—ã€æ˜¨æ—¥ã®æ—¥ä»˜ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ­£ã¨ã—ã¦ã€æ©Ÿèƒ½ã®æ¦‚è¦ã¨ç§»è¡Œã®ãƒã‚¤ãƒ³ãƒˆã‚’è§£èª¬ã—ã¾ã™ã€‚\"\
            ,\n  \"answer\": \"ã“ã“ã«å›žç­”æœ¬æ–‡ã‚’è¨˜è¿°ã€‚Markdownå½¢å¼ã§ã€é‡è¦ãªç®‡æ‰€ã¯å¤ªå­—ã«ã™ã‚‹ã€‚æ–‡æœ«ã«ã¯å¿…ãšå‚ç…§ç•ªå· [1] [2]\
            \ ã‚’ã¤ã‘ã‚‹ã€‚\\n\\n### çµè«–\\n...\",\n  \"citations\": [\n    {\n      \"index\"\
            : 1,\n      \"title\": \"å…ƒãƒ‡ãƒ¼ã‚¿ã®title\",\n      \"url\": \"å…ƒãƒ‡ãƒ¼ã‚¿ã®url\",\n\
            \      \"source_name\": \"Web\"\n    }\n  ]\n}\n\n```\n\n# Example (Few-Shot)\n\
            \n**User Query:** \"React 19ã®ä¸»è¦ãªå¤‰æ›´ç‚¹ã¯ï¼Ÿ\"\n\n**Model Output:**\n\n```json\n\
            {\n  \"internal_log\": \"Intent analysis identified query as 'Technical\
            \ Research'. Strategy executed comprehensive search. Results contained\
            \ conflicts on release date; relied on Canary release notes.\",\n  \"\
            thinking\": \"ã”è³ªå•ã®æ„å›³ã¯ã€æ¬¡æœŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚ã‚‹React 19ã®æŠ€è¡“çš„ãªå¤‰æ›´ç‚¹ã‚’æŠŠæ¡ã™ã‚‹ã“ã¨ã«ã‚ã‚‹ã¨ç†è§£ã—ã¾ã—ãŸã€‚ã“ã‚Œã«åŸºã¥ãã€Reactå…¬å¼ã‚µã‚¤ãƒˆã®å…¬å¼ç™ºè¡¨ãŠã‚ˆã³é–‹ç™ºãƒãƒ¼ãƒ ã®RFCï¼ˆRequest\
            \ for Commentsï¼‰ã‚’ä¸­å¿ƒã«èª¿æŸ»ã‚’è¡Œã„ã¾ã—ãŸã€‚èª¿æŸ»ã®çµæžœã€Server Componentsã®å®‰å®šåŒ–ã‚„æ–°ã—ã„ãƒ•ãƒƒã‚¯ã®å°Žå…¥ãªã©ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ãƒ™ãƒ«ã§ã®å¤§ããªå¤‰æ›´ãŒç¢ºèªã§ãã¾ã—ãŸã€‚ç‰¹ã«ã€ŒActionsã€ã«é–¢ã™ã‚‹æƒ…å ±ã¯ç¢ºåº¦ãŒé«˜ã„ãŸã‚ã€ã“ã‚Œã‚’ä¸­å¿ƒã«æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿ã‚’å«ã‚ã¦å›žç­”ã‚’æ§‹æˆã—ã¾ã™ã€‚\"\
            ,\n  \"answer\": \"### React 19ã®ä¸»è¦ãªå¤‰æ›´ç‚¹\\n\\nReact 19ã§ã¯ã€éžåŒæœŸå‡¦ç†ã®ç®¡ç†ãŒå¤§å¹…ã«ç°¡ç´ åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚\\\
            n\\n- **Actions**: `<form>`è¦ç´ å†…ã§ã®éžåŒæœŸé·ç§»ã‚’è‡ªå‹•å‡¦ç†ã™ã‚‹æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ[1]ã€‚\\n- **useActionState**:\
            \ å‰å›žã®stateã«åŸºã¥ã„ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®çµæžœã‚’å‡¦ç†ã™ã‚‹æ–°ã—ã„ãƒ•ãƒƒã‚¯ã§ã™[2]ã€‚\\n\\nã“ã‚Œã«ã‚ˆã‚Šã€`useState` ã‚„ `useEffect`\
            \ ã«ã‚ˆã‚‹æ‰‹å‹•ç®¡ç†ãŒä¸è¦ã«ãªã‚Šã¾ã™ã€‚\",\n  \"citations\": [\n    {\n      \"index\": 1,\n\
            \      \"title\": \"React 19 Beta Upgrade Guide\",\n      \"url\": \"\
            [https://react.dev/blog/](https://react.dev/blog/)...\",\n      \"source_name\"\
            : \"Web\"\n    },\n    {\n      \"index\": 2,\n      \"title\": \"New\
            \ Hooks in React 19\",\n      \"url\": \"https://...\",\n      \"source_name\"\
            : \"Web\"\n    }\n  ]\n}\n\n```"
        - id: 377b3292-50a8-4c81-b447-7b41f82182cd
          role: user
          text: '# Input Data


            ## 1. User Query

            {{#1770869430347.text#}}


            ## 2. Context Data (Pre-analysis)

            - **Intent Analysis:** {{#17683770269110.text#}}

            (JSON: User intent & category)


            - **Search Strategy:** {{#1769666720110.text#}}

            (JSON: Search queries & model selection)


            ## 3. Search Results (Raw Material)

            {{#1769668260271.output#}}

            (Array: Search findings)


            # Instruction

            ä¸Šè¨˜ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’çµ±åˆã—ã€System Promptã§å®šç¾©ã•ã‚ŒãŸJSONãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã«å¾“ã£ã¦å›žç­”ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚'
        selected: false
        title: LLM_Synthesis
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1769668477538'
      position:
        x: 8350
        y: 659
      positionAbsolute:
        x: 8350
        y: 659
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: contains
            id: 6a4c7d92-78c4-4aef-ab6b-511adbe5f026
            value: '"search_mode": "fast"'
            varType: string
            variable_selector:
            - '1769666720110'
            - text
          id: 'true'
          logical_operator: and
        selected: false
        title: Check_Search_Mode
        type: if-else
      height: 124
      id: '1769754087217'
      position:
        x: 7040
        y: 629
      positionAbsolute:
        x: 7040
        y: 629
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\n\ndef main(strategy_json: str) -> dict:\n    \"\"\"\n\
          \    [FAST MODE - One-Shot Deep] \n    æˆ¦ç•¥JSONã‹ã‚‰å˜ä¸€ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’ç”Ÿæˆã™ã‚‹ã€‚\n  \
          \  \n    æ–¹é‡: æ¤œç´¢ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€Œ1å›žã€ã®ã¿å®Ÿè¡Œã™ã‚‹ãŒã€\n          Perplexityã¸ã®æŒ‡ç¤ºã¯ã€Œè©³ç´°ãƒ»ç¶²ç¾…çš„ã€ã«è¡Œã„ã€DEEPãƒ«ãƒ¼ãƒˆåŒç­‰ã®æƒ…å ±ã®è³ªã‚’ç¢ºä¿ã™ã‚‹ã€‚\n\
          \    \"\"\"\n    try:\n        # Markdownè¨˜æ³•ã®é™¤åŽ»ã¨ãƒ‘ãƒ¼ã‚¹\n        clean_json =\
          \ strategy_json.replace(\"```json\", \"\").replace(\"```\", \"\").strip()\n\
          \        strategy = json.loads(clean_json)\n    except:\n        # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n\
          \        strategy = {\n            \"query_main\": strategy_json, \n   \
          \         \"recency\": \"month\",\n            \"selected_model\": \"sonar-pro\"\
          \ # è©³ç´°ã‚’æ±‚ã‚ã‚‹ãŸã‚Proã‚’æŽ¨å¥¨\n        }\n\n    # --- ONE-SHOT DEEP ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ ---\n\
          \    # DEEPãƒ«ãƒ¼ãƒˆã¨åŒã˜ã€Œè©³ç´°ãƒ»ç¶²ç¾…æ€§ã€ã‚’æ±‚ã‚ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½¿ç”¨\n    system_prompt = \"\"\"\n    You\
          \ are a comprehensive research engine designed for deep analysis.\n    Your\
          \ goal is to provide EXHAUSTIVE and DETAILED information based on a single\
          \ search query.\n    \n    Guidelines:\n    1. **Detail**: Do not summarize.\
          \ Provide full context, background, and specific details.\n    2. **Length**:\
          \ Write long, comprehensive paragraphs. Maximize the information density.\n\
          \    3. **Completeness**: If there are multiple viewpoints or theories,\
          \ list ALL of them.\n    4. **Format**: Use structured formatting (Headers,\
          \ Lists) but keep the content verbose.\n    5. **Citations**: STRICTLY include\
          \ citations [1] for every fact.\n    \"\"\"\n\n    # 1. ãƒ¢ãƒ‡ãƒ«é¸æŠž\n    # è©³ç´°ã‚’æ±‚ã‚ã‚‹ãŸã‚ã€æˆ¦ç•¥æŒ‡å®šãŒãªã‘ã‚Œã°\
          \ 'sonar-pro' ã‚’å„ªå…ˆã™ã‚‹\n    model_name = strategy.get(\"selected_model\", \"\
          sonar-pro\")\n\n    # 2. ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ã®æº–å‚™ï¼ˆæœ€å¤§3ã¤ï¼‰\n    raw_domains = strategy.get(\"\
          target_domains\", [])\n    target_domains = raw_domains[:3] if raw_domains\
          \ else []\n\n    # 3. ã‚¯ã‚¨ãƒªæ³¨å…¥ç”¨ã® site: æ–‡å­—åˆ—ã‚’ä½œæˆ (Double Locking)\n    site_operator_str\
          \ = \"\"\n    if target_domains:\n        site_list = [f\"site:{d}\" for\
          \ d in target_domains]\n        site_operator_str = \" (\" + \" OR \".join(site_list)\
          \ + \")\"\n\n    # 4. åŸºæœ¬ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æ§‹ç¯‰\n    base_payload = {\n        \"model\"\
          : model_name,\n        \"temperature\": 0.4, # DEEPåŒæ§˜ã€ã‚ã‚‹ç¨‹åº¦ã®è¡¨ç¾å¹…ã‚’æŒãŸã›ã‚‹\n  \
          \      \"max_tokens\": 4096, # é•·æ–‡å›žç­”ã‚’è¨±å®¹ã™ã‚‹ãŸã‚æœ€å¤§åŒ–\n        \"return_citations\"\
          : True,\n        \"search_recency_filter\": strategy.get(\"recency\", \"\
          month\")\n    }\n    \n    # APIãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ã®ãƒ•ã‚£ãƒ«ã‚¿è¨­å®š\n    if target_domains:\n\
          \        base_payload[\"search_domain_filter\"] = target_domains\n\n   \
          \ # 5. ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ç”Ÿæˆ (Fastãƒ¢ãƒ¼ãƒ‰ã¯ Main Query 1ã¤ã®ã¿)\n    main_q = strategy.get(\"\
          query_main\")\n    payload_str = \"\"\n    \n    if main_q:\n        # ã‚¯ã‚¨ãƒªãƒ­ãƒƒã‚¯\
          \ & è©³ç´°åŒ–æŒ‡ç¤ºã®æ³¨å…¥\n        locked_query = f\"{main_q}{site_operator_str}\\n\\\
          nExplain this topic in extreme detail.\"\n        \n        current_payload\
          \ = base_payload.copy()\n        current_payload[\"messages\"] = [\n   \
          \         {\"role\": \"system\", \"content\": system_prompt},\n        \
          \    {\"role\": \"user\", \"content\": locked_query}\n        ]\n      \
          \  \n        # å˜ä¸€ã®JSONæ–‡å­—åˆ—ã¨ã—ã¦ãƒ€ãƒ³ãƒ—\n        payload_str = json.dumps(current_payload,\
          \ ensure_ascii=False)\n    \n    # å˜ä¸€ã®æ–‡å­—åˆ—å¤‰æ•°ã‚’è¿”ã™\n    return {\n        \"\
          payload\": payload_str\n    }"
        code_language: python3
        outputs:
          payload:
            children: null
            type: string
        selected: false
        title: Fast_Build_Search_Payload_List (1)
        type: code
        variables:
        - value_selector:
          - '1769666720110'
          - text
          value_type: string
          variable: strategy_json
      height: 52
      id: '17697542686310'
      position:
        x: 7402
        y: 809
      positionAbsolute:
        x: 7402
        y: 809
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        items:
        - input_type: variable
          operation: over-write
          value:
          - '17697558915520'
          - body
          variable_selector:
          - conversation
          - context_web
          write_mode: over-write
        selected: false
        title: SET_Web_Context (2)
        type: assigner
        version: '2'
      height: 84
      id: '17697542971160'
      position:
        x: 8692
        y: 940
      positionAbsolute:
        x: 8692
        y: 940
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        authorization:
          config:
            api_key: '{{#env.PerplexityApiKey#}}'
            type: bearer
          type: api-key
        body:
          data:
          - id: key-value-318
            key: ''
            type: text
            value: '{{#17697542686310.payload#}}'
          type: raw-text
        headers: Content-Type:application/json
        isInIteration: true
        isInLoop: false
        iteration_id: '1769668260271'
        method: post
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: HTTP_TOOL_Perplexity_Search
        type: http-request
        url: https://api.perplexity.ai/v2/chat/completions
        variables: []
      height: 138
      id: '17697558915520'
      position:
        x: 7764
        y: 913
      positionAbsolute:
        x: 7764
        y: 913
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
      zIndex: 1002
    - data:
        is_team_authorization: true
        paramSchemas:
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: The name of the file search store to search in (e.g., fileSearchStores/abc123)
            ja_JP: 'æ¤œç´¢å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ã‚¹ãƒˆã‚¢åï¼ˆä¾‹: fileSearchStores/abc123ï¼‰'
            pt_BR: The name of the file search store to search in (e.g., fileSearchStores/abc123)
            zh_Hans: è¦æœç´¢çš„æ–‡ä»¶æœç´¢å­˜å‚¨åç§°ï¼ˆä¾‹å¦‚ï¼šfileSearchStores/abc123ï¼‰
          label:
            en_US: Store Name
            ja_JP: ã‚¹ãƒˆã‚¢å
            pt_BR: Store Name
            zh_Hans: å­˜å‚¨åç§°
          llm_description: File search store name to query
          max: null
          min: null
          name: file_search_store_name
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: The search query or question to ask about the documents
            ja_JP: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦å°‹ã­ã‚‹æ¤œç´¢ã‚¯ã‚¨ãƒªã¾ãŸã¯è³ªå•
            pt_BR: The search query or question to ask about the documents
            zh_Hans: è¦è¯¢é—®æ–‡æ¡£çš„æœç´¢æŸ¥è¯¢æˆ–é—®é¢˜
          label:
            en_US: Query
            ja_JP: ã‚¯ã‚¨ãƒª
            pt_BR: Query
            zh_Hans: æŸ¥è¯¢
          llm_description: Search query or question
          max: null
          min: null
          name: query
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: 'Include citation information in the response (default: false)'
            ja_JP: 'ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å‡ºå…¸æƒ…å ±ã‚’å«ã‚ã‚‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰'
            pt_BR: 'Include citation information in the response (default: false)'
            zh_Hans: åœ¨å“åº”ä¸­åŒ…å«å¼•ç”¨ä¿¡æ¯ï¼ˆé»˜è®¤ï¼šfalseï¼‰
          label:
            en_US: Include Citations
            ja_JP: å‡ºå…¸ã‚’å«ã‚ã‚‹
            pt_BR: Include Citations
            zh_Hans: åŒ…å«å¼•ç”¨
          llm_description: Whether to include grounding metadata
          max: null
          min: null
          name: include_citations
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: boolean
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Optional filter expression (e.g., "author=John Doe") to search
              within a subset of documents
            ja_JP: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚µãƒ–ã‚»ãƒƒãƒˆå†…ã‚’æ¤œç´¢ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚£ãƒ«ã‚¿å¼ï¼ˆä¾‹ï¼šã€Œauthor=John Doeã€ï¼‰
            pt_BR: Optional filter expression (e.g., "author=John Doe") to search
              within a subset of documents
            zh_Hans: å¯é€‰çš„è¿‡æ»¤å™¨è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ï¼š"author=John Doe"ï¼‰ä»¥åœ¨æ–‡æ¡£å­é›†ä¸­æœç´¢
          label:
            en_US: Metadata Filter
            ja_JP: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿
            pt_BR: Metadata Filter
            zh_Hans: å…ƒæ•°æ®è¿‡æ»¤å™¨
          llm_description: Optional metadata filter for scoped search
          max: null
          min: null
          name: metadata_filter
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Gemini model to use (defaults to provider setting or gemini-2.5-flash)
            ja_JP: ä½¿ç”¨ã™ã‚‹Geminiãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®šã¾ãŸã¯gemini-2.5-flashãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
            pt_BR: Gemini model to use (defaults to provider setting or gemini-2.5-flash)
            zh_Hans: è¦ä½¿ç”¨çš„Geminiæ¨¡åž‹ï¼ˆé»˜è®¤ä¸ºæä¾›å•†è®¾ç½®æˆ–gemini-2.5-flashï¼‰
          label:
            en_US: Model
            ja_JP: ãƒ¢ãƒ‡ãƒ«
            pt_BR: Model
            zh_Hans: æ¨¡åž‹
          llm_description: Optional model override
          max: null
          min: null
          name: model
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        params:
          file_search_store_name: ''
          include_citations: ''
          metadata_filter: ''
          model: ''
          query: ''
        plugin_id: r3-yamauchi/gemini_file_search
        plugin_unique_identifier: r3-yamauchi/gemini_file_search:0.0.1@a9cf50b020b00b20f3b3f462d697f797517551d5d8bb8bf7ef078847080cabeb
        provider_icon: https://cloud.dify.ai/console/api/workspaces/current/plugin/icon?tenant_id=7c8ea1f1-d371-448a-846c-af9a868d7d0f&filename=3f9d718ced2ecb925cbe752d6311f3966405463315b8e898110f0a8cca969899.svg
        provider_id: r3-yamauchi/gemini_file_search/gemini_file_search
        provider_name: r3-yamauchi/gemini_file_search/gemini_file_search
        provider_type: builtin
        selected: false
        title: ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ã‚¹ãƒˆã‚¢ã‚’æŒ‡å®šã—ã¦æ¤œç´¢
        tool_configurations: {}
        tool_description: Geminiã® RAGæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ã‚¹ãƒˆã‚¢å†…ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã§ã‚»ãƒžãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã™
        tool_label: ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ã‚¹ãƒˆã‚¢ã‚’æŒ‡å®šã—ã¦æ¤œç´¢
        tool_name: search
        tool_node_version: '2'
        tool_parameters:
          file_search_store_name:
            type: mixed
            value: '{{#1761291739140.gemini_store_id#}}'
          include_citations:
            type: constant
            value: true
          metadata_filter:
            type: mixed
            value: ''
          model:
            type: mixed
            value: gemini-2.5-flash
          query:
            type: mixed
            value: '{{#17715726019570.structured_output.rag_search_query#}}'
        type: tool
      height: 52
      id: '1770356105216'
      position:
        x: 5632
        y: 456
      positionAbsolute:
        x: 5632
        y: 456
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        items:
        - input_type: variable
          operation: over-write
          value:
          - '1770356105216'
          - text
          variable_selector:
          - conversation
          - context_rag
          write_mode: over-write
        selected: false
        title: SET_RAG
        type: assigner
        version: '2'
      height: 84
      id: '1770356226003'
      position:
        x: 5974
        y: 440
      positionAbsolute:
        x: 5974
        y: 440
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\n\ndef main(raw_input: str) -> dict:\n    \"\"\"\n    Desktop\
          \ Intelligence Protocol Parser v2.2 (Robust Mode)\n    Safe for both JSON\
          \ Protocol (Frontend) and Plain Text (Dify Debug).\n    \"\"\"\n    \n \
          \   # 1. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®åˆæœŸåŒ– (å…¨ã¦ç©ºæ–‡å­—)\n    extracted_text = \"\"\n    extracted_store_id\
          \ = \"\"\n    extracted_store_name = \"\"\n\n    # 2. å…¥åŠ›ãŒç©º(None)ã®å ´åˆã®ã‚¬ãƒ¼ãƒ‰\n\
          \    if raw_input is None:\n        return {\n            \"text\": \"\"\
          ,\n            \"gemini_store_id\": \"\",\n            \"gemini_store_name\"\
          : \"\"\n        }\n\n    # å…¥åŠ›ã‚’æ–‡å­—åˆ—åŒ–ã—ã¦ã¨ã‚Šã‚ãˆãšãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦ä¿æŒ (ãƒ‡ãƒãƒƒã‚°ç”¨)\n    extracted_text\
          \ = str(raw_input)\n\n    try:\n        # 3. JSONãƒ‘ãƒ¼ã‚¹ã®è©¦è¡Œ\n        data =\
          \ json.loads(raw_input)\n        \n        # ãƒ‘ãƒ¼ã‚¹æˆåŠŸã—ã€ã‹ã¤è¾žæ›¸åž‹ã§ã‚ã‚‹å ´åˆã®ã¿æ§‹é€ è§£æžã‚’è¡Œã†\n\
          \        if isinstance(data, dict):\n            \n            # --- Text\
          \ Extraction ---\n            # contentã‚­ãƒ¼ãŒã‚ã‚Šã€ã‹ã¤è¾žæ›¸åž‹ã®å ´åˆ\n            content_block\
          \ = data.get(\"content\")\n            if isinstance(content_block, dict):\n\
          \                extracted_text = content_block.get(\"text\", \"\")\n  \
          \          # ã‚‚ã—contentãŒæ–‡å­—åˆ—ãªã‚‰ãã‚Œã‚’æŽ¡ç”¨\n            elif isinstance(content_block,\
          \ str):\n                extracted_text = content_block\n            \n\
          \            # --- Store ID Extraction ---\n            dify_inputs = data.get(\"\
          dify_inputs\")\n            # dify_inputsãŒè¾žæ›¸åž‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ (ã“ã“ãŒã‚¨ãƒ©ãƒ¼ã®åŽŸå› ã§ã—ãŸ)\n\
          \            if isinstance(dify_inputs, dict):\n                if \"gemini_store_id\"\
          \ in dify_inputs:\n                    extracted_store_id = dify_inputs[\"\
          gemini_store_id\"]\n            \n            # Fallback to Context ID\n\
          \            if not extracted_store_id:\n                context = data.get(\"\
          context\")\n                if isinstance(context, dict):\n            \
          \        selected_ids = context.get(\"selected_store_ids\")\n          \
          \          if isinstance(selected_ids, list) and len(selected_ids) > 0:\n\
          \                        extracted_store_id = selected_ids[0]\n\n      \
          \      # --- Store Name Extraction ---\n            context = data.get(\"\
          context\")\n            if isinstance(context, dict):\n                selected_names\
          \ = context.get(\"selected_store_names\")\n                if isinstance(selected_names,\
          \ list) and len(selected_names) > 0:\n                    extracted_store_name\
          \ = selected_names[0]\n\n    except (json.JSONDecodeError, TypeError):\n\
          \        # JSONã§ãªã„å ´åˆï¼ˆãƒ‡ãƒãƒƒã‚°ã§ã®ç›´æŽ¥å…¥åŠ›ãªã©ï¼‰ã¯ã€\n        # extracted_text = raw_input\
          \ ã®ã¾ã¾å‡¦ç†ã‚’ç¶šè¡Œã™ã‚‹ï¼ˆã‚¨ãƒ©ãƒ¼ã«ã—ãªã„ï¼‰\n        pass\n    except Exception as e:\n      \
          \  # ãã®ä»–ã®äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ã¯ãƒ­ã‚°ã«å‡ºã—ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¿”ã™\n        print(f\"Parser Warning: {e}\"\
          )\n\n    # 4. çµæžœã®è¿”å´\n    return {\n        \"text\": extracted_text,\n \
          \       \"gemini_store_id\": extracted_store_id,\n        \"gemini_store_name\"\
          : extracted_store_name\n    }"
        code_language: python3
        outputs:
          gemini_store_id:
            children: null
            type: string
          gemini_store_name:
            children: null
            type: string
          text:
            children: null
            type: string
        selected: false
        title: PROTOCOL_PARSER
        type: code
        variables:
        - value_selector:
          - sys
          - query
          value_type: string
          variable: raw_input
      height: 52
      id: '1770869430347'
      position:
        x: 342
        y: 146
      positionAbsolute:
        x: 342
        y: 146
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: 3fce1fbd-1623-4469-8b7f-41502d9f9e4f
            value: true
            varType: boolean
            variable_selector:
            - '1761291739140'
            - rag_enabled
          id: 'true'
          logical_operator: and
        selected: false
        title: GATE_Check_Rag_Enabled
        type: if-else
      height: 124
      id: '1770871562386'
      position:
        x: 2816
        y: 128
      positionAbsolute:
        x: 2816
        y: 128
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: true
            size: 10
        model:
          completion_params: {}
          mode: chat
          name: gemini-2.5-flash-lite
          provider: langgenius/gemini/google
        prompt_template:
        - id: b695f1a9-a7a1-4314-b497-cf46a845994b
          role: system
          text: "# Role\nã‚ãªãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã‚’è§£æžã—ã€ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢(RAG)ã®è¦å¦ã‚’åˆ¤æ–­ã™ã‚‹ã€Œã‚¤ãƒ³ãƒ†ãƒ³ãƒˆãƒ»ã‚¢ãƒŠãƒªã‚¹ãƒˆï¼ˆRAGç‰¹åŒ–ãƒ¢ãƒ¼ãƒ‰ï¼‰ã€ã§ã™ã€‚\n\
            ç¾åœ¨ã®è¨­å®šã§ã¯ **Webæ¤œç´¢ã¯ç„¡åŠ¹åŒ–** ã•ã‚Œã¦ã„ã¾ã™ã€‚\næä¾›ã•ã‚ŒãŸã‚¹ã‚­ãƒ¼ãƒžã«å¾“ã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚’åˆ†æžã—ã€åˆ¶å¾¡ä¿¡å·ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\
            \n# Classification Rules\n\n## 1. Category Determination (æœ€é‡è¦ãƒ«ãƒ¼ãƒ«)\nãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›å†…å®¹ã«åŸºã¥ã„ã¦ã€ä»¥ä¸‹ã®åŸºæº–ã§å¿…ãšã©ã¡ã‚‰ã‹ã«åˆ†é¡žã—ã¦ãã ã•ã„ã€‚\n\
            - **\"TASK\"**: æ¥­å‹™ã«é–¢ã™ã‚‹è³ªå•ã€èª¿æŸ»ã€ã“ã‚Œã¾ã§ã®ä¼šè©±ã®æ·±æŽ˜ã‚Šã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç¢ºèªãªã©ã€‚â€»RAGæ¤œç´¢ãŒå¿…è¦ã‹ä¸è¦ã‹ã«ã‹ã‹ã‚ã‚‰ãšã€è³ªå•ã‚„æ¥­å‹™ã®æ–‡è„ˆã§ã‚ã‚Œã°å¿…ãš\
            \ \"TASK\" ã«åˆ†é¡žã—ã¦ãã ã•ã„ã€‚\n- **\"CHAT\"**: ã€Œã“ã‚“ã«ã¡ã¯ã€ã€Œã‚ã‚ŠãŒã¨ã†ã€ã€Œä»Šæ—¥ã®å¤©æ°—ã¯ï¼Ÿã€ãªã©ã€æ¥­å‹™ã‚„èª¿æŸ»ã«ä¸€åˆ‡é–¢ä¿‚ã®ãªã„ç´”ç²‹ãªæŒ¨æ‹¶ã‚„æ—¥å¸¸ã®é›‘è«‡ã®ã¿ã€‚\n\
            \n## 2. RAG Requirement Check\nå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã¨ `Conversation History` (ãŠã‚ˆã³éŽåŽ»ã® `context_rag`)\
            \ ã‚’ç¢ºèªã—ã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ã®è¦å¦ã‚’åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚\n- **ã€RAGæ¤œç´¢ãŒå¿…è¦ãªå ´åˆ (requires_rag: true)ã€‘**:\n\
            \  - ä¼šè©±å±¥æ­´ã‚„ä¿æŒã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«æƒ…å ±ãŒãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«ç­”ãˆã‚‹ãŸã‚ã«ç¤¾å†…è¦å®šã‚„æ¥­å‹™ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç¢ºèªãŒå¿…è¦ãªå ´åˆã€‚\n \
            \ - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜Žç¤ºçš„ã«ã€Œè³‡æ–™ã‹ã‚‰æŽ¢ã—ã¦ã€ã€Œè¦å®šã‚’ç¢ºèªã—ã¦ã€ã¨æ±‚ã‚ãŸå ´åˆã€‚\n- **ã€RAGæ¤œç´¢ãŒä¸è¦ãªå ´åˆ (requires_rag:\
            \ false)ã€‘**:\n  - ç›´å‰ã®ä¼šè©±å±¥æ­´ã‚„æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ä¸­ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã™ã‚‹ã€Œæ˜Žç¢ºãªç­”ãˆã€ãŒæ—¢ã«å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆï¼ˆæ·±æŽ˜ã‚Šè³ªå•ã‚„å†ç¢ºèªãªã©ã€æ¤œç´¢ã—ç›´ã•ãªãã¦ã‚‚å›žç­”ã§ãã‚‹å ´åˆï¼‰ã€‚\n\
            \n# Field Generation Guidelines (ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç”Ÿæˆã®æŒ‡é‡)\n\n1. **internal_log**:\n\
            \   - æŽ¨è«–ã®æ ¹æ‹ ã‚’æŠ€è¡“çš„ãª**ã€Œæ—¥æœ¬èªžã€**ã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚\n   - è¨˜è¼‰ä¾‹: \"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å‡ºå¼µæ—…è²»ã«ã¤ã„ã¦è³ªå•ã—ã¦ã„ã‚‹ã€‚éŽåŽ»ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«æƒ…å ±ãŒãªã„ãŸã‚ã‚«ãƒ†ã‚´ãƒªã‚’TASKã¨ã—ã€requires_ragã‚’trueã«è¨­å®šã€‚\"\
            \n   - è¨˜è¼‰ä¾‹: \"ç›´å‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«é–¢ã™ã‚‹è¿½åŠ è³ªå•ã€‚å±¥æ­´å†…ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§å®Œçµã™ã‚‹ãŸã‚ã‚«ãƒ†ã‚´ãƒªã¯TASKã ãŒã€æ–°ãŸãªæ¤œç´¢ã¯ä¸è¦ã¨ã—ã¦requires_ragã¯falseã«è¨­å®šã€‚\"\
            \n\n2. **category**:\n   - ä¸Šè¨˜ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ã `\"TASK\"` ã¾ãŸã¯ `\"CHAT\"` ã‚’é¸æŠžã—ã¦ãã ã•ã„ã€‚\n\
            \n3. **thinking**:\n   - **requires_rag: true ã®å ´åˆ**:\n     - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦ã€ŒçŠ¶æ³ã«åˆã‚ã›ãŸæŒ¨æ‹¶ã€ã¨ã€Œå…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚’å‹•çš„ã«å®£è¨€ã—ã¦ãã ã•ã„ã€‚\n\
            \     - **æ™‚é–“å¸¯ã®è€ƒæ…®**: 05:00-10:59ã€ŒãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€ã€11:00-16:59ã€Œã“ã‚“ã«ã¡ã¯ã€ã€17:00-ã€ŒãŠç–²ã‚Œæ§˜ã§ã™/ã“ã‚“ã°ã‚“ã¯ã€\n\
            \     - **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: ã€Œç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¾ã™ã­ã€ã€Œè©²å½“ã®è³‡æ–™ã‚’ãŠèª¿ã¹ã—ã¾ã™ã€ã¨è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚ï¼ˆâ€»åˆå›žã®ã¿æŒ¨æ‹¶ã‚’å«ã‚ã€2å›žç›®ä»¥é™ã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿ï¼‰\n\
            \   - **requires_rag: false ã®å ´åˆ**:\n     - **å¿…ãšç©ºæ–‡å­— `\"\"` ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚**\n\
            \n4. **requires_web / requires_rag**:\n   - `requires_web`: ã“ã®ãƒ¢ãƒ¼ãƒ‰ã§ã¯å¸¸ã«\
            \ `false` ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚\n   - `requires_rag`: ä¸Šè¨˜ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ãè¦å¦ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚"
        - id: ef524c95-4ecd-45de-9717-8e3d776e0ccc
          role: user
          text: '# Input Data


            ## User Query

            {{#1770869430347.text#}}


            ## Current Time

            {{#1761291739140.current_time#}}


            ## User Profile (Context)

            {{#1761291739140.system_prompt#}}

            â€»ã“ã“ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å±žæ€§ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚`thinking` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç”Ÿæˆæ™‚ã«å‚ç…§ã—ã¦ãã ã•ã„ã€‚


            ## ç¾åœ¨ä¿æŒã—ã¦ã„ã‚‹ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸ (context_rag)

            {{#conversation.context_rag#}}

            â€»ã“ã“ãŒç©ºã§ã¯ãªã„å ´åˆã€ã™ã§ã«ä¸€åº¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–°ã—ã„è³ªå•ãŒã“ã®å†…å®¹ã ã‘ã§ç­”ãˆã‚‰ã‚Œã‚‹æ·±æŽ˜ã‚Šè³ªå•ã§ã‚ã‚Œã°ã€å†æ¤œç´¢ã¯ä¸è¦
            (`requires_rag: false`) ã¨åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚


            ## Conversation History

            â€»Difyã®ãƒ¡ãƒ¢ãƒªæ©Ÿèƒ½ã«ã‚ˆã‚Šè‡ªå‹•ä»˜ä¸Žã•ã‚Œã‚‹ä¼šè©±å±¥æ­´ã‚’å‚ç…§ã—ã€æ–‡è„ˆã‚’åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚'
        selected: false
        structured_output:
          schema:
            properties:
              category:
                description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚«ãƒ†ã‚´ãƒªã€‚é›‘è«‡ã‚„ä¸€èˆ¬ä¼šè©±ã¯CHATã€æ¥­å‹™ã«é–¢ã™ã‚‹è³ªå•ã‚„èª¿æŸ»ã¯TASKã€‚
                enum:
                - CHAT
                - TASK
                type: string
              internal_log:
                description: ã€é–‹ç™ºè€…ç”¨ãƒ­ã‚°ã€‘æŽ¨è«–ãƒ—ãƒ­ã‚»ã‚¹ã€‚ãªãœãã®ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠžã—ãŸã‹ã€ä¼šè©±å±¥æ­´ã®æœ‰ç„¡ã‚„ç‰¹å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«åŸºã¥ã„ãŸåˆ¤æ–­ç†ç”±ã‚’è¨˜è¿°ã™ã‚‹ã€‚
                type: string
              requires_rag:
                description: RAGï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ï¼‰ãŒå¿…è¦ã‹ã©ã†ã‹ã€‚categoryãŒTASKã®ä¸­ã§ã€éŽåŽ»ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ(context_rag)ã«æƒ…å ±ãŒãªãã€æ–°ãŸãªæ¤œç´¢ãŒå¿…è¦ãªå ´åˆã«trueã€‚
                type: boolean
              requires_web:
                description: Webæ¤œç´¢ãŒå¿…è¦ã‹ã©ã†ã‹ã€‚ã“ã®ãƒ¢ãƒ¼ãƒ‰ã§ã¯å¸¸ã«falseã€‚
                type: boolean
              thinking:
                description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®çŠ¶æ³ã«å¿œã˜ãŸæŒ¨æ‹¶ã¨ã€å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®£è¨€ã€‚TASKã®å ´åˆã¯ã€Žç¤¾å†…è³‡æ–™ã‚’ç¢ºèªã—ã¾ã™ã­âœ¨ã€ã€CHATã®å ´åˆã¯ç©ºæ–‡å­—ã€‚
                type: string
            required:
            - internal_log
            - category
            - thinking
            - requires_web
            - requires_rag
            type: object
        structured_output_enabled: true
        title: LLM_Intent_Analysis_RAG
        type: llm
        vision:
          enabled: false
      height: 88
      id: '17708716964770'
      position:
        x: 3178
        y: 183
      positionAbsolute:
        x: 3178
        y: 183
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        output_type: string
        selected: false
        title: intent_result
        type: variable-aggregator
        variables:
        - - '17708716964770'
          - text
        - - '17683770269110'
          - text
      height: 134
      id: '1770871743875'
      position:
        x: 3540
        y: 138
      positionAbsolute:
        x: 3540
        y: 138
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        is_team_authorization: true
        paramSchemas:
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: The name of the file search store to search in (e.g., fileSearchStores/abc123)
            ja_JP: 'æ¤œç´¢å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ã‚¹ãƒˆã‚¢åï¼ˆä¾‹: fileSearchStores/abc123ï¼‰'
            pt_BR: The name of the file search store to search in (e.g., fileSearchStores/abc123)
            zh_Hans: è¦æœç´¢çš„æ–‡ä»¶æœç´¢å­˜å‚¨åç§°ï¼ˆä¾‹å¦‚ï¼šfileSearchStores/abc123ï¼‰
          label:
            en_US: Store Name
            ja_JP: ã‚¹ãƒˆã‚¢å
            pt_BR: Store Name
            zh_Hans: å­˜å‚¨åç§°
          llm_description: File search store name to query
          max: null
          min: null
          name: file_search_store_name
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: The search query or question to ask about the documents
            ja_JP: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦å°‹ã­ã‚‹æ¤œç´¢ã‚¯ã‚¨ãƒªã¾ãŸã¯è³ªå•
            pt_BR: The search query or question to ask about the documents
            zh_Hans: è¦è¯¢é—®æ–‡æ¡£çš„æœç´¢æŸ¥è¯¢æˆ–é—®é¢˜
          label:
            en_US: Query
            ja_JP: ã‚¯ã‚¨ãƒª
            pt_BR: Query
            zh_Hans: æŸ¥è¯¢
          llm_description: Search query or question
          max: null
          min: null
          name: query
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: 'Include citation information in the response (default: false)'
            ja_JP: 'ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å‡ºå…¸æƒ…å ±ã‚’å«ã‚ã‚‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰'
            pt_BR: 'Include citation information in the response (default: false)'
            zh_Hans: åœ¨å“åº”ä¸­åŒ…å«å¼•ç”¨ä¿¡æ¯ï¼ˆé»˜è®¤ï¼šfalseï¼‰
          label:
            en_US: Include Citations
            ja_JP: å‡ºå…¸ã‚’å«ã‚ã‚‹
            pt_BR: Include Citations
            zh_Hans: åŒ…å«å¼•ç”¨
          llm_description: Whether to include grounding metadata
          max: null
          min: null
          name: include_citations
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: boolean
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Optional filter expression (e.g., "author=John Doe") to search
              within a subset of documents
            ja_JP: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚µãƒ–ã‚»ãƒƒãƒˆå†…ã‚’æ¤œç´¢ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚£ãƒ«ã‚¿å¼ï¼ˆä¾‹ï¼šã€Œauthor=John Doeã€ï¼‰
            pt_BR: Optional filter expression (e.g., "author=John Doe") to search
              within a subset of documents
            zh_Hans: å¯é€‰çš„è¿‡æ»¤å™¨è¡¨è¾¾å¼ï¼ˆä¾‹å¦‚ï¼š"author=John Doe"ï¼‰ä»¥åœ¨æ–‡æ¡£å­é›†ä¸­æœç´¢
          label:
            en_US: Metadata Filter
            ja_JP: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿
            pt_BR: Metadata Filter
            zh_Hans: å…ƒæ•°æ®è¿‡æ»¤å™¨
          llm_description: Optional metadata filter for scoped search
          max: null
          min: null
          name: metadata_filter
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Gemini model to use (defaults to provider setting or gemini-2.5-flash)
            ja_JP: ä½¿ç”¨ã™ã‚‹Geminiãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®šã¾ãŸã¯gemini-2.5-flashãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
            pt_BR: Gemini model to use (defaults to provider setting or gemini-2.5-flash)
            zh_Hans: è¦ä½¿ç”¨çš„Geminiæ¨¡åž‹ï¼ˆé»˜è®¤ä¸ºæä¾›å•†è®¾ç½®æˆ–gemini-2.5-flashï¼‰
          label:
            en_US: Model
            ja_JP: ãƒ¢ãƒ‡ãƒ«
            pt_BR: Model
            zh_Hans: æ¨¡åž‹
          llm_description: Optional model override
          max: null
          min: null
          name: model
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        params:
          file_search_store_name: ''
          include_citations: ''
          metadata_filter: ''
          model: ''
          query: ''
        plugin_id: r3-yamauchi/gemini_file_search
        plugin_unique_identifier: r3-yamauchi/gemini_file_search:0.0.1@a9cf50b020b00b20f3b3f462d697f797517551d5d8bb8bf7ef078847080cabeb
        provider_icon: https://cloud.dify.ai/console/api/workspaces/current/plugin/icon?tenant_id=7c8ea1f1-d371-448a-846c-af9a868d7d0f&filename=3f9d718ced2ecb925cbe752d6311f3966405463315b8e898110f0a8cca969899.svg
        provider_id: r3-yamauchi/gemini_file_search/gemini_file_search
        provider_name: r3-yamauchi/gemini_file_search/gemini_file_search
        provider_type: builtin
        selected: false
        title: æŒ‡å®šã•ã‚ŒãŸã‚¹ãƒˆã‚¢ã®è¦ç´„
        tool_configurations: {}
        tool_description: Geminiã® RAGæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ã‚¹ãƒˆã‚¢å†…ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå…¨ä½“ã§ã‚»ãƒžãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã™
        tool_label: ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ã‚¹ãƒˆã‚¢ã‚’æŒ‡å®šã—ã¦æ¤œç´¢
        tool_name: search
        tool_node_version: '2'
        tool_parameters:
          file_search_store_name:
            type: mixed
            value: '{{#1761291739140.gemini_store_id#}}'
          include_citations:
            type: constant
            value: null
          metadata_filter:
            type: mixed
            value: null
          model:
            type: mixed
            value: gemini-2.5-flash-lite
          query:
            type: mixed
            value: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•: {{#1770869430347.text#}}\n\nã€AIã®æŽ¨è«–ãƒ­ã‚°ï¼ˆæ¤œç´¢ã®ãƒ’ãƒ³ãƒˆï¼‰ã€‘\n{{#17708716964770.structured_output.internal_log#}}\n\
              \nã€æŒ‡å®šã•ã‚ŒãŸã‚¹ãƒˆã‚¢å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã€‘\n{{#1771573783623.text#}}\n\nä¸Šè¨˜ã®ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã€ã€ŒAIã®æŽ¨è«–ãƒ­ã‚°ã€ãŠã‚ˆãŠã³ã€ŒæŒ‡å®šã•ã‚ŒãŸã‚¹ãƒˆã‚¢å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã€ã‚’è¸ã¾ãˆã€ã“ã®ã‚¹ãƒˆã‚¢å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã©ã®ã‚ˆã†ã«å½¹ç«‹ã¤ã‹ã‚’åˆ¤æ–­ã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®2ã¤ã®è¦³ç‚¹ã§åˆ†æžãƒ»å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\
              \n1. **ã€è³ªå•ã¨ã®é–¢é€£æ€§ï¼ˆç°¡æ˜“æ¤œç´¢ï¼‰ã€‘**\n   æŽ¨è«–ãƒ­ã‚°ã§æŒ‡æ‘˜ã•ã‚ŒãŸæ„å›³ã‚„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«æœ€ã‚‚é–¢é€£ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŽ¢ã—ã€ãã®ã€Œãƒ•ã‚¡ã‚¤ãƒ«åã€ã¨ã€Œé–¢é€£ã™ã‚‹è¨˜è¿°ã®æŠœç²‹ã€ã‚’æŒ™ã’ã¦ãã ã•ã„ã€‚ã‚‚ã—è³ªå•ãŒæŠ½è±¡çš„ãªå ´åˆã¯ã€æŽ¨è«–ãƒ­ã‚°ã‚’å‚è€ƒã«ä¸­å¿ƒã¨ãªã‚Šãã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŽ¨æ¸¬ã—ã¦ãã ã•ã„ã€‚\n\
              \n2. **ã€ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®è¦ç´„ã€‘**\n   ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‚’æŠŠæ¡ã™ã‚‹ãŸã‚ã€å…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã€ãã‚Œãžã‚Œã®å†…å®¹ã‚’1æ–‡ã§è¦ç´„ã—ã¦ãã ã•ã„ã€‚\n\
              \n---\nã€å‡ºåŠ›å½¢å¼ã€‘\n### \U0001F3AF è³ªå•ã¨ã®é–¢é€£ï¼ˆãƒ’ãƒƒãƒˆã—ãŸæƒ…å ±ï¼‰\n- **æœ€ã‚‚é–¢é€£ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«**: [ãƒ•ã‚¡ã‚¤ãƒ«å]\n\
              - **é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰/è¨˜è¿°**: [è³ªå•ã«é–¢é€£ã™ã‚‹ç”¨èªžã‚„è¨˜è¿°ã‚’æŠœç²‹]\n- **æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: [ã€Œã€‡ã€‡ã«ã¤ã„ã¦è©³ã—ãç¢ºèªã™ã¹ãã€ãªã©]\n\
              \n### \U0001F4C2 ã‚¹ãƒˆã‚¢å†…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆå…¨ä½“åƒï¼‰\n- ãƒ•ã‚¡ã‚¤ãƒ«1: [ãƒ•ã‚¡ã‚¤ãƒ«å]\n  [è¦ç´„]\n- ãƒ•ã‚¡ã‚¤ãƒ«2:\
              \ [ãƒ•ã‚¡ã‚¤ãƒ«å]\n  [è¦ç´„]\n...\nå…¨ä½“ãƒ†ãƒ¼ãƒž: [1æ–‡]"
        type: tool
      height: 52
      id: '1771391749204'
      position:
        x: 4948
        y: 456
      positionAbsolute:
        x: 4948
        y: 456
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-2.5-flash-lite
          provider: langgenius/gemini/google
        prompt_template:
        - id: 4f25aea0-7407-404f-bc0f-f90215ebd5b7
          role: system
          text: "# Role\nã‚ãªãŸã¯ã€ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ¤œç´¢æˆ¦ç•¥ã‚’ç«‹æ¡ˆã™ã‚‹ã€Œã‚·ãƒ‹ã‚¢ãƒ»ãƒªã‚µãƒ¼ãƒãƒ»ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ã‚¹ãƒˆã€ã§ã™ã€‚\næä¾›ã•ã‚ŒãŸã€Œã‚¹ãƒˆã‚¢å†…ãƒ•ã‚¡ã‚¤ãƒ«ã®è¦ç´„æƒ…å ±ã€ã‚’èª­ã¿è§£ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã™ã‚‹æœ€é©ãªæ¤œç´¢ã‚¯ã‚¨ãƒªï¼ˆrag_search_queryï¼‰ã‚’ç”Ÿæˆã—ã€ã©ã®ã‚ˆã†ãªæ–¹é‡ã§æ¤œç´¢ã‚’è¡Œã†ã‹ï¼ˆthinkingï¼‰ã‚’å®£è¨€ã—ã¦ãã ã•ã„ã€‚\n\
            \n# Guidelines\n\n## 1. Query Optimization (RAGå‘ã‘ã‚¯ã‚¨ãƒªæœ€é©åŒ–)\n- RAGï¼ˆãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ï¼‰ã‚¨ãƒ³ã‚¸ãƒ³ã¯ã€å˜èªžã®ç¾…åˆ—ã‚ˆã‚Šã‚‚ã€Œè‡ªç„¶è¨€èªžã®å®Œå…¨ãªæ–‡ã€ã®æ–¹ãŒç²¾åº¦ãŒé«˜ããªã‚Šã¾ã™ã€‚\n\
            - ã‚¹ãƒˆã‚¢è¦ç´„ï¼ˆstore_summaryï¼‰ã®ä¸­ã«ã€è³ªå•ã«é–¢é€£ã—ãã†ãªã€Œå…·ä½“çš„ãªãƒ•ã‚¡ã‚¤ãƒ«åã€ã‚„ã€Œå°‚é–€ç”¨èªžã€ãŒã‚ã‚Œã°ã€ãã‚Œã‚’ç©æ¥µçš„ã«ã‚¯ã‚¨ãƒªã«çµ„ã¿è¾¼ã‚“ã§ãã ã•ã„ã€‚\n\
            \  - æ‚ªã„ä¾‹: ã€Œæ—…è²» è¦å®šã€\n  - è‰¯ã„ä¾‹: ã€Œã€Žæ—…è²»ãƒ»çµŒè²»ç²¾ç®—è¦ç¨‹_2024.pdfã€ã«åŸºã¥ã„ã¦ã€æ–°å¹¹ç·šã®ã‚°ãƒªãƒ¼ãƒ³è»Šåˆ©ç”¨ã«é–¢ã™ã‚‹è¦å®šã‚’æ•™ãˆã¦ãã ã•ã„ã€‚ã€\n\
            \n## 2. Output Requirements (ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ç”Ÿæˆãƒ«ãƒ¼ãƒ«)\n- **internal_log**: æŽ¨è«–ã®æ ¹æ‹ ã‚’æŠ€è¡“çš„ãªæ—¥æœ¬èªžã§è¨˜è¿°ã€‚\n\
            - **thinking**: \n  - **Concept**: ä¿¡é ¼ã§ãã‚‹åŒåƒšã¨ã—ã¦ã€æ€è€ƒã®çµæžœï¼ˆãƒªã‚µãƒ¼ãƒè¨ˆç”»ï¼‰ã‚’å ±å‘Šã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã€‚\n\
            \  - **å†’é ­ãƒ•ãƒ¬ãƒ¼ã‚º**: å¿…ãšä»¥ä¸‹ã®ã„ãšã‚Œã‹ã‹ã‚‰å§‹ã‚ã¦ãã ã•ã„ã€‚\n    - ã€Œæ–¹é‡ãŒã¾ã¨ã¾ã‚Šã¾ã—ãŸã€‚ã€\n    - ã€Œæˆ¦ç•¥ã‚’å ±å‘Šã—ã¾ã™ã€‚ã€\n\
            \    - ã€Œä»¥ä¸‹ã®ãƒ—ãƒ©ãƒ³ã§èª¿æŸ»ã‚’é€²ã‚ã¾ã™ã€‚ã€\n  - **ç¦æ­¢äº‹é …**: ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆã€‡ã€‡ã•ã‚“ï¼‰ã®å‘¼ã³ã‹ã‘ã‚„ã€ã€Œã“ã‚“ã«ã¡ã¯ã€ç­‰ã®æŒ¨æ‹¶ã¯ç¦æ­¢ï¼ˆå‰ã®ãƒŽãƒ¼ãƒ‰ã§å®Ÿæ–½æ¸ˆã¿ã®ãŸã‚ï¼‰ã€‚\n\
            \n# Output Format\nå¿…ãšJSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚Markdownã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ä¸è¦ã§ã™ã€‚"
        - id: 276801ae-a5aa-4da2-a08a-d34103694b53
          role: user
          text: '# Input Data


            ## 1. User Query

            {{#sys.query#}}


            ## 2. ã‚¹ãƒˆã‚¢å†…ãƒ•ã‚¡ã‚¤ãƒ«ã®è¦ç´„æƒ…å ± (Context)

            {{#1771391749204.text#}}

            â€»ã“ã®æƒ…å ±ã‚’æ‰‹ãŒã‹ã‚Šã«ã—ã¦ã€æœ€é©ãª rag_search_query ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚


            ###.ã‚¹ãƒˆã‚¢å†…ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

            {{#1771573783623.text#}}

            â€»ã“ã®æƒ…å ±ã‚’ã•ã‚‰ã«æ‰‹ãŒã‹ã‚Šã«ã—ã¦ã€æœ€é©ãª rag_search_query ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚


            ## 3. Previous AI Output (Context)

            {{#17708716964770.structured_output.thinking#}}

            â€»ç›´å‰ã®ã‚¤ãƒ³ãƒ†ãƒ³ãƒˆåˆ†æžãƒŽãƒ¼ãƒ‰ã§ç”Ÿæˆã•ã‚ŒãŸAIã®ç™ºè¨€ã§ã™ã€‚ã“ã“ã‹ã‚‰è‡ªç„¶ã«ç¶šãã‚ˆã†ã« `thinking` ã‚’æ§‹æˆã—ã¦ãã ã•ã„ã€‚'
        selected: false
        structured_output:
          schema:
            properties:
              internal_log:
                description: ã€é–‹ç™ºè€…ç”¨ãƒ­ã‚°ã€‘ã‚¹ãƒˆã‚¢ã®è¦ç´„æƒ…å ±ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚’æ¯”è¼ƒã—ã€ã©ã®ã‚ˆã†ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã™ã‚‹ã®ãŒæœ€é©ã‹ã€ãã®æŽ¨è«–ãƒ—ãƒ­ã‚»ã‚¹ã‚’è¨˜è¿°ã™ã‚‹ã€‚
                type: string
              rag_search_query:
                description: RAGæ¤œç´¢ã«ä½¿ç”¨ã™ã‚‹æœ€é©åŒ–ã•ã‚ŒãŸæ¤œç´¢ã‚¯ã‚¨ãƒªã€‚å˜ãªã‚‹å˜èªžã®ç¾…åˆ—ã§ã¯ãªãã€ã‚¹ãƒˆã‚¢è¦ç´„å†…ã®å°‚é–€ç”¨èªžã‚’ç”¨ã„ãŸã€Žå®Œå…¨ãªè‡ªç„¶è¨€èªžã®è³ªå•æ–‡ã€ã«ã™ã‚‹ã“ã¨ã€‚
                type: string
              thinking:
                description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®èª¿æŸ»æ–¹é‡ã®å ±å‘Šã€‚ã€Žæ–¹é‡ãŒã¾ã¨ã¾ã‚Šã¾ã—ãŸã€‚ã€‡ã€‡ã«ã¤ã„ã¦ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ¤œç´¢ã—ã¾ã™ã€ã¨ã„ã£ãŸå ±å‘Šç”¨ãƒ•ãƒ¬ãƒ¼ã‚ºã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã€‚æŒ¨æ‹¶ã¯ç¦æ­¢ã€‚
                type: string
            required:
            - internal_log
            - thinking
            - rag_search_query
            type: object
        structured_output_enabled: true
        title: LLM_RAG_Strategy
        type: llm
        vision:
          enabled: false
      height: 88
      id: '17715726019570'
      position:
        x: 5290
        y: 438
      positionAbsolute:
        x: 5290
        y: 438
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        is_team_authorization: true
        paramSchemas:
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: File search store resource name (e.g., fileSearchStores/abc123)
            ja_JP: 'ãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ã‚¹ãƒˆã‚¢ã®ãƒªã‚½ãƒ¼ã‚¹åï¼ˆä¾‹: fileSearchStores/abc123ï¼‰'
            pt_BR: File search store resource name (e.g., fileSearchStores/abc123)
            zh_Hans: æ–‡ä»¶æœç´¢å­˜å‚¨èµ„æºåç§°ï¼ˆä¾‹å¦‚ï¼šfileSearchStores/abc123ï¼‰
          label:
            en_US: Store Name
            ja_JP: ã‚¹ãƒˆã‚¢å
            pt_BR: Store Name
            zh_Hans: å­˜å‚¨åç§°
          llm_description: File search store containing the documents
          max: null
          min: null
          name: file_search_store_name
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Optional page size (1-100). Defaults to the API setting.
            ja_JP: ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚ºï¼ˆ1ã€œ100ï¼‰ã€‚æœªè¨­å®šæ™‚ã¯APIãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€‚
            pt_BR: Optional page size (1-100). Defaults to the API setting.
            zh_Hans: å¯é€‰é¡µé¢å¤§å°ï¼ˆ1-100ï¼‰ã€‚æœªè®¾ç½®æ—¶ä½¿ç”¨APIé»˜è®¤ã€‚
          label:
            en_US: Page Size
            ja_JP: ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚º
            pt_BR: Page Size
            zh_Hans: é¡µé¢å¤§å°
          llm_description: Optional page size limit (max 100)
          max: null
          min: null
          name: page_size
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: number
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: Provide the token from a previous response to fetch the next page
            ja_JP: å‰å›žãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§å—ã‘å–ã£ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã¨æ¬¡ãƒšãƒ¼ã‚¸ã‚’å–å¾—ã§ãã¾ã™
            pt_BR: Provide the token from a previous response to fetch the next page
            zh_Hans: æä¾›ä¸Šä¸€æ¬¡å“åº”ä¸­çš„ä»¤ç‰Œä»¥èŽ·å–ä¸‹ä¸€é¡µ
          label:
            en_US: Page Token
            ja_JP: ãƒšãƒ¼ã‚¸ãƒˆãƒ¼ã‚¯ãƒ³
            pt_BR: Page Token
            zh_Hans: é¡µé¢ä»¤ç‰Œ
          llm_description: Page token for pagination
          max: null
          min: null
          name: page_token
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        params:
          file_search_store_name: ''
          page_size: ''
          page_token: ''
        plugin_id: r3-yamauchi/gemini_file_search
        plugin_unique_identifier: r3-yamauchi/gemini_file_search:0.0.1@a9cf50b020b00b20f3b3f462d697f797517551d5d8bb8bf7ef078847080cabeb
        provider_icon: https://cloud.dify.ai/console/api/workspaces/current/plugin/icon?tenant_id=7c8ea1f1-d371-448a-846c-af9a868d7d0f&filename=3f9d718ced2ecb925cbe752d6311f3966405463315b8e898110f0a8cca969899.svg
        provider_id: r3-yamauchi/gemini_file_search/gemini_file_search
        provider_name: r3-yamauchi/gemini_file_search/gemini_file_search
        provider_type: builtin
        selected: false
        title: ã‚¹ãƒˆã‚¢å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§
        tool_configurations: {}
        tool_description: ç¾åœ¨ã®Geminiãƒ•ã‚¡ã‚¤ãƒ«æ¤œç´¢ã‚¹ãƒˆã‚¢ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã•ã‚Œã¦ã„ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä¸€è¦§è¡¨ç¤ºã—ã¾ã™
        tool_label: ã‚¹ãƒˆã‚¢å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§
        tool_name: list_files
        tool_node_version: '2'
        tool_parameters:
          file_search_store_name:
            type: mixed
            value: '{{#1761291739140.gemini_store_id#}}'
          page_size:
            type: constant
            value: null
          page_token:
            type: mixed
            value: null
        type: tool
      height: 52
      id: '1771573783623'
      position:
        x: 4606
        y: 456
      positionAbsolute:
        x: 4606
        y: 456
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: -2010
      y: 110
      zoom: 0.7
  rag_pipeline_variables: []
